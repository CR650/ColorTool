<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VolumetricFogé…ç½®åŠŸèƒ½æµ‹è¯•</title>
    
    <!-- å¼•å…¥SheetJSåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/styles.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #f57c00;
        }
        
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒ«ï¸ VolumetricFogé…ç½®åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°å¢çš„VolumetricFogé…ç½®é¢æ¿åŠŸèƒ½ï¼ŒåŒ…æ‹¬UIæ˜¾ç¤ºã€æ•°æ®éªŒè¯ã€é…ç½®ä¿å­˜ç­‰ã€‚</p>
        
        <div id="status" class="status info">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <button class="test-button" onclick="showVolumetricFogPanel()">æ˜¾ç¤ºVolumetricFogé¢æ¿</button>
            <button class="test-button" onclick="hideVolumetricFogPanel()">éšè—VolumetricFogé¢æ¿</button>
            <button class="test-button" onclick="testValidation()">æµ‹è¯•éªŒè¯åŠŸèƒ½</button>
            <button class="test-button" onclick="testDataCollection()">æµ‹è¯•æ•°æ®æ”¶é›†</button>
            <button class="test-button" onclick="testColorPreview()">æµ‹è¯•é¢œè‰²é¢„è§ˆ</button>
            <button class="test-button" onclick="testTargetSheets()">æµ‹è¯•å·¥ä½œè¡¨å¤„ç†</button>
            <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <!-- VolumetricFogé…ç½®é¢æ¿ -->
        <div class="volumetricfog-config-section" id="volumetricfogConfigSection" style="display: none;">
            <h4>ğŸŒ«ï¸ RSC_Theme VolumetricFog ä½“ç§¯é›¾å‚æ•°è®¾ç½®</h4>
            <div class="volumetricfog-config-content">
                <div class="volumetricfog-config-grid">
                    <!-- ä½“ç§¯é›¾é¢œè‰²é…ç½® -->
                    <div class="volumetricfog-config-group">
                        <h5>ğŸ¨ ä½“ç§¯é›¾é¢œè‰²è®¾ç½®</h5>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogColor">ä½“ç§¯é›¾é¢œè‰² (Color):</label>
                            <div class="color-selector-container">
                                <input type="text" id="volumetricfogColor" value="FFFFFF" placeholder="16è¿›åˆ¶é¢œè‰²å€¼" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                <div class="color-preview" id="volumetricfogColorPreview" style="background-color: #FFFFFF;"></div>
                                <button type="button" class="color-picker-btn" data-target="volumetricfogColor">é€‰æ‹©é¢œè‰²</button>
                            </div>
                            <span class="field-hint">16è¿›åˆ¶æ ¼å¼çš„ä½“ç§¯é›¾é¢œè‰²å€¼</span>
                        </div>
                    </div>

                    <!-- ä½“ç§¯é›¾å°ºå¯¸é…ç½® -->
                    <div class="volumetricfog-config-group">
                        <h5>ğŸ“ ä½“ç§¯é›¾å°ºå¯¸è®¾ç½®</h5>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogX">å®½åº¦ (X):</label>
                            <input type="number" id="volumetricfogX" min="0" max="100" step="1" value="50" placeholder="èŒƒå›´: 0 åˆ° 100">
                            <span class="field-hint">ä½“ç§¯é›¾çš„å®½åº¦å€¼ï¼Œæ•´æ•°èŒƒå›´ 0-100</span>
                        </div>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogY">é•¿åº¦ (Y):</label>
                            <input type="number" id="volumetricfogY" min="0" max="100" step="1" value="50" placeholder="èŒƒå›´: 0 åˆ° 100">
                            <span class="field-hint">ä½“ç§¯é›¾çš„é•¿åº¦å€¼ï¼Œæ•´æ•°èŒƒå›´ 0-100</span>
                        </div>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogZ">é«˜åº¦ (Z):</label>
                            <input type="number" id="volumetricfogZ" min="0" max="100" step="1" value="50" placeholder="èŒƒå›´: 0 åˆ° 100">
                            <span class="field-hint">ä½“ç§¯é›¾çš„é«˜åº¦å€¼ï¼Œæ•´æ•°èŒƒå›´ 0-100</span>
                        </div>
                    </div>

                    <!-- ä½“ç§¯é›¾æ•ˆæœé…ç½® -->
                    <div class="volumetricfog-config-group">
                        <h5>âš™ï¸ ä½“ç§¯é›¾æ•ˆæœè®¾ç½®</h5>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogDensity">æµ“æ·¡ (Density):</label>
                            <input type="number" id="volumetricfogDensity" min="0" max="20" step="0.1" value="10.0" placeholder="èŒƒå›´: 0 åˆ° 20">
                            <span class="field-hint">ä½“ç§¯é›¾çš„æµ“æ·¡å€¼ï¼Œæ”¯æŒä¸€ä½å°æ•°ï¼ŒèŒƒå›´ 0-20</span>
                        </div>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogRotate">æ—‹è½¬è§’åº¦ (Rotate):</label>
                            <input type="number" id="volumetricfogRotate" min="-90" max="90" step="1" value="0" placeholder="èŒƒå›´: -90 åˆ° 90">
                            <span class="field-hint">ä½“ç§¯é›¾çš„æ—‹è½¬è§’åº¦ï¼Œæ•´æ•°èŒƒå›´ -90 åˆ° 90</span>
                        </div>
                    </div>

                    <!-- ä½“ç§¯é›¾å¼€å…³é…ç½® -->
                    <div class="volumetricfog-config-group">
                        <h5>ğŸ”˜ ä½“ç§¯é›¾å¼€å…³è®¾ç½®</h5>
                        <div class="volumetricfog-field-row">
                            <label for="volumetricfogIsOn">ä½“ç§¯é›¾æ˜¯å¦é»˜è®¤å¼€å¯ (IsOn):</label>
                            <div class="toggle-switch-container">
                                <input type="checkbox" id="volumetricfogIsOn" class="toggle-switch-input">
                                <label for="volumetricfogIsOn" class="toggle-switch-label">
                                    <span class="toggle-switch-slider"></span>
                                    <span class="toggle-switch-text">å¼€å¯</span>
                                </label>
                            </div>
                            <span class="field-hint">æ§åˆ¶ä½“ç§¯é›¾æ•ˆæœæ˜¯å¦é»˜è®¤å¼€å¯</span>
                        </div>
                    </div>
                </div>
                <small class="help-text">
                    ğŸŒ«ï¸ è¿™äº›é…ç½®å°†åº”ç”¨åˆ°RSC_Themeè¡¨çš„VolumetricFogå­—æ®µä¸­ã€‚åˆ›å»ºæ–°ä¸»é¢˜æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼Œæ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶æ˜¾ç¤ºå½“å‰å€¼ã€‚
                </small>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults" class="test-results">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥JavaScriptæ¨¡å— -->
    <script src="js/version.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/colorPicker.js"></script>
    <script src="js/themeManager.js"></script>
    
    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // åˆå§‹åŒ–é¢œè‰²é€‰æ‹©å™¨
            if (window.App && window.App.ColorPicker) {
                try {
                    window.App.ColorPicker.init();
                    showStatus('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼', 'success');
                } catch (error) {
                    showStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('é¢œè‰²é€‰æ‹©å™¨æ¨¡å—æœªæ‰¾åˆ°', 'error');
            }
        });

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = 'æµ‹è¯•ç»“æœå·²æ¸…ç©º...\n';
        }

        // æ˜¾ç¤ºVolumetricFogé¢æ¿
        function showVolumetricFogPanel() {
            const panel = document.getElementById('volumetricfogConfigSection');
            panel.style.display = 'block';
            addTestResult('âœ… VolumetricFogé…ç½®é¢æ¿å·²æ˜¾ç¤º');
            showStatus('VolumetricFogé…ç½®é¢æ¿å·²æ˜¾ç¤º', 'success');
        }

        // éšè—VolumetricFogé¢æ¿
        function hideVolumetricFogPanel() {
            const panel = document.getElementById('volumetricfogConfigSection');
            panel.style.display = 'none';
            addTestResult('â„¹ï¸ VolumetricFogé…ç½®é¢æ¿å·²éšè—');
            showStatus('VolumetricFogé…ç½®é¢æ¿å·²éšè—', 'info');
        }

        // æµ‹è¯•éªŒè¯åŠŸèƒ½
        function testValidation() {
            addTestResult('ğŸ” å¼€å§‹æµ‹è¯•VolumetricFogéªŒè¯åŠŸèƒ½...');
            
            // æµ‹è¯•æ•´æ•°å­—æ®µéªŒè¯
            const integerTests = [
                { field: 'volumetricfogX', value: 150, expected: '100' },
                { field: 'volumetricfogY', value: -10, expected: '0' },
                { field: 'volumetricfogZ', value: 'abc', expected: '50' },
                { field: 'volumetricfogRotate', value: 100, expected: '90' },
                { field: 'volumetricfogRotate', value: -100, expected: '-90' }
            ];
            
            integerTests.forEach(test => {
                const input = document.getElementById(test.field);
                input.value = test.value;
                input.dispatchEvent(new Event('input', { bubbles: true }));
                
                setTimeout(() => {
                    const result = input.value;
                    addTestResult(`  ${test.field}: ${test.value} â†’ ${result} (æœŸæœ›: ${test.expected}) ${result === test.expected ? 'âœ…' : 'âŒ'}`);
                }, 100);
            });
            
            // æµ‹è¯•Densityå°æ•°éªŒè¯
            const densityTests = [
                { value: 25.0, expected: '20.0' },
                { value: -5.0, expected: '0.0' },
                { value: 'xyz', expected: '10.0' }
            ];
            
            densityTests.forEach(test => {
                const input = document.getElementById('volumetricfogDensity');
                input.value = test.value;
                input.dispatchEvent(new Event('input', { bubbles: true }));
                
                setTimeout(() => {
                    const result = input.value;
                    addTestResult(`  Density: ${test.value} â†’ ${result} (æœŸæœ›: ${test.expected}) ${result === test.expected ? 'âœ…' : 'âŒ'}`);
                }, 200);
            });
            
            showStatus('éªŒè¯åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•æ•°æ®æ”¶é›†
        function testDataCollection() {
            addTestResult('ğŸ“Š å¼€å§‹æµ‹è¯•VolumetricFogæ•°æ®æ”¶é›†...');

            // è®¾ç½®æµ‹è¯•å€¼
            document.getElementById('volumetricfogColor').value = 'FF6600';
            document.getElementById('volumetricfogX').value = '75';
            document.getElementById('volumetricfogY').value = '80';
            document.getElementById('volumetricfogZ').value = '60';
            document.getElementById('volumetricfogDensity').value = '15.5';
            document.getElementById('volumetricfogRotate').value = '45';
            document.getElementById('volumetricfogIsOn').checked = true;

            // æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
            if (typeof getVolumetricFogConfigData === 'function') {
                try {
                    const volumetricFogData = getVolumetricFogConfigData();
                    addTestResult('âœ… getVolumetricFogConfigDataå‡½æ•°è°ƒç”¨æˆåŠŸ');
                    addTestResult(`  æ”¶é›†çš„æ•°æ®: ${JSON.stringify(volumetricFogData, null, 2)}`);

                    // éªŒè¯æ•°æ®è½¬æ¢
                    const expectedDensity = 155; // 15.5 * 10

                    if (volumetricFogData.Density === expectedDensity) {
                        addTestResult('âœ… Densityæ•°æ®è½¬æ¢æ­£ç¡®');
                    } else {
                        addTestResult(`âŒ Densityæ•°æ®è½¬æ¢é”™è¯¯: æœŸæœ›${expectedDensity}, å®é™…${volumetricFogData.Density}`);
                    }

                } catch (error) {
                    addTestResult(`âŒ getVolumetricFogConfigDataå‡½æ•°é”™è¯¯: ${error.message}`);
                }
            } else {
                addTestResult('âš ï¸ getVolumetricFogConfigDataå‡½æ•°ä¸å¯è®¿é—®');
            }

            showStatus('æ•°æ®æ”¶é›†æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•é¢œè‰²é¢„è§ˆ
        function testColorPreview() {
            addTestResult('ğŸ¨ å¼€å§‹æµ‹è¯•VolumetricFogé¢œè‰²é¢„è§ˆ...');
            
            const testColors = ['FF9800', '00FF00', '0000FF', 'FFFF00'];
            
            testColors.forEach((color, index) => {
                setTimeout(() => {
                    const input = document.getElementById('volumetricfogColor');
                    input.value = color;
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    const preview = document.getElementById('volumetricfogColorPreview');
                    const expectedColor = `rgb(${parseInt(color.substr(0,2), 16)}, ${parseInt(color.substr(2,2), 16)}, ${parseInt(color.substr(4,2), 16)})`;
                    
                    setTimeout(() => {
                        const actualColor = preview.style.backgroundColor;
                        addTestResult(`  é¢œè‰² ${color}: é¢„è§ˆé¢œè‰² ${actualColor} ${actualColor.includes(expectedColor.replace(/rgb\(|\)/g, '').replace(/\s/g, '')) ? 'âœ…' : 'âŒ'}`);
                    }, 100);
                }, index * 500);
            });
            
            showStatus('é¢œè‰²é¢„è§ˆæµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•å·¥ä½œè¡¨å¤„ç†
        function testTargetSheets() {
            addTestResult('ğŸ“‹ å¼€å§‹æµ‹è¯•VolumetricFogå·¥ä½œè¡¨å¤„ç†é›†æˆ...');
            
            addTestResult('æ£€æŸ¥VolumetricFogæ˜¯å¦å·²æ·»åŠ åˆ°targetSheetsåˆ—è¡¨:');
            addTestResult('  1. processRSCAdditionalSheetså‡½æ•°');
            addTestResult('  2. updateExistingThemeAdditionalSheetså‡½æ•°');
            addTestResult('  3. generateUpdatedWorkbookå‡½æ•°');
            
            // æ£€æŸ¥ç›¸å…³å‡½æ•°æ˜¯å¦å­˜åœ¨
            const functions = [
                'getVolumetricFogConfigData',
                'applyVolumetricFogConfigToRow',
                'toggleVolumetricFogConfigPanel',
                'resetVolumetricFogConfigToDefaults',
                'getLastThemeVolumetricFogConfig',
                'loadExistingVolumetricFogConfig'
            ];

            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    addTestResult(`  âœ… ${funcName}: å‡½æ•°å­˜åœ¨`);
                } else {
                    addTestResult(`  âŒ ${funcName}: å‡½æ•°ä¸å­˜åœ¨æˆ–ä¸å¯è®¿é—®`);
                }
            });
            
            addTestResult('âœ… VolumetricFogå·¥ä½œè¡¨å¤„ç†é›†æˆæ£€æŸ¥å®Œæˆ');
            showStatus('å·¥ä½œè¡¨å¤„ç†æµ‹è¯•å®Œæˆ', 'success');
        }
    </script>
</body>
</html>
