# 颜色主题管理工具 (ColorTool Connect)

一个专为Unity项目设计的颜色主题配置管理工具，支持Excel文件的颜色数据处理和主题文件更新。

## 🎯 项目概述

本工具旨在简化Unity项目中颜色主题的管理流程，通过Web界面实现颜色配置的导入、处理和更新，支持RSC_Theme.xls和UGCTheme.xls文件的自动化处理。

## ✨ 主要功能

### 核心功能
- **颜色数据处理**：解析Excel源数据文件中的完整配色表
- **主题文件管理**：支持RSC_Theme.xls和UGCTheme.xls文件的读取和更新
- **Light配置管理**：RSC_Theme Light sheet的光照参数可视化配置
- **ColorInfo配置管理**：RSC_Theme ColorInfo sheet的颜色和雾效参数配置
- **UGC图案配置**：UGCTheme图案和边框的可视化选择器，支持跳板边框图案选择
- **数据映射**：智能匹配和映射颜色数据到目标主题文件
- **文件保存**：支持直接覆盖原文件或下载更新后的文件

### 技术特性
- **File System Access API**：在支持的浏览器中实现直接文件操作
- **拖拽上传**：支持文件拖拽上传，提升用户体验
- **数据预览**：实时预览Excel文件内容和Sheet数据
- **实时验证**：数值输入的实时范围检查和自动修正
- **可视化配置**：图案选择器和颜色选择器的直观操作界面
- **响应式设计**：适配桌面和移动设备
- **错误处理**：完善的错误提示和异常处理机制

## 🚀 快速开始

### 在线使用
访问 [GitHub Pages 部署地址](https://your-username.github.io/ColorToolConnectRC/) 直接使用。

### 本地部署
1. 克隆项目到本地
```bash
git clone https://github.com/your-username/ColorToolConnectRC.git
cd ColorToolConnectRC
```

2. 使用本地服务器运行
```bash
# 使用Python
python -m http.server 8000

# 使用Node.js
npx serve .

# 或直接用浏览器打开 index.html
```

## 📖 使用指南

### 基本使用流程
1. **选择源数据文件**：上传包含完整配色表的Excel文件
2. **选择主题文件**：选择Unity项目中的RSC_Theme.xls和UGCTheme.xls文件
3. **输入主题名称**：指定要创建或更新的主题名称
4. **配置主题参数**：
   - **UGC图案配置**：选择地板、玻璃、跳板的图案和边框，支持可视化图案选择器
   - **Light光照配置**：设置明度偏移、高光等级、光泽度和高光颜色
   - **ColorInfo颜色配置**：设置钻石颜色、反光颜色、远景雾颜色和雾效距离
   - **透明度设置**：调整各元素的透明度值(0-100)
5. **处理数据**：点击处理按钮生成更新后的主题文件
6. **保存文件**：直接覆盖原文件或下载更新后的文件

### Light配置详细说明
- **明度偏移设置**：
  - Max (顶面明度偏移)：范围 -255 到 255
  - Dark (侧面明度偏移)：范围 -255 到 255
  - Min (底面明度偏移)：范围 -255 到 255
- **高光参数配置**：
  - SpecularLevel (高光等级)：范围 0 到 1000，游戏中实际值为设置值÷100
  - Gloss (高光光泽度)：范围 10 到 1000，游戏中实际值为设置值÷100
- **高光颜色选择**：
  - 支持16进制颜色值输入 (如: FFFFFF)
  - 提供专业调色板进行可视化选择
  - 包含16种预设常用颜色快速选择

### ColorInfo配置详细说明
- **钻石颜色设置 (PickupDiff)**：
  - PickupDiffR、PickupDiffG、PickupDiffB：RGB值范围 0-255
  - 支持可视化颜色选择器，自动拆分为R、G、B三个数值
  - 实时颜色预览，显示RGB组合的实际效果
- **钻石反光颜色 (PickupRefl)**：
  - PickupReflR、PickupReflG、PickupReflB：RGB值范围 0-255
  - 控制钻石的反光颜色效果
- **远景雾颜色 (ForegroundFog)**：
  - ForegroundFogR、ForegroundFogG、ForegroundFogB：RGB值范围 0-255
  - 设置游戏中远景雾效的颜色
- **雾效距离参数**：
  - FogStart (雾开始距离)：范围 0-40
  - FogEnd (雾结束距离)：范围 0-90
  - 控制雾效的渐变范围和可见距离

### UGC图案配置详细说明
- **跳板边框图案选择**：
  - 支持可视化边框图案选择器，与地板边框保持一致的交互体验
  - 移除0/1限制，支持任意有效的边框图案ID
  - 输入框设置为只读，确保通过选择器设置有效值
- **玻璃透明度优化**：
  - 新建主题时默认透明度为50，提供更合理的初始值
  - 支持0-100范围的精确调整

### 文件格式要求
- **源数据文件**：Excel格式(.xlsx, .xls)，包含"完整配色表"工作表
- **主题文件**：Unity项目中的RSC_Theme.xls和UGCTheme.xls文件
- **输出格式**：统一使用.xls格式以确保与Unity工具兼容

### 浏览器兼容性
- **推荐浏览器**：Chrome 86+, Edge 86+ (支持File System Access API)
- **兼容浏览器**：Firefox, Safari (使用传统下载方式)
- **移动设备**：支持移动端浏览器访问

## 🏗️ 项目结构

```
ColorToolConnectRC/
├── index.html              # 主页面
├── css/
│   └── styles.css          # 样式文件
├── js/
│   ├── main.js            # 主模块
│   ├── version.js         # 版本管理
│   ├── utils.js           # 工具函数
│   ├── fileHandler.js     # 文件处理
│   ├── dataParser.js      # 数据解析
│   ├── tableRenderer.js   # 表格渲染
│   ├── exportUtils.js     # 导出工具
│   ├── themeManager.js    # 主题管理
│   ├── ugcPatternSelector.js # UGC图案选择器
│   ├── colorPicker.js     # 颜色选择器
│   ├── unityProjectFolderManager.js # Unity项目文件夹管理
│   ├── fileSystemAccess.js # 文件系统访问
│   └── enhancedFileManager.js # 增强文件管理
├── electron_app/          # Electron应用版本
├── python_backend/        # Python后端版本
└── README.md              # 项目文档
```

## 🔧 技术栈

### 前端技术
- **HTML5**：语义化标记和现代Web标准
- **CSS3**：响应式设计和现代样式
- **JavaScript ES6+**：模块化开发和现代语法
- **SheetJS (XLSX)**：Excel文件处理库

### 浏览器API
- **File System Access API**：直接文件操作
- **File API**：文件读取和处理
- **Drag and Drop API**：拖拽文件上传
- **Canvas API**：颜色选择器渐变绘制
- **LocalStorage API**：本地数据存储

### 开发工具
- **模块化架构**：清晰的代码组织结构
- **实时验证系统**：输入数据的即时验证和错误处理
- **事件驱动架构**：基于事件的模块间通信
- **错误处理**：完善的异常捕获和处理
- **调试支持**：详细的控制台日志输出

## 🐛 问题排查

### 常见问题
1. **文件格式错误**：确保使用.xls格式的主题文件
2. **权限问题**：在Chrome/Edge中允许文件访问权限
3. **数据不匹配**：检查源数据文件是否包含"完整配色表"工作表
4. **浏览器兼容**：使用推荐的浏览器版本

### 错误代码
- **FileFormatError**：文件格式不支持
- **PermissionError**：文件访问权限不足
- **DataMappingError**：数据映射失败
- **NetworkError**：网络连接问题

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目。

### 开发环境设置
1. Fork项目到你的GitHub账户
2. 创建功能分支：`git checkout -b feature/new-feature`
3. 提交更改：`git commit -am 'Add new feature'`
4. 推送分支：`git push origin feature/new-feature`
5. 创建Pull Request

### 代码规范
- 使用ES6+语法
- 遵循模块化开发原则
- 添加适当的注释和文档
- 确保代码通过测试

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 🎨 功能特色

### 智能数据处理
- **自动识别**：智能识别Excel文件中的配色表工作表
- **数据验证**：自动验证数据格式和完整性
- **错误恢复**：提供详细的错误信息和修复建议
- **批量处理**：支持多个主题的批量更新

### 用户体验优化
- **实时预览**：即时预览文件内容和处理结果
- **进度指示**：清晰的处理进度和状态提示
- **操作引导**：详细的使用步骤和操作指南
- **快捷操作**：支持键盘快捷键和右键菜单

### 数据安全
- **本地处理**：所有数据处理在浏览器本地完成
- **隐私保护**：不上传任何文件到服务器
- **备份机制**：自动创建文件备份
- **版本控制**：支持文件版本管理和回滚

## 🔍 详细功能说明

### 文件处理流程
1. **文件验证**：检查文件格式、大小和结构
2. **数据解析**：提取Excel文件中的颜色数据
3. **数据映射**：将源数据映射到目标主题结构
4. **数据更新**：更新主题文件中的颜色配置
5. **文件生成**：生成更新后的主题文件

### 支持的数据格式
- **颜色格式**：RGB、HEX、HSL等多种颜色格式
- **数据类型**：数值、文本、公式等Excel数据类型
- **工作表**：支持多工作表文件处理
- **编码格式**：UTF-8、GBK等多种字符编码

### 高级功能
- **Light配置管理**：RSC_Theme Light sheet的专业光照参数配置
  - 明度偏移设置：顶面(Max)、侧面(Dark)、底面(Min)的明度调整
  - 高光参数配置：高光等级(SpecularLevel)和光泽度(Gloss)设置
  - 高光颜色选择：16进制颜色值配置，支持专业调色板
  - 实时验证：自动检查数值范围并提供错误提示
- **ColorInfo配置管理**：RSC_Theme ColorInfo sheet的颜色和雾效参数配置
  - 钻石颜色设置：PickupDiffR/G/B，支持RGB颜色选择器和实时预览
  - 钻石反光颜色：PickupReflR/G/B，控制钻石反光效果
  - 远景雾颜色：ForegroundFogR/G/B，设置游戏中雾效颜色
  - 雾效距离参数：FogStart和FogEnd，控制雾效渐变范围
  - RGB颜色选择器：自动拆分颜色为R、G、B数值，支持实时预览
- **UGC图案配置**：UGCTheme图案和边框的可视化选择
  - 图案选择器：从Floor_Pattern.png中选择图案
  - 边框选择器：从Floor_Board.png中选择边框，包括跳板边框
  - 透明度配置：支持0-100范围的透明度设置，默认值优化为50
  - 预览功能：实时预览选中的图案和边框
- **数据导出**：支持JSON、CSV等格式导出
- **模板管理**：保存和复用颜色主题模板
- **批量操作**：一次性处理多个文件
- **自定义映射**：用户自定义数据映射规则

## 📊 性能指标

### 处理能力
- **文件大小**：支持最大10MB的Excel文件
- **数据量**：可处理包含数万行数据的文件
- **响应时间**：通常在3秒内完成数据处理
- **内存使用**：优化的内存管理，避免浏览器卡顿

### 兼容性测试
- ✅ Chrome 86+ (完整功能)
- ✅ Edge 86+ (完整功能)
- ✅ Firefox 90+ (基础功能)
- ✅ Safari 14+ (基础功能)
- ✅ 移动端浏览器 (响应式界面)

## 🛠️ 开发指南

### 本地开发
```bash
# 克隆项目
git clone https://github.com/your-username/ColorToolConnectRC.git
cd ColorToolConnectRC

# 启动开发服务器
python -m http.server 8000
# 或使用 Node.js
npx serve .

# 访问应用
open http://localhost:8000
```

### 代码结构说明
- **模块化设计**：每个功能模块独立开发和测试
- **事件驱动**：基于事件的模块间通信
- **错误边界**：完善的错误捕获和处理机制
- **性能优化**：懒加载和异步处理优化

### 调试技巧
- 打开浏览器开发者工具查看详细日志
- 使用`App.Debug = true`开启调试模式
- 检查控制台错误信息和网络请求
- 使用浏览器的文件访问权限设置

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 [GitHub Issue](https://github.com/your-username/ColorToolConnectRC/issues)
- 发送邮件至：your-email@example.com
- 项目讨论：[GitHub Discussions](https://github.com/your-username/ColorToolConnectRC/discussions)

---

## 📋 版本历史

### v1.4.1 (2025-01-10)
**重要更新：RSC_Theme ColorInfo配置功能和UGC图案选择器增强**

#### 🆕 新增功能
- **RSC_Theme ColorInfo配置系统**：完整的颜色和雾效参数配置界面
  - 钻石颜色设置：PickupDiffR/G/B，支持RGB颜色选择器
  - 钻石反光颜色：PickupReflR/G/B，控制反光效果
  - 远景雾颜色：ForegroundFogR/G/B，设置雾效颜色
  - 雾效距离参数：FogStart (0-40)、FogEnd (0-90)
- **RGB颜色选择器**：专门的RGB模式颜色选择工具
  - 支持颜色自动拆分为R、G、B三个数值字段
  - 实时颜色预览，显示RGB组合的实际效果
  - 与现有HEX颜色选择器完美集成

#### 🔧 功能优化
- **跳板边框图案选择器**：全面升级的图案选择体验
  - 添加可视化边框图案选择器，与地板边框保持一致
  - 移除0/1限制，支持任意有效的边框图案ID
  - 输入框设置为只读，确保通过选择器设置有效值
- **智能默认值系统**：更智能的新建主题默认值逻辑
  - Light配置：新建主题时使用表中最后一个主题的Light数据作为默认值
  - ColorInfo配置：新建主题时使用表中最后一个主题的ColorInfo数据作为默认值
  - 玻璃透明度：修复默认值为50，提供更合理的初始值

#### 🎨 界面改进
- **ColorInfo配置面板**：专业的颜色配置界面
  - 紫色渐变主题，与Light配置面板形成视觉区分
  - RGB输入组件，分别显示R、G、B数值
  - 实时颜色预览框，显示RGB组合效果
- **跳板边框配置**：统一的图案选择体验
  - 与地板边框图案选择器保持一致的UI设计
  - 移除限制性注释，提供更清晰的操作指引

#### 🛠️ 技术改进
- **模块化颜色选择器**：扩展支持RGB和HEX两种模式
- **智能数据继承**：新建主题时从现有数据中获取合理默认值
- **完整验证系统**：RGB值和雾距离的实时验证和自动修正
- **优化事件处理**：改进图案选择器的事件绑定机制

### v1.4.0 (2025-01-09)
**重大更新：RSC_Theme Light配置功能和UGC图案选择器优化**

#### 🆕 新增功能
- **RSC_Theme Light配置系统**：完整的光照参数可视化配置界面
  - 明度偏移设置：Max、Dark、Min字段，支持-255到255范围
  - 高光参数配置：SpecularLevel (0-1000)、Gloss (10-1000)
  - 高光颜色选择：16进制颜色值配置，带专业调色板
- **专业颜色选择器**：全新的颜色选择工具
  - 360度色相×明度渐变色板
  - 16种预设常用颜色快速选择
  - 16进制颜色值手动输入和验证
  - 实时颜色预览和格式转换
- **实时数值验证系统**：智能输入验证和错误处理
  - 自动范围检查和边界值修正
  - 实时错误提示和视觉反馈
  - 输入格式验证和自动清理

#### 🔧 功能优化
- **UGC图案选择器修复**：解决图案选择按钮无响应问题
  - 修复事件委托和直接绑定的冲突
  - 优化动态面板显示时的事件重新绑定
  - 改进模态框显示和图案预选功能
- **Light配置集成**：完整的数据流程支持
  - 新建主题时显示Light配置面板
  - 现有主题加载时自动填充Light配置值
  - Light配置数据的验证、获取和保存

#### 🎨 界面改进
- **Light配置面板UI**：专业的光照参数配置界面
  - 分组布局：明度偏移设置 + 高光设置
  - 字段说明：每个参数都有详细的使用提示
  - 视觉风格：与UGC配置面板保持一致的设计语言
- **颜色选择器界面**：现代化的颜色选择体验
  - 渐变色板：直观的颜色选择操作
  - 预设颜色网格：快速选择常用颜色
  - 实时预览：颜色变化的即时反馈

#### 🛠️ 技术改进
- **模块化架构**：新增独立的颜色选择器模块
- **验证系统**：完整的Light字段验证函数集
- **事件管理**：优化的事件绑定和委托机制
- **错误处理**：增强的输入异常处理和用户反馈

#### 📝 文档更新
- 添加Light配置功能的详细说明
- 更新项目结构和技术栈信息
- 完善使用指南和功能特性描述

### v1.2.0 (2025-09-05)
**主要更新：主题处理逻辑优化和功能说明完善**
- 🔧 修复主题提取逻辑，正确从第6行开始读取主题数据
- 🎯 优化更新模式下UGCTheme文件处理逻辑，明确跳过处理的原因
- 💬 改进错误提示，明确指出缺少的具体文件类型
- 📝 完善主题数据处理流程和用户反馈机制
- ⚠️ 添加功能限制说明：部分数据如雾色花纹使用上一个主题的数据
- 🎨 增强UI界面，添加功能说明和版本信息显示
- 📖 更新文档，完善使用指南和版本历史

**技术改进：**
- 修正主题名称提取的起始行索引（从第6行开始）
- 优化processUGCTheme函数的处理逻辑
- 改进processThemeData函数的错误提示机制
- 添加详细的功能限制说明和用户引导

**用户体验：**
- 更清晰的错误提示信息
- 完善的功能说明和使用指导
- 优化的版本信息展示

### v1.1.1 (2025-09-05)
**主要更新：Excel格式兼容性修复**
- 🔧 修复Excel文件格式兼容性问题
- 📝 统一使用.xls格式以兼容Unity工具
- 🐛 解决Apache POI HSSF库读取错误
- ✨ 添加版本显示功能
- 🚀 优化文件保存和下载流程
- 📱 改进响应式界面设计
- 🔍 增强错误提示和调试信息

**技术改进：**
- 所有`XLSX.write()`调用统一使用`bookType: 'xls'`
- 更新MIME类型为`application/vnd.ms-excel`
- 修复文件扩展名和下载文件名
- 添加版本管理模块和更新通知

### v1.0.0 (2025-01-08)
**初始版本发布**
- 🎉 项目初始化和基础架构搭建
- 📊 实现颜色主题数据处理功能
- 📁 支持RSC_Theme和UGCTheme文件管理
- 🔗 添加File System Access API支持
- 👀 实现数据预览和Sheet选择功能
- 📱 添加响应式界面设计
- 🎯 支持拖拽文件上传
- 🔄 实现数据同步和映射功能
- 🛠️ 完善错误处理和用户反馈
- 📖 添加使用指南和帮助文档

**核心功能：**
- Excel文件解析和处理
- 颜色数据映射和更新
- 多种文件保存方式
- 浏览器兼容性检测
- 模块化代码架构
