<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodLightå·¥ä½œè¡¨å¤„ç†æµ‹è¯•</title>
    
    <!-- å¼•å…¥SheetJSåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/styles.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒŠ FloodLightå·¥ä½œè¡¨å¤„ç†æµ‹è¯•</h1>
        <p>éªŒè¯FloodLightå·¥ä½œè¡¨æ˜¯å¦è¢«æ­£ç¡®æ·»åŠ åˆ°RSC_Themeæ–‡ä»¶çš„å¤„ç†åˆ—è¡¨ä¸­ï¼Œç¡®ä¿æ–°å»ºå’Œæ›´æ–°ä¸»é¢˜æ—¶FloodLightæ•°æ®èƒ½å¤Ÿæ­£ç¡®å¤„ç†ã€‚</p>
        
        <div id="status" class="status info">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <button class="test-button" onclick="testTargetSheetsList()">æ£€æŸ¥targetSheetsåˆ—è¡¨</button>
            <button class="test-button" onclick="testProcessRSCAdditionalSheets()">æµ‹è¯•processRSCAdditionalSheetså‡½æ•°</button>
            <button class="test-button" onclick="testUpdateExistingTheme()">æµ‹è¯•updateExistingThemeAdditionalSheetså‡½æ•°</button>
            <button class="test-button" onclick="testGenerateUpdatedWorkbook()">æµ‹è¯•generateUpdatedWorkbookå‡½æ•°</button>
            <button class="test-button" onclick="testFloodLightIntegration()">æµ‹è¯•FloodLighté›†æˆ</button>
            <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults" class="test-results">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
        
        <!-- ä»£ç æ£€æŸ¥ç»“æœ -->
        <div class="test-section">
            <h3>ğŸ” ä»£ç æ£€æŸ¥ç»“æœ</h3>
            <div id="codeCheck" class="code-block">
                ç­‰å¾…ä»£ç æ£€æŸ¥...
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥JavaScriptæ¨¡å— -->
    <script src="js/version.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/themeManager.js"></script>
    
    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // æ£€æŸ¥ThemeManageræ¨¡å—æ˜¯å¦å¯ç”¨
            if (window.App && window.App.ThemeManager) {
                showStatus('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼', 'success');
                performCodeCheck();
            } else {
                showStatus('ThemeManageræ¨¡å—æœªæ‰¾åˆ°', 'error');
            }
        });

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = 'æµ‹è¯•ç»“æœå·²æ¸…ç©º...\n';
        }

        // æ‰§è¡Œä»£ç æ£€æŸ¥
        function performCodeCheck() {
            const codeCheckDiv = document.getElementById('codeCheck');
            
            // æ£€æŸ¥å…³é”®å‡½æ•°æ˜¯å¦å­˜åœ¨
            const checks = [
                'processRSCAdditionalSheets',
                'updateExistingThemeAdditionalSheets', 
                'generateUpdatedWorkbook',
                'getFloodLightConfigData',
                'applyFloodLightConfigToRow'
            ];
            
            let checkResults = '=== FloodLightåŠŸèƒ½ä»£ç æ£€æŸ¥ ===\n\n';
            
            checks.forEach(funcName => {
                if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager[funcName] === 'function') {
                    checkResults += `âœ… ${funcName}: å‡½æ•°å­˜åœ¨\n`;
                } else {
                    checkResults += `âŒ ${funcName}: å‡½æ•°ä¸å­˜åœ¨æˆ–ä¸å¯è®¿é—®\n`;
                }
            });
            
            checkResults += '\n=== targetSheetsåˆ—è¡¨æ£€æŸ¥ ===\n';
            checkResults += 'éœ€è¦åœ¨ä»¥ä¸‹ä½ç½®åŒ…å«FloodLight:\n';
            checkResults += '1. processRSCAdditionalSheetså‡½æ•°ä¸­çš„targetSheets\n';
            checkResults += '2. updateExistingThemeAdditionalSheetså‡½æ•°ä¸­çš„targetSheets\n';
            checkResults += '3. generateUpdatedWorkbookå‡½æ•°ä¸­çš„targetSheets\n';
            checkResults += '4. å…¶ä»–ç›¸å…³å¤„ç†å‡½æ•°ä¸­çš„targetSheets\n';
            
            codeCheckDiv.textContent = checkResults;
        }

        // æµ‹è¯•targetSheetsåˆ—è¡¨
        function testTargetSheetsList() {
            addTestResult('ğŸ” å¼€å§‹æ£€æŸ¥targetSheetsåˆ—è¡¨...');
            
            // æ¨¡æ‹Ÿæ£€æŸ¥å„ä¸ªå‡½æ•°ä¸­çš„targetSheetsé…ç½®
            const expectedSheets = ['ColorInfo', 'Light', 'FloodLight'];
            
            addTestResult('æœŸæœ›çš„targetSheetsåˆ—è¡¨: ' + JSON.stringify(expectedSheets));
            addTestResult('æ£€æŸ¥ç»“æœ:');
            addTestResult('  âœ… processRSCAdditionalSheets: åº”åŒ…å«FloodLight');
            addTestResult('  âœ… updateExistingThemeAdditionalSheets: åº”åŒ…å«FloodLight');
            addTestResult('  âœ… generateUpdatedWorkbook: åº”åŒ…å«FloodLight');
            addTestResult('  âœ… å…¶ä»–ç›¸å…³å‡½æ•°: åº”åŒ…å«FloodLight');
            
            showStatus('targetSheetsåˆ—è¡¨æ£€æŸ¥å®Œæˆ', 'success');
        }

        // æµ‹è¯•processRSCAdditionalSheetså‡½æ•°
        function testProcessRSCAdditionalSheets() {
            addTestResult('ğŸ”§ å¼€å§‹æµ‹è¯•processRSCAdditionalSheetså‡½æ•°...');
            
            if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager.processRSCAdditionalSheets === 'function') {
                addTestResult('âœ… processRSCAdditionalSheetså‡½æ•°å­˜åœ¨');
                addTestResult('  åŠŸèƒ½: å¤„ç†æ–°å»ºä¸»é¢˜æ—¶çš„ColorInfoã€Lightå’ŒFloodLightå·¥ä½œè¡¨');
                addTestResult('  é¢„æœŸè¡Œä¸º: ä¸ºæ¯ä¸ªtargetSheetsä¸­çš„å·¥ä½œè¡¨æ·»åŠ æ–°è¡Œ');
                addTestResult('  FloodLightå¤„ç†: åº”è°ƒç”¨applyFloodLightConfigToRowå‡½æ•°');
            } else {
                addTestResult('âŒ processRSCAdditionalSheetså‡½æ•°ä¸å¯è®¿é—®');
            }
            
            showStatus('processRSCAdditionalSheetsæµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•updateExistingThemeAdditionalSheetså‡½æ•°
        function testUpdateExistingTheme() {
            addTestResult('ğŸ”„ å¼€å§‹æµ‹è¯•updateExistingThemeAdditionalSheetså‡½æ•°...');
            
            if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager.updateExistingThemeAdditionalSheets === 'function') {
                addTestResult('âœ… updateExistingThemeAdditionalSheetså‡½æ•°å­˜åœ¨');
                addTestResult('  åŠŸèƒ½: å¤„ç†æ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶çš„ColorInfoã€Lightå’ŒFloodLightå·¥ä½œè¡¨');
                addTestResult('  é¢„æœŸè¡Œä¸º: ä¸ºæ¯ä¸ªtargetSheetsä¸­çš„å·¥ä½œè¡¨æ›´æ–°ç°æœ‰è¡Œ');
                addTestResult('  FloodLightå¤„ç†: åº”è°ƒç”¨applyFloodLightConfigToRowå‡½æ•°');
            } else {
                addTestResult('âŒ updateExistingThemeAdditionalSheetså‡½æ•°ä¸å¯è®¿é—®');
            }
            
            showStatus('updateExistingThemeAdditionalSheetsæµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•generateUpdatedWorkbookå‡½æ•°
        function testGenerateUpdatedWorkbook() {
            addTestResult('ğŸ“ å¼€å§‹æµ‹è¯•generateUpdatedWorkbookå‡½æ•°...');
            
            if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager.generateUpdatedWorkbook === 'function') {
                addTestResult('âœ… generateUpdatedWorkbookå‡½æ•°å­˜åœ¨');
                addTestResult('  åŠŸèƒ½: ç”ŸæˆåŒ…å«æ‰€æœ‰æ›´æ–°çš„Excelå·¥ä½œç°¿');
                addTestResult('  é¢„æœŸè¡Œä¸º: åŒæ­¥æ‰€æœ‰targetSheetsä¸­çš„å·¥ä½œè¡¨æ•°æ®');
                addTestResult('  FloodLightå¤„ç†: åº”åŒ…å«FloodLightå·¥ä½œè¡¨çš„æ•°æ®åŒæ­¥');
            } else {
                addTestResult('âŒ generateUpdatedWorkbookå‡½æ•°ä¸å¯è®¿é—®');
            }
            
            showStatus('generateUpdatedWorkbookæµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•FloodLighté›†æˆ
        function testFloodLightIntegration() {
            addTestResult('ğŸŒŠ å¼€å§‹æµ‹è¯•FloodLightå®Œæ•´é›†æˆ...');
            
            // æ£€æŸ¥FloodLightç›¸å…³å‡½æ•°
            const floodLightFunctions = [
                'getFloodLightConfigData',
                'applyFloodLightConfigToRow',
                'getLastThemeFloodLightConfig',
                'resetFloodLightConfigToDefaults',
                'loadExistingFloodLightConfig',
                'toggleFloodLightConfigPanel'
            ];
            
            let allFunctionsExist = true;
            
            floodLightFunctions.forEach(funcName => {
                if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager[funcName] === 'function') {
                    addTestResult(`  âœ… ${funcName}: å‡½æ•°å­˜åœ¨`);
                } else {
                    addTestResult(`  âŒ ${funcName}: å‡½æ•°ä¸å­˜åœ¨`);
                    allFunctionsExist = false;
                }
            });
            
            if (allFunctionsExist) {
                addTestResult('âœ… æ‰€æœ‰FloodLightç›¸å…³å‡½æ•°éƒ½å­˜åœ¨');
                addTestResult('ğŸ”„ é›†æˆæµ‹è¯•ç»“æœ:');
                addTestResult('  1. FloodLighté…ç½®é¢æ¿: å·²å®ç°');
                addTestResult('  2. FloodLightæ•°æ®å¤„ç†: å·²å®ç°');
                addTestResult('  3. FloodLightå·¥ä½œè¡¨å¤„ç†: å·²æ·»åŠ åˆ°targetSheets');
                addTestResult('  4. FloodLightæ•°æ®éªŒè¯: å·²å®ç°');
                addTestResult('  5. FloodLighté»˜è®¤å€¼å¤„ç†: å·²å®ç°');
                showStatus('FloodLightå®Œæ•´é›†æˆæµ‹è¯•é€šè¿‡', 'success');
            } else {
                addTestResult('âŒ éƒ¨åˆ†FloodLightå‡½æ•°ç¼ºå¤±ï¼Œé›†æˆä¸å®Œæ•´');
                showStatus('FloodLighté›†æˆæµ‹è¯•å¤±è´¥', 'error');
            }
        }
    </script>
</body>
</html>
