<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodLighté…ç½®åŠŸèƒ½æµ‹è¯•</title>
    
    <!-- å¼•å…¥SheetJSåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="css/styles.css">
    
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .test-results {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒŠ FloodLighté…ç½®åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°å¢çš„FloodLighté…ç½®é¢æ¿åŠŸèƒ½ï¼ŒåŒ…æ‹¬UIæ˜¾ç¤ºã€æ•°æ®éªŒè¯ã€é…ç½®ä¿å­˜ç­‰ã€‚</p>
        
        <div id="status" class="status info">å‡†å¤‡å¼€å§‹æµ‹è¯•...</div>
        
        <!-- æµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
            <button class="test-button" onclick="showFloodLightPanel()">æ˜¾ç¤ºFloodLighté¢æ¿</button>
            <button class="test-button" onclick="hideFloodLightPanel()">éšè—FloodLighté¢æ¿</button>
            <button class="test-button" onclick="testValidation()">æµ‹è¯•éªŒè¯åŠŸèƒ½</button>
            <button class="test-button" onclick="testDataCollection()">æµ‹è¯•æ•°æ®æ”¶é›†</button>
            <button class="test-button" onclick="testDefaultValues()">æµ‹è¯•é»˜è®¤å€¼</button>
            <button class="test-button" onclick="testColorPreview()">æµ‹è¯•é¢œè‰²é¢„è§ˆ</button>
            <button class="test-button" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <!-- FloodLighté…ç½®é¢æ¿ -->
        <div class="floodlight-config-section" id="floodlightConfigSection" style="display: none;">
            <h4>ğŸŒŠ RSC_Theme FloodLight æ³›å…‰å‚æ•°è®¾ç½®</h4>
            <div class="floodlight-config-content">
                <div class="floodlight-config-grid">
                    <!-- æ³›å…‰é¢œè‰²å’Œå‚æ•°é…ç½® -->
                    <div class="floodlight-config-group">
                        <h5>ğŸ¨ æ³›å…‰é¢œè‰²è®¾ç½®</h5>
                        <div class="floodlight-field-row">
                            <label for="floodlightColor">æ³›å…‰é¢œè‰² (Color):</label>
                            <div class="color-selector-container">
                                <input type="text" id="floodlightColor" value="FFFFFF" placeholder="16è¿›åˆ¶é¢œè‰²å€¼" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                <div class="color-preview" id="floodlightColorPreview" style="background-color: #FFFFFF;"></div>
                                <button type="button" class="color-picker-btn" data-target="floodlightColor">é€‰æ‹©é¢œè‰²</button>
                            </div>
                            <span class="field-hint">16è¿›åˆ¶æ ¼å¼çš„æ³›å…‰é¢œè‰²å€¼</span>
                        </div>
                    </div>

                    <!-- æ³›å…‰å‚æ•°é…ç½® -->
                    <div class="floodlight-config-group">
                        <h5>âš™ï¸ æ³›å…‰å‚æ•°è®¾ç½®</h5>
                        <div class="floodlight-field-row">
                            <label for="floodlightTippingPoint">ä¸´ç•Œç‚¹ (TippingPoint):</label>
                            <input type="number" id="floodlightTippingPoint" min="0" max="5" step="0.1" value="2.5" placeholder="èŒƒå›´: 0 åˆ° 5">
                            <span class="field-hint">æ³›å…‰æ•ˆæœçš„ä¸´ç•Œç‚¹å€¼ï¼Œæ”¯æŒä¸€ä½å°æ•°</span>
                        </div>
                        <div class="floodlight-field-row">
                            <label for="floodlightStrength">å¼ºåº¦ (Strength):</label>
                            <input type="number" id="floodlightStrength" min="0" max="10" step="0.1" value="7.8" placeholder="èŒƒå›´: 0 åˆ° 10">
                            <span class="field-hint">æ³›å…‰æ•ˆæœçš„å¼ºåº¦å€¼ï¼Œæ”¯æŒä¸€ä½å°æ•°</span>
                        </div>
                    </div>

                    <!-- æ³›å…‰å¼€å…³é…ç½® -->
                    <div class="floodlight-config-group">
                        <h5>ğŸ”˜ æ³›å…‰å¼€å…³è®¾ç½®</h5>
                        <div class="floodlight-field-row">
                            <label for="floodlightIsOn">æ³›å…‰æ˜¯å¦é»˜è®¤å¼€å¯ (IsOn):</label>
                            <div class="toggle-switch-container">
                                <input type="checkbox" id="floodlightIsOn" class="toggle-switch-input">
                                <label for="floodlightIsOn" class="toggle-switch-label">
                                    <span class="toggle-switch-slider"></span>
                                    <span class="toggle-switch-text">å¼€å¯</span>
                                </label>
                            </div>
                            <span class="field-hint">æ§åˆ¶æ³›å…‰æ•ˆæœæ˜¯å¦é»˜è®¤å¼€å¯</span>
                        </div>
                        <div class="floodlight-field-row">
                            <label for="floodlightJumpActiveIsLightOn">è·³æ¿è¸©è¸æ€å‘å…‰æ˜¯å¦å¼€å¯ (JumpActiveIsLightOn):</label>
                            <div class="toggle-switch-container">
                                <input type="checkbox" id="floodlightJumpActiveIsLightOn" class="toggle-switch-input">
                                <label for="floodlightJumpActiveIsLightOn" class="toggle-switch-label">
                                    <span class="toggle-switch-slider"></span>
                                    <span class="toggle-switch-text">å¼€å¯</span>
                                </label>
                            </div>
                            <span class="field-hint">æ§åˆ¶è·³æ¿è¸©è¸æ—¶çš„å‘å…‰æ•ˆæœ</span>
                        </div>
                    </div>
                </div>
                <small class="help-text">
                    ğŸŒŠ è¿™äº›é…ç½®å°†åº”ç”¨åˆ°RSC_Themeè¡¨çš„FloodLightå­—æ®µä¸­ã€‚åˆ›å»ºæ–°ä¸»é¢˜æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼Œæ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶æ˜¾ç¤ºå½“å‰å€¼ã€‚
                </small>
            </div>
        </div>
        
        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults" class="test-results">
                ç­‰å¾…æµ‹è¯•å¼€å§‹...
            </div>
        </div>
    </div>
    
    <!-- å¼•å…¥JavaScriptæ¨¡å— -->
    <script src="js/version.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/colorPicker.js"></script>
    <script src="js/themeManager.js"></script>
    
    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // åˆå§‹åŒ–é¢œè‰²é€‰æ‹©å™¨
            if (window.App && window.App.ColorPicker) {
                try {
                    window.App.ColorPicker.init();
                    showStatus('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼', 'success');
                } catch (error) {
                    showStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('é¢œè‰²é€‰æ‹©å™¨æ¨¡å—æœªæ‰¾åˆ°', 'error');
            }
        });

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message) {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML += `[${timestamp}] ${message}\n`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // æ¸…ç©ºæµ‹è¯•ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = 'æµ‹è¯•ç»“æœå·²æ¸…ç©º...\n';
        }

        // æ˜¾ç¤ºFloodLighté¢æ¿
        function showFloodLightPanel() {
            const panel = document.getElementById('floodlightConfigSection');
            panel.style.display = 'block';
            addTestResult('âœ… FloodLighté…ç½®é¢æ¿å·²æ˜¾ç¤º');
            showStatus('FloodLighté…ç½®é¢æ¿å·²æ˜¾ç¤º', 'success');
        }

        // éšè—FloodLighté¢æ¿
        function hideFloodLightPanel() {
            const panel = document.getElementById('floodlightConfigSection');
            panel.style.display = 'none';
            addTestResult('â„¹ï¸ FloodLighté…ç½®é¢æ¿å·²éšè—');
            showStatus('FloodLighté…ç½®é¢æ¿å·²éšè—', 'info');
        }

        // æµ‹è¯•éªŒè¯åŠŸèƒ½
        function testValidation() {
            addTestResult('ğŸ” å¼€å§‹æµ‹è¯•FloodLightéªŒè¯åŠŸèƒ½...');
            
            // æµ‹è¯•TippingPointéªŒè¯
            const tippingPointTests = [
                { value: 6.0, expected: '5.0' },
                { value: -1.0, expected: '0.0' },
                { value: 'abc', expected: '2.5' }
            ];
            
            tippingPointTests.forEach(test => {
                const input = document.getElementById('floodlightTippingPoint');
                input.value = test.value;
                input.dispatchEvent(new Event('input', { bubbles: true }));
                
                setTimeout(() => {
                    const result = input.value;
                    addTestResult(`  TippingPoint: ${test.value} â†’ ${result} (æœŸæœ›: ${test.expected}) ${result === test.expected ? 'âœ…' : 'âŒ'}`);
                }, 100);
            });
            
            // æµ‹è¯•StrengthéªŒè¯
            const strengthTests = [
                { value: 11.0, expected: '10.0' },
                { value: -1.0, expected: '0.0' },
                { value: 'xyz', expected: '7.8' }
            ];
            
            strengthTests.forEach(test => {
                const input = document.getElementById('floodlightStrength');
                input.value = test.value;
                input.dispatchEvent(new Event('input', { bubbles: true }));
                
                setTimeout(() => {
                    const result = input.value;
                    addTestResult(`  Strength: ${test.value} â†’ ${result} (æœŸæœ›: ${test.expected}) ${result === test.expected ? 'âœ…' : 'âŒ'}`);
                }, 200);
            });
            
            showStatus('éªŒè¯åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•æ•°æ®æ”¶é›†
        function testDataCollection() {
            addTestResult('ğŸ“Š å¼€å§‹æµ‹è¯•FloodLightæ•°æ®æ”¶é›†...');
            
            // è®¾ç½®æµ‹è¯•å€¼
            document.getElementById('floodlightColor').value = 'FF0000';
            document.getElementById('floodlightTippingPoint').value = '3.5';
            document.getElementById('floodlightStrength').value = '8.2';
            document.getElementById('floodlightIsOn').checked = true;
            document.getElementById('floodlightJumpActiveIsLightOn').checked = false;
            
            if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager.getFloodLightConfigData === 'function') {
                try {
                    const floodLightData = window.App.ThemeManager.getFloodLightConfigData();
                    addTestResult('âœ… getFloodLightConfigDataå‡½æ•°è°ƒç”¨æˆåŠŸ');
                    addTestResult(`  æ”¶é›†çš„æ•°æ®: ${JSON.stringify(floodLightData, null, 2)}`);
                    
                    // éªŒè¯æ•°æ®è½¬æ¢
                    const expectedTippingPoint = 35; // 3.5 * 10
                    const expectedStrength = 82; // 8.2 * 10
                    
                    if (floodLightData.TippingPoint === expectedTippingPoint) {
                        addTestResult('âœ… TippingPointæ•°æ®è½¬æ¢æ­£ç¡®');
                    } else {
                        addTestResult(`âŒ TippingPointæ•°æ®è½¬æ¢é”™è¯¯: æœŸæœ›${expectedTippingPoint}, å®é™…${floodLightData.TippingPoint}`);
                    }
                    
                    if (floodLightData.Strength === expectedStrength) {
                        addTestResult('âœ… Strengthæ•°æ®è½¬æ¢æ­£ç¡®');
                    } else {
                        addTestResult(`âŒ Strengthæ•°æ®è½¬æ¢é”™è¯¯: æœŸæœ›${expectedStrength}, å®é™…${floodLightData.Strength}`);
                    }
                    
                } catch (error) {
                    addTestResult(`âŒ getFloodLightConfigDataå‡½æ•°é”™è¯¯: ${error.message}`);
                }
            } else {
                addTestResult('âš ï¸ getFloodLightConfigDataå‡½æ•°ä¸å¯è®¿é—®');
            }
            
            showStatus('æ•°æ®æ”¶é›†æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•é»˜è®¤å€¼
        function testDefaultValues() {
            addTestResult('ğŸ”„ å¼€å§‹æµ‹è¯•FloodLighté»˜è®¤å€¼...');
            
            if (window.App && window.App.ThemeManager && typeof window.App.ThemeManager.resetFloodLightConfigToDefaults === 'function') {
                try {
                    window.App.ThemeManager.resetFloodLightConfigToDefaults();
                    addTestResult('âœ… resetFloodLightConfigToDefaultså‡½æ•°è°ƒç”¨æˆåŠŸ');
                    
                    // æ£€æŸ¥å­—æ®µå€¼
                    const colorValue = document.getElementById('floodlightColor')?.value;
                    const tippingPointValue = document.getElementById('floodlightTippingPoint')?.value;
                    const strengthValue = document.getElementById('floodlightStrength')?.value;
                    const isOnValue = document.getElementById('floodlightIsOn')?.checked;
                    const jumpActiveValue = document.getElementById('floodlightJumpActiveIsLightOn')?.checked;
                    
                    addTestResult(`  å½“å‰å€¼: Color=${colorValue}, TippingPoint=${tippingPointValue}, Strength=${strengthValue}`);
                    addTestResult(`  å¼€å…³çŠ¶æ€: IsOn=${isOnValue}, JumpActive=${jumpActiveValue}`);
                } catch (error) {
                    addTestResult(`âŒ resetFloodLightConfigToDefaultså‡½æ•°é”™è¯¯: ${error.message}`);
                }
            } else {
                addTestResult('âš ï¸ resetFloodLightConfigToDefaultså‡½æ•°ä¸å¯è®¿é—®');
            }
            
            showStatus('é»˜è®¤å€¼æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•é¢œè‰²é¢„è§ˆ
        function testColorPreview() {
            addTestResult('ğŸ¨ å¼€å§‹æµ‹è¯•FloodLighté¢œè‰²é¢„è§ˆ...');
            
            const testColors = ['FF0000', '00FF00', '0000FF', 'FFFF00'];
            
            testColors.forEach((color, index) => {
                setTimeout(() => {
                    const input = document.getElementById('floodlightColor');
                    input.value = color;
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    const preview = document.getElementById('floodlightColorPreview');
                    const expectedColor = `rgb(${parseInt(color.substr(0,2), 16)}, ${parseInt(color.substr(2,2), 16)}, ${parseInt(color.substr(4,2), 16)})`;
                    
                    setTimeout(() => {
                        const actualColor = preview.style.backgroundColor;
                        addTestResult(`  é¢œè‰² ${color}: é¢„è§ˆé¢œè‰² ${actualColor} ${actualColor.includes(expectedColor.replace(/rgb\(|\)/g, '').replace(/\s/g, '')) ? 'âœ…' : 'âŒ'}`);
                    }, 100);
                }, index * 500);
            });
            
            showStatus('é¢œè‰²é¢„è§ˆæµ‹è¯•å®Œæˆ', 'success');
        }
    </script>
</body>
</html>
