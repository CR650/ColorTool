<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColorInfoå·¥ä½œè¡¨æ¡ä»¶è¯»å–æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .test-case h4 {
            margin: 0 0 10px 0;
            color: #555;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .log-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .config-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .config-field {
            margin: 5px 0;
            padding: 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .field-label {
            font-weight: bold;
            color: #495057;
        }
        .field-value {
            color: #007bff;
            font-family: monospace;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <h1>ColorInfoå·¥ä½œè¡¨æ¡ä»¶è¯»å–æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2 class="test-title">ğŸ§ª ColorInfoå­—æ®µæ¡ä»¶è¯»å–æµ‹è¯•åœºæ™¯</h2>
        
        <div class="test-case">
            <h4>æµ‹è¯•åœºæ™¯1: Statuså·¥ä½œè¡¨ + ColorInfoçŠ¶æ€=1ï¼ˆæœ‰æ•ˆï¼‰</h4>
            <p>æºæ•°æ®åŒ…å«Statuså·¥ä½œè¡¨ï¼ŒColorInfoå­—æ®µçŠ¶æ€ä¸º1ï¼ˆæœ‰æ•ˆï¼‰ï¼Œåº”ä¼˜å…ˆä»æºæ•°æ®ColorInfoå·¥ä½œè¡¨è¯»å–</p>
            <button onclick="testColorInfoStatusValid()">è¿è¡Œæµ‹è¯•</button>
            <div id="test1-result" class="test-result" style="display: none;"></div>
            <div id="test1-config" class="config-display" style="display: none;">
                <h5>ColorInfoé…ç½®æ˜¾ç¤ºç»“æœï¼š</h5>
                <div id="test1-config-content"></div>
            </div>
        </div>
        
        <div class="test-case">
            <h4>æµ‹è¯•åœºæ™¯2: Statuså·¥ä½œè¡¨ + ColorInfoçŠ¶æ€=0ï¼ˆæ— æ•ˆï¼‰</h4>
            <p>æºæ•°æ®åŒ…å«Statuså·¥ä½œè¡¨ï¼ŒColorInfoå­—æ®µçŠ¶æ€ä¸º0ï¼ˆæ— æ•ˆï¼‰ï¼Œåº”å¿½ç•¥æºæ•°æ®ColorInfoå·¥ä½œè¡¨</p>
            <button onclick="testColorInfoStatusInvalid()">è¿è¡Œæµ‹è¯•</button>
            <div id="test2-result" class="test-result" style="display: none;"></div>
            <div id="test2-config" class="config-display" style="display: none;">
                <h5>ColorInfoé…ç½®æ˜¾ç¤ºç»“æœï¼š</h5>
                <div id="test2-config-content"></div>
            </div>
        </div>
        
        <div class="test-case">
            <h4>æµ‹è¯•åœºæ™¯3: Statuså·¥ä½œè¡¨æ— ColorInfoå­—æ®µ</h4>
            <p>æºæ•°æ®åŒ…å«Statuså·¥ä½œè¡¨ä½†æ²¡æœ‰ColorInfoå­—æ®µï¼Œåº”æ ¹æ®ä¸»é¢˜ç±»å‹å¤„ç†</p>
            <button onclick="testNoColorInfoField()">è¿è¡Œæµ‹è¯•</button>
            <div id="test3-result" class="test-result" style="display: none;"></div>
            <div id="test3-config" class="config-display" style="display: none;">
                <h5>ColorInfoé…ç½®æ˜¾ç¤ºç»“æœï¼š</h5>
                <div id="test3-config-content"></div>
            </div>
        </div>
        
        <div class="test-case">
            <h4>æµ‹è¯•åœºæ™¯4: æºæ•°æ®å­—æ®µç¼ºå¤±å›é€€æµ‹è¯•</h4>
            <p>æµ‹è¯•ä»æºæ•°æ®ColorInfoå·¥ä½œè¡¨è¯»å–å­—æ®µå€¼æ²¡æœ‰æ‰¾åˆ°å­—æ®µæ—¶ï¼Œå›é€€åˆ°RSC_Theme ColorInfoå·¥ä½œè¡¨</p>
            <button onclick="testFieldFallback()">è¿è¡Œæµ‹è¯•</button>
            <div id="test4-result" class="test-result" style="display: none;"></div>
            <div id="test4-config" class="config-display" style="display: none;">
                <h5>ColorInfoé…ç½®æ˜¾ç¤ºç»“æœï¼š</h5>
                <div id="test4-config-content"></div>
            </div>
        </div>
        
        <div class="test-case">
            <h4>æµ‹è¯•åœºæ™¯5: UIé…ç½®æ˜¾ç¤ºæµ‹è¯•</h4>
            <p>æµ‹è¯•ç›´æ¥æ˜ å°„æ¨¡å¼ä¸‹ï¼ŒColorInfoé…ç½®é¢æ¿èƒ½æ­£ç¡®æ˜¾ç¤ºæºæ•°æ®ColorInfoå·¥ä½œè¡¨çš„æ•°æ®</p>
            <button onclick="testUIConfigDisplay()">è¿è¡Œæµ‹è¯•</button>
            <div id="test5-result" class="test-result" style="display: none;"></div>
            <div id="test5-config" class="config-display" style="display: none;">
                <h5>ColorInfoé…ç½®æ˜¾ç¤ºç»“æœï¼š</h5>
                <div id="test5-config-content"></div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log-output" class="log-output"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ§åˆ¶å°æ—¥å¿—è¾“å‡ºåˆ°é¡µé¢
        const originalConsoleLog = console.log;
        const originalConsoleWarn = console.warn;
        const originalConsoleError = console.error;
        
        function logToPage(message, type = 'log') {
            const logOutput = document.getElementById('log-output');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '[ERROR]' : type === 'warn' ? '[WARN]' : '[LOG]';
            logOutput.textContent += `${timestamp} ${prefix} ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            logToPage(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalConsoleWarn.apply(console, args);
            logToPage(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            logToPage(args.join(' '), 'error');
        };
        
        function clearLog() {
            document.getElementById('log-output').textContent = '';
        }
        
        function showResult(elementId, message, isSuccess) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            element.textContent = message;
        }
        
        function showConfig(elementId, configData) {
            const element = document.getElementById(elementId);
            const contentElement = document.getElementById(elementId.replace('-config', '-config-content'));
            
            element.style.display = 'block';
            
            let configHtml = '';
            Object.entries(configData).forEach(([field, value]) => {
                configHtml += `
                    <div class="config-field">
                        <span class="field-label">${field}:</span> 
                        <span class="field-value">${value}</span>
                    </div>
                `;
            });
            
            contentElement.innerHTML = configHtml;
        }
        
        // åˆ›å»ºæ¨¡æ‹Ÿçš„ColorInfoè¾“å…¥å…ƒç´ 
        function createMockColorInfoInputs() {
            const colorInfoFields = [
                'PickupDiffR', 'PickupDiffG', 'PickupDiffB',
                'PickupReflR', 'PickupReflG', 'PickupReflB',
                'BallSpecR', 'BallSpecG', 'BallSpecB',
                'ForegroundFogR', 'ForegroundFogG', 'ForegroundFogB',
                'FogStart', 'FogEnd'
            ];
            
            colorInfoFields.forEach(fieldId => {
                if (!document.getElementById(fieldId)) {
                    const input = document.createElement('input');
                    input.id = fieldId;
                    input.type = 'text';
                    input.style.display = 'none';
                    document.body.appendChild(input);
                }
            });
        }
        
        // è·å–å½“å‰ColorInfoé…ç½®å€¼
        function getCurrentColorInfoConfig() {
            const config = {};
            const colorInfoFields = [
                'PickupDiffR', 'PickupDiffG', 'PickupDiffB',
                'PickupReflR', 'PickupReflG', 'PickupReflB',
                'BallSpecR', 'BallSpecG', 'BallSpecB',
                'ForegroundFogR', 'ForegroundFogG', 'ForegroundFogB',
                'FogStart', 'FogEnd'
            ];
            
            colorInfoFields.forEach(fieldId => {
                const input = document.getElementById(fieldId);
                config[fieldId] = input ? input.value : 'N/A';
            });
            
            return config;
        }
        
        // åˆ›å»ºæµ‹è¯•ç”¨çš„Excelæ•°æ®
        function createTestWorkbook(sheetData) {
            const wb = XLSX.utils.book_new();
            
            Object.keys(sheetData).forEach(sheetName => {
                const ws = XLSX.utils.aoa_to_sheet(sheetData[sheetName]);
                XLSX.utils.book_append_sheet(wb, ws, sheetName);
            });
            
            return wb;
        }
        
        // æ¨¡æ‹Ÿè®¾ç½®æºæ•°æ®å’Œæ˜ å°„æ¨¡å¼
        function setupTestEnvironment(mappingMode, sourceData) {
            if (typeof window.App !== 'undefined' && window.App.ThemeManager) {
                // è®¾ç½®æ˜ å°„æ¨¡å¼
                if (window.App.ThemeManager.currentMappingMode !== undefined) {
                    window.App.ThemeManager.currentMappingMode = mappingMode;
                }
                
                // è®¾ç½®æºæ•°æ®
                if (sourceData && window.App.ThemeManager.setSourceData) {
                    window.App.ThemeManager.setSourceData(sourceData);
                }
            }
        }
        
        // æµ‹è¯•ColorInfoçŠ¶æ€=1ï¼ˆæœ‰æ•ˆï¼‰
        function testColorInfoStatusValid() {
            console.log('=== å¼€å§‹æµ‹è¯•åœºæ™¯1: Statuså·¥ä½œè¡¨ + ColorInfoçŠ¶æ€=1 ===');
            
            try {
                createMockColorInfoInputs();
                
                // åˆ›å»ºåŒ…å«æœ‰æ•ˆColorInfoæ•°æ®çš„æµ‹è¯•æ•°æ®
                const testData = {
                    'Status': [
                        ['ColorInfo'],
                        [1]  // ColorInfo=1(æœ‰æ•ˆ)
                    ],
                    'ColorInfo': [
                        ['PickupDiffR', 'PickupDiffG', 'FogStart', 'FogEnd'],
                        ['100', '150', '200', '500']  // æºæ•°æ®ColorInfoå€¼
                    ]
                };
                
                const workbook = createTestWorkbook(testData);
                const sourceData = {
                    workbook: workbook,
                    fileName: 'test_valid_colorinfo.xlsx',
                    fileSize: 1024,
                    headers: ['æµ‹è¯•è¡¨å¤´'],
                    data: [{ 'æµ‹è¯•': 'æ•°æ®' }]
                };
                
                // è®¾ç½®æµ‹è¯•ç¯å¢ƒ
                setupTestEnvironment('direct', sourceData);
                
                // æµ‹è¯•ColorInfoå­—æ®µæ¡ä»¶è¯»å–
                if (typeof window.App !== 'undefined' && window.App.ThemeManager && 
                    typeof window.App.ThemeManager.findColorInfoValueDirect === 'function') {
                    
                    // æµ‹è¯•æ›´æ–°ç°æœ‰ä¸»é¢˜
                    const pickupDiffRValue = window.App.ThemeManager.findColorInfoValueDirect('PickupDiffR', false, 'TestTheme');
                    const fogStartValue = window.App.ThemeManager.findColorInfoValueDirect('FogStart', false, 'TestTheme');
                    
                    if (pickupDiffRValue === '100' && fogStartValue === '200') {
                        showResult('test1-result', 'âœ… æµ‹è¯•é€šè¿‡ï¼šColorInfoçŠ¶æ€=1æ—¶æ­£ç¡®ä»æºæ•°æ®ColorInfoå·¥ä½œè¡¨è¯»å–', true);
                        console.log('âœ… æµ‹è¯•åœºæ™¯1é€šè¿‡ï¼šColorInfoçŠ¶æ€æœ‰æ•ˆæ—¶æ­£ç¡®è¯»å–æºæ•°æ®');
                        
                        const config = getCurrentColorInfoConfig();
                        showConfig('test1-config', config);
                    } else {
                        showResult('test1-result', `âŒ æµ‹è¯•å¤±è´¥ï¼šæœŸæœ›PickupDiffR=100, FogStart=200ï¼Œå®é™…ï¼š${pickupDiffRValue}, ${fogStartValue}`, false);
                        console.error('âŒ æµ‹è¯•åœºæ™¯1å¤±è´¥ï¼šColorInfoå€¼è¯»å–é”™è¯¯');
                    }
                } else {
                    showResult('test1-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šfindColorInfoValueDirectå‡½æ•°ä¸å¯ç”¨', false);
                    console.error('âŒ findColorInfoValueDirectå‡½æ•°ä¸å¯ç”¨');
                }
                
            } catch (error) {
                showResult('test1-result', 'âŒ æµ‹è¯•å¼‚å¸¸ï¼š' + error.message, false);
                console.error('æµ‹è¯•åœºæ™¯1å¼‚å¸¸:', error);
            }
        }
        
        // æµ‹è¯•ColorInfoçŠ¶æ€=0ï¼ˆæ— æ•ˆï¼‰
        function testColorInfoStatusInvalid() {
            console.log('=== å¼€å§‹æµ‹è¯•åœºæ™¯2: Statuså·¥ä½œè¡¨ + ColorInfoçŠ¶æ€=0 ===');
            
            try {
                createMockColorInfoInputs();
                
                const testData = {
                    'Status': [
                        ['ColorInfo'],
                        [0]  // ColorInfo=0(æ— æ•ˆ)
                    ],
                    'ColorInfo': [
                        ['PickupDiffR', 'FogStart'],
                        ['999', '999']  // è¿™äº›æ•°æ®åº”è¯¥è¢«å¿½ç•¥
                    ]
                };
                
                const workbook = createTestWorkbook(testData);
                const sourceData = {
                    workbook: workbook,
                    fileName: 'test_invalid_colorinfo.xlsx',
                    fileSize: 1024,
                    headers: ['æµ‹è¯•è¡¨å¤´'],
                    data: [{ 'æµ‹è¯•': 'æ•°æ®' }]
                };
                
                setupTestEnvironment('direct', sourceData);
                
                if (typeof window.App !== 'undefined' && window.App.ThemeManager && 
                    typeof window.App.ThemeManager.findColorInfoValueDirect === 'function') {
                    
                    // æµ‹è¯•æ–°å»ºä¸»é¢˜ï¼ˆåº”è¯¥è¿”å›nullï¼‰
                    const pickupDiffRValue = window.App.ThemeManager.findColorInfoValueDirect('PickupDiffR', true, 'NewTheme');
                    
                    if (pickupDiffRValue === null) {
                        showResult('test2-result', 'âœ… æµ‹è¯•é€šè¿‡ï¼šColorInfoçŠ¶æ€=0æ—¶æ­£ç¡®å¿½ç•¥æºæ•°æ®ColorInfoå·¥ä½œè¡¨', true);
                        console.log('âœ… æµ‹è¯•åœºæ™¯2é€šè¿‡ï¼šColorInfoçŠ¶æ€æ— æ•ˆæ—¶æ­£ç¡®å¿½ç•¥æºæ•°æ®');
                        
                        const config = getCurrentColorInfoConfig();
                        showConfig('test2-config', config);
                    } else {
                        showResult('test2-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šæœŸæœ›è¿”å›nullï¼Œå®é™…ï¼š' + pickupDiffRValue, false);
                        console.error('âŒ æµ‹è¯•åœºæ™¯2å¤±è´¥ï¼šåº”è¯¥å¿½ç•¥æºæ•°æ®ColorInfoå·¥ä½œè¡¨');
                    }
                } else {
                    showResult('test2-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šfindColorInfoValueDirectå‡½æ•°ä¸å¯ç”¨', false);
                }
                
            } catch (error) {
                showResult('test2-result', 'âŒ æµ‹è¯•å¼‚å¸¸ï¼š' + error.message, false);
                console.error('æµ‹è¯•åœºæ™¯2å¼‚å¸¸:', error);
            }
        }
        
        // æµ‹è¯•Statuså·¥ä½œè¡¨æ— ColorInfoå­—æ®µ
        function testNoColorInfoField() {
            console.log('=== å¼€å§‹æµ‹è¯•åœºæ™¯3: Statuså·¥ä½œè¡¨æ— ColorInfoå­—æ®µ ===');
            
            try {
                createMockColorInfoInputs();
                
                const testData = {
                    'Status': [
                        ['Color', 'Light'],  // æ²¡æœ‰ColorInfoå­—æ®µ
                        [1, 0]
                    ]
                };
                
                const workbook = createTestWorkbook(testData);
                const sourceData = {
                    workbook: workbook,
                    fileName: 'no_colorinfo_field.xlsx',
                    fileSize: 1024,
                    headers: ['æµ‹è¯•è¡¨å¤´'],
                    data: [{ 'æµ‹è¯•': 'æ•°æ®' }]
                };
                
                setupTestEnvironment('direct', sourceData);
                
                if (typeof window.App !== 'undefined' && window.App.ThemeManager && 
                    typeof window.App.ThemeManager.findColorInfoValueDirect === 'function') {
                    
                    // æµ‹è¯•æ–°å»ºä¸»é¢˜ï¼ˆåº”è¯¥è¿”å›nullï¼‰
                    const newThemeValue = window.App.ThemeManager.findColorInfoValueDirect('PickupDiffR', true, 'NewTheme');
                    
                    if (newThemeValue === null) {
                        showResult('test3-result', 'âœ… æµ‹è¯•é€šè¿‡ï¼šæ— ColorInfoå­—æ®µæ—¶æ–°å»ºä¸»é¢˜æ­£ç¡®è¿”å›null', true);
                        console.log('âœ… æµ‹è¯•åœºæ™¯3é€šè¿‡ï¼šæ— ColorInfoå­—æ®µæ—¶å¤„ç†æ­£ç¡®');
                        
                        const config = getCurrentColorInfoConfig();
                        showConfig('test3-config', config);
                    } else {
                        showResult('test3-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šæ–°å»ºä¸»é¢˜åº”è¿”å›nullï¼Œå®é™…ï¼š' + newThemeValue, false);
                        console.error('âŒ æµ‹è¯•åœºæ™¯3å¤±è´¥ï¼šæ–°å»ºä¸»é¢˜å¤„ç†é”™è¯¯');
                    }
                } else {
                    showResult('test3-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šfindColorInfoValueDirectå‡½æ•°ä¸å¯ç”¨', false);
                }
                
            } catch (error) {
                showResult('test3-result', 'âŒ æµ‹è¯•å¼‚å¸¸ï¼š' + error.message, false);
                console.error('æµ‹è¯•åœºæ™¯3å¼‚å¸¸:', error);
            }
        }
        
        // æµ‹è¯•å­—æ®µç¼ºå¤±å›é€€æœºåˆ¶
        function testFieldFallback() {
            console.log('=== å¼€å§‹æµ‹è¯•åœºæ™¯4: æºæ•°æ®å­—æ®µç¼ºå¤±å›é€€æµ‹è¯• ===');
            
            try {
                createMockColorInfoInputs();
                
                const testData = {
                    'Status': [
                        ['ColorInfo'],
                        [1]  // ColorInfo=1(æœ‰æ•ˆ)
                    ],
                    'ColorInfo': [
                        ['PickupDiffR'],  // åªæœ‰ä¸€ä¸ªå­—æ®µï¼Œå…¶ä»–å­—æ®µç¼ºå¤±
                        ['100']
                    ]
                };
                
                const workbook = createTestWorkbook(testData);
                const sourceData = {
                    workbook: workbook,
                    fileName: 'field_fallback_test.xlsx',
                    fileSize: 1024,
                    headers: ['æµ‹è¯•è¡¨å¤´'],
                    data: [{ 'æµ‹è¯•': 'æ•°æ®' }]
                };
                
                setupTestEnvironment('direct', sourceData);
                
                if (typeof window.App !== 'undefined' && window.App.ThemeManager && 
                    typeof window.App.ThemeManager.findColorInfoValueDirect === 'function') {
                    
                    // æµ‹è¯•å­˜åœ¨çš„å­—æ®µ
                    const existingFieldValue = window.App.ThemeManager.findColorInfoValueDirect('PickupDiffR', false, 'TestTheme');
                    
                    // æµ‹è¯•ä¸å­˜åœ¨çš„å­—æ®µï¼ˆåº”è¯¥å›é€€åˆ°RSC_Themeï¼‰
                    const missingFieldValue = window.App.ThemeManager.findColorInfoValueDirect('FogStart', false, 'TestTheme');
                    
                    if (existingFieldValue === '100') {
                        showResult('test4-result', 'âœ… æµ‹è¯•é€šè¿‡ï¼šå­—æ®µå›é€€æœºåˆ¶æ­£å¸¸å·¥ä½œ', true);
                        console.log('âœ… æµ‹è¯•åœºæ™¯4é€šè¿‡ï¼šå­˜åœ¨å­—æ®µæ­£ç¡®è¯»å–ï¼Œç¼ºå¤±å­—æ®µæ­£ç¡®å›é€€');
                        
                        const config = getCurrentColorInfoConfig();
                        showConfig('test4-config', config);
                    } else {
                        showResult('test4-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šå­—æ®µå›é€€æœºåˆ¶å¼‚å¸¸', false);
                        console.error('âŒ æµ‹è¯•åœºæ™¯4å¤±è´¥ï¼šå­—æ®µå›é€€æœºåˆ¶ä¸æ­£å¸¸');
                    }
                } else {
                    showResult('test4-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šfindColorInfoValueDirectå‡½æ•°ä¸å¯ç”¨', false);
                }
                
            } catch (error) {
                showResult('test4-result', 'âŒ æµ‹è¯•å¼‚å¸¸ï¼š' + error.message, false);
                console.error('æµ‹è¯•åœºæ™¯4å¼‚å¸¸:', error);
            }
        }
        
        // æµ‹è¯•UIé…ç½®æ˜¾ç¤º
        function testUIConfigDisplay() {
            console.log('=== å¼€å§‹æµ‹è¯•åœºæ™¯5: UIé…ç½®æ˜¾ç¤ºæµ‹è¯• ===');
            
            try {
                createMockColorInfoInputs();
                
                const testData = {
                    'Status': [
                        ['ColorInfo'],
                        [1]  // ColorInfo=1(æœ‰æ•ˆ)
                    ],
                    'ColorInfo': [
                        ['PickupDiffR', 'PickupDiffG', 'FogStart', 'FogEnd'],
                        ['80', '90', '300', '600']  // UIæ˜¾ç¤ºæµ‹è¯•æ•°æ®
                    ]
                };
                
                const workbook = createTestWorkbook(testData);
                const sourceData = {
                    workbook: workbook,
                    fileName: 'ui_display_test.xlsx',
                    fileSize: 1024,
                    headers: ['æµ‹è¯•è¡¨å¤´'],
                    data: [{ 'æµ‹è¯•': 'æ•°æ®' }]
                };
                
                setupTestEnvironment('direct', sourceData);
                
                if (typeof window.App !== 'undefined' && window.App.ThemeManager && 
                    typeof window.App.ThemeManager.loadExistingColorInfoConfig === 'function') {
                    
                    // æ¨¡æ‹Ÿè°ƒç”¨loadExistingColorInfoConfig
                    window.App.ThemeManager.loadExistingColorInfoConfig('TestTheme');
                    
                    // æ£€æŸ¥ColorInfoé…ç½®æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
                    const config = getCurrentColorInfoConfig();
                    console.log('ColorInfoé…ç½®æ˜¾ç¤ºç»“æœ:', config);
                    
                    // éªŒè¯æ˜¯å¦æ˜¾ç¤ºäº†æºæ•°æ®çš„å€¼
                    if (config.PickupDiffR === '80' && config.FogStart === '300') {
                        showResult('test5-result', 'âœ… æµ‹è¯•é€šè¿‡ï¼šUIæ­£ç¡®æ˜¾ç¤ºæºæ•°æ®ColorInfoé…ç½®', true);
                        showConfig('test5-config', config);
                        console.log('âœ… æµ‹è¯•åœºæ™¯5é€šè¿‡ï¼šColorInfoé…ç½®æ­£ç¡®æ˜¾ç¤ºæºæ•°æ®');
                    } else {
                        showResult('test5-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šUIæœªæ­£ç¡®æ˜¾ç¤ºæºæ•°æ®ColorInfoé…ç½®', false);
                        showConfig('test5-config', config);
                        console.error('âŒ æµ‹è¯•åœºæ™¯5å¤±è´¥ï¼šColorInfoé…ç½®æ˜¾ç¤ºé”™è¯¯');
                    }
                } else {
                    showResult('test5-result', 'âŒ æµ‹è¯•å¤±è´¥ï¼šloadExistingColorInfoConfigå‡½æ•°ä¸å¯ç”¨', false);
                }
                
            } catch (error) {
                showResult('test5-result', 'âŒ æµ‹è¯•å¼‚å¸¸ï¼š' + error.message, false);
                console.error('æµ‹è¯•åœºæ™¯5å¼‚å¸¸:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ColorInfoå·¥ä½œè¡¨æ¡ä»¶è¯»å–æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('XLSXåº“ç‰ˆæœ¬:', typeof XLSX !== 'undefined' ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
            console.log('ThemeManageræ¨¡å—:', typeof window.App !== 'undefined' && window.App.ThemeManager ? 'å·²åŠ è½½' : 'æœªåŠ è½½');
            
            if (typeof window.App !== 'undefined' && window.App.ThemeManager) {
                console.log('å¯ç”¨çš„ColorInfoæµ‹è¯•å‡½æ•°:');
                console.log('- findColorInfoValueDirect:', typeof window.App.ThemeManager.findColorInfoValueDirect);
                console.log('- findColorInfoValueFromSourceColorInfo:', typeof window.App.ThemeManager.findColorInfoValueFromSourceColorInfo);
                console.log('- findColorInfoValueFromRSCThemeColorInfo:', typeof window.App.ThemeManager.findColorInfoValueFromRSCThemeColorInfo);
                console.log('- loadExistingColorInfoConfig:', typeof window.App.ThemeManager.loadExistingColorInfoConfig);
            }
        });
    </script>
    
    <!-- å¼•å…¥ä¿®æ”¹åçš„themeManager.jsè¿›è¡Œæµ‹è¯• -->
    <script src="js/utils.js"></script>
    <script src="js/themeManager.js"></script>
</body>
</html>
