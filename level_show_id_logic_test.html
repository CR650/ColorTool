<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level_show_id å¡«å€¼é€»è¾‘æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .section {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section-title {
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        .test-case {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            background: #fafafa;
        }
        .test-case h4 {
            color: #667eea;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .scenario-card {
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }
        .scenario-card.existing {
            border-color: #17a2b8;
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 15px 0;
            overflow-x: auto;
        }
        .logic-flow {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #667eea;
            color: white;
        }
        .comparison-table .before {
            background: #fff3cd;
        }
        .comparison-table .after {
            background: #d4edda;
        }
        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .formula {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            text-align: center;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”§ Level_show_id å¡«å€¼é€»è¾‘ä¿®æ­£</h1>
        <p>UGCThemeè¡¨å­—æ®µå¡«å€¼ç­–ç•¥ä¼˜åŒ–</p>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ“‹ é—®é¢˜æè¿°ä¸ä¿®æ­£æ–¹æ¡ˆ</h2>
        
        <div class="highlight">
            <strong>é—®é¢˜ï¼š</strong>å½“å‰Level_show_idå­—æ®µç»Ÿä¸€ä½¿ç”¨"ä¸Šä¸€è¡Œæ•°æ®å€¼+1"çš„é€»è¾‘ï¼Œæ²¡æœ‰åŒºåˆ†å…¨æ–°ä¸»é¢˜å’Œç°æœ‰ä¸»é¢˜ç³»åˆ—ï¼Œå¯¼è‡´å¡«å€¼ä¸å‡†ç¡®ã€‚
        </div>

        <div class="status-success">
            <strong>ä¿®æ­£æ–¹æ¡ˆï¼š</strong>æ ¹æ®ä¸»é¢˜ç±»å‹ï¼ˆå…¨æ–°ä¸»é¢˜ vs ç°æœ‰ä¸»é¢˜ç³»åˆ—ï¼‰é‡‡ç”¨ä¸åŒçš„Level_show_idå¡«å€¼ç­–ç•¥ã€‚
        </div>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>ä¸»é¢˜ç±»å‹</th>
                    <th>ä¿®æ­£å‰é€»è¾‘</th>
                    <th>ä¿®æ­£åé€»è¾‘</th>
                    <th>è®¡ç®—å…¬å¼</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>å…¨æ–°ä¸»é¢˜</strong></td>
                    <td class="before">ä¸Šä¸€è¡Œæ•°æ®å€¼ + 1</td>
                    <td class="after">æ–°å¢çš„ä¸»é¢˜ID - 1</td>
                    <td><code>newId - 1</code></td>
                </tr>
                <tr>
                    <td><strong>ç°æœ‰ä¸»é¢˜ç³»åˆ—</strong></td>
                    <td class="before">ä¸Šä¸€è¡Œæ•°æ®å€¼ + 1</td>
                    <td class="after">ä¸Šä¸€è¡Œæ•°æ®å€¼ + 1</td>
                    <td><code>lastValue + 1</code></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ¯ ä¿®æ­£åçš„é€»è¾‘æµç¨‹</h2>
        
        <div class="logic-flow">
            <h4>æ™ºèƒ½å¡«å€¼å†³ç­–æµç¨‹ï¼š</h4>
            <ol>
                <li><strong>è·å–æ™ºèƒ½å¤šè¯­è¨€é…ç½®</strong>ï¼šé€šè¿‡ <code>getSmartMultiLanguageConfig(themeName)</code> åˆ¤æ–­ä¸»é¢˜ç±»å‹</li>
                <li><strong>æ£€æŸ¥ç›¸ä¼¼æ€§</strong>ï¼š<code>smartConfig.similarity.isSimilar</code> åˆ¤æ–­æ˜¯å¦ä¸ºç°æœ‰ä¸»é¢˜ç³»åˆ—</li>
                <li><strong>åº”ç”¨å¯¹åº”ç­–ç•¥</strong>ï¼šæ ¹æ®ä¸»é¢˜ç±»å‹é€‰æ‹©ä¸åŒçš„Level_show_idè®¡ç®—æ–¹å¼</li>
                <li><strong>è®°å½•å¤„ç†æ¥æº</strong>ï¼šæ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œä¾¿äºè°ƒè¯•å’ŒéªŒè¯</li>
            </ol>
        </div>

        <div class="scenario-grid">
            <div class="scenario-card">
                <h4>ğŸ†• å…¨æ–°ä¸»é¢˜ç³»åˆ—</h4>
                <p><strong>åˆ¤æ–­æ¡ä»¶ï¼š</strong><code>!smartConfig.similarity.isSimilar</code></p>
                <div class="formula">Level_show_id = newId - 1</div>
                <p><strong>ç¤ºä¾‹ï¼š</strong></p>
                <ul>
                    <li>æ–°å¢ä¸»é¢˜IDï¼š15</li>
                    <li>Level_show_idï¼š14</li>
                    <li>æ¥æºï¼šnew_theme_id_minus_one</li>
                </ul>
            </div>
            
            <div class="scenario-card existing">
                <h4>ğŸ”„ ç°æœ‰ä¸»é¢˜ç³»åˆ—</h4>
                <p><strong>åˆ¤æ–­æ¡ä»¶ï¼š</strong><code>smartConfig.similarity.isSimilar</code></p>
                <div class="formula">Level_show_id = lastValue + 1</div>
                <p><strong>ç¤ºä¾‹ï¼š</strong></p>
                <ul>
                    <li>ä¸Šä¸€è¡ŒLevel_show_idï¼š8</li>
                    <li>æ–°è¡ŒLevel_show_idï¼š9</li>
                    <li>æ¥æºï¼šexisting_series_increment</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ’» ä»£ç å®ç°</h2>
        
        <h3>ä¿®æ­£å‰çš„ä»£ç ï¼š</h3>
        <div class="code-block">
targetColumnIndex = headerRow.findIndex(col => col === 'Level_show_id');
if (targetColumnIndex !== -1) {
    // ç¡®ä¿æ•°å€¼ç±»å‹è½¬æ¢
    const currentValue = parseInt(lastRow[targetColumnIndex]) || 0;
    newRow[targetColumnIndex] = (currentValue + 1).toString(); // ä¸Šä¸€è¡Œçš„æ•°å€¼åŠ ä¸€
} else {
    console.warn(`åœ¨${sheetName}ä¸­æ‰¾ä¸åˆ°Level_show_idåˆ—`);
}
        </div>

        <h3>ä¿®æ­£åçš„ä»£ç ï¼š</h3>
        <div class="code-block">
// å¤„ç†Level_show_idåˆ—çš„æ™ºèƒ½è®¾ç½®ï¼ˆæ ¹æ®ä¸»é¢˜ç±»å‹å†³å®šå¡«å€¼ç­–ç•¥ï¼‰
targetColumnIndex = headerRow.findIndex(col => col === 'Level_show_id');
if (targetColumnIndex !== -1) {
    let finalLevelShowId = null;
    let levelShowIdSource = 'unknown';

    if (smartConfig.similarity.isSimilar) {
        // ç°æœ‰ä¸»é¢˜ç³»åˆ—æ–°å¢è¡Œï¼Œä½¿ç”¨"ä¸Šä¸€è¡Œæ•°æ®å€¼+1"çš„é€»è¾‘
        const currentValue = parseInt(lastRow[targetColumnIndex]) || 0;
        finalLevelShowId = (currentValue + 1).toString();
        levelShowIdSource = 'existing_series_increment';
        console.log(`Sheet ${sheetName} ç°æœ‰ä¸»é¢˜ç³»åˆ—ï¼ŒLevel_show_idé€’å¢: ${currentValue} + 1 = ${finalLevelShowId}`);
    } else {
        // å…¨æ–°ä¸»é¢˜è¡Œï¼ŒLevel_show_idè®¾ç½®ä¸º"æ–°å¢çš„ä¸»é¢˜ID - 1"
        finalLevelShowId = (newId - 1).toString();
        levelShowIdSource = 'new_theme_id_minus_one';
        console.log(`Sheet ${sheetName} å…¨æ–°ä¸»é¢˜ç³»åˆ—ï¼ŒLevel_show_idè®¾ç½®ä¸ºæ–°IDå‡1: ${newId} - 1 = ${finalLevelShowId}`);
    }

    newRow[targetColumnIndex] = finalLevelShowId;
    console.log(`Sheet ${sheetName} æœ€ç»ˆè®¾ç½®Level_show_id: ${finalLevelShowId} (æ¥æº: ${levelShowIdSource})`);
} else {
    console.warn(`åœ¨${sheetName}ä¸­æ‰¾ä¸åˆ°Level_show_idåˆ—`);
}
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ§ª æµ‹è¯•åœºæ™¯</h2>
        
        <div class="test-case">
            <h4>åœºæ™¯1ï¼šåˆ›å»ºå…¨æ–°ä¸»é¢˜ç³»åˆ—</h4>
            <p><strong>è¾“å…¥ï¼š</strong>ä¸»é¢˜åç§° "NewSeries_Theme1"ï¼ˆä¸ç°æœ‰ä¸»é¢˜æ— ç›¸ä¼¼æ€§ï¼‰</p>
            <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
            <ul>
                <li>æ™ºèƒ½æ£€æµ‹ï¼š<code>smartConfig.similarity.isSimilar = false</code></li>
                <li>æ–°å¢IDï¼šå‡è®¾ä¸º 20</li>
                <li>Level_show_idï¼š19 (20 - 1)</li>
                <li>æ—¥å¿—è¾“å‡ºï¼š<code>å…¨æ–°ä¸»é¢˜ç³»åˆ—ï¼ŒLevel_show_idè®¾ç½®ä¸ºæ–°IDå‡1: 20 - 1 = 19</code></li>
            </ul>
        </div>

        <div class="test-case">
            <h4>åœºæ™¯2ï¼šç°æœ‰ä¸»é¢˜ç³»åˆ—æ–°å¢</h4>
            <p><strong>è¾“å…¥ï¼š</strong>ä¸»é¢˜åç§° "ExistingSeries_Theme3"ï¼ˆä¸ "ExistingSeries_Theme1" ç›¸ä¼¼ï¼‰</p>
            <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
            <ul>
                <li>æ™ºèƒ½æ£€æµ‹ï¼š<code>smartConfig.similarity.isSimilar = true</code></li>
                <li>ä¸Šä¸€è¡ŒLevel_show_idï¼šå‡è®¾ä¸º 12</li>
                <li>æ–°è¡ŒLevel_show_idï¼š13 (12 + 1)</li>
                <li>æ—¥å¿—è¾“å‡ºï¼š<code>ç°æœ‰ä¸»é¢˜ç³»åˆ—ï¼ŒLevel_show_idé€’å¢: 12 + 1 = 13</code></li>
            </ul>
        </div>

        <div class="test-case">
            <h4>åœºæ™¯3ï¼šè¾¹ç•Œæƒ…å†µå¤„ç†</h4>
            <p><strong>è¾“å…¥ï¼š</strong>Level_show_idåˆ—ä¸å­˜åœ¨æˆ–æ•°æ®å¼‚å¸¸</p>
            <p><strong>é¢„æœŸè¡Œä¸ºï¼š</strong></p>
            <ul>
                <li>åˆ—ä¸å­˜åœ¨ï¼šè¾“å‡ºè­¦å‘Šä¿¡æ¯</li>
                <li>æ•°æ®ä¸ºç©ºï¼šä½¿ç”¨é»˜è®¤å€¼ 0 è¿›è¡Œè®¡ç®—</li>
                <li>æ•°æ®æ ¼å¼é”™è¯¯ï¼šé€šè¿‡ <code>parseInt()</code> è½¬æ¢ï¼Œå¤±è´¥æ—¶ä½¿ç”¨ 0</li>
            </ul>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ“Š ä¿®æ­£æ•ˆæœ</h2>
        
        <div class="status-info">
            <strong>ä¿®æ­£å®Œæˆçš„åŠŸèƒ½ç‰¹æ€§ï¼š</strong>
        </div>
        
        <ul>
            <li>âœ… <strong>æ™ºèƒ½ä¸»é¢˜ç±»å‹è¯†åˆ«</strong>ï¼šåŸºäºç°æœ‰çš„æ™ºèƒ½å¤šè¯­è¨€é…ç½®ç³»ç»Ÿ</li>
            <li>âœ… <strong>å·®å¼‚åŒ–å¡«å€¼ç­–ç•¥</strong>ï¼šå…¨æ–°ä¸»é¢˜å’Œç°æœ‰ç³»åˆ—ä½¿ç”¨ä¸åŒè®¡ç®—æ–¹å¼</li>
            <li>âœ… <strong>è¯¦ç»†æ—¥å¿—è¾“å‡º</strong>ï¼šè®°å½•å¡«å€¼æ¥æºå’Œè®¡ç®—è¿‡ç¨‹</li>
            <li>âœ… <strong>å…¼å®¹æ€§ä¿éšœ</strong>ï¼šä¸å¤šè¯­è¨€é…ç½®åŠŸèƒ½å®Œå…¨å…¼å®¹</li>
            <li>âœ… <strong>é”™è¯¯å¤„ç†</strong>ï¼šå¤„ç†åˆ—ä¸å­˜åœ¨å’Œæ•°æ®å¼‚å¸¸æƒ…å†µ</li>
            <li>âœ… <strong>å‘åå…¼å®¹</strong>ï¼šç°æœ‰ä¸»é¢˜ç³»åˆ—çš„è¡Œä¸ºä¿æŒä¸å˜</li>
        </ul>

        <div class="highlight">
            <strong>å…³é”®æ”¹è¿›ï¼š</strong>é€šè¿‡æ™ºèƒ½æ£€æµ‹ä¸»é¢˜ç›¸ä¼¼æ€§ï¼Œç¡®ä¿Level_show_idå­—æ®µçš„å¡«å€¼é€»è¾‘ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼Œé¿å…äº†å…¨æ–°ä¸»é¢˜é”™è¯¯å»¶ç»­ä¸Šä¸€è¡Œé€’å¢é€»è¾‘çš„é—®é¢˜ã€‚
        </div>
    </div>

    <script>
        console.log('Level_show_id å¡«å€¼é€»è¾‘ä¿®æ­£æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        console.log('ä¿®æ­£è¦ç‚¹ï¼š');
        console.log('âœ… å…¨æ–°ä¸»é¢˜ï¼šLevel_show_id = newId - 1');
        console.log('âœ… ç°æœ‰ç³»åˆ—ï¼šLevel_show_id = lastValue + 1');
        console.log('âœ… æ™ºèƒ½è¯†åˆ«ï¼šåŸºäºä¸»é¢˜ç›¸ä¼¼æ€§æ£€æµ‹');
        console.log('âœ… è¯¦ç»†æ—¥å¿—ï¼šè®°å½•å¡«å€¼æ¥æºå’Œè®¡ç®—è¿‡ç¨‹');
        
        // æ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯
        function simulateLogic() {
            console.log('\n=== æ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯ ===');
            
            // åœºæ™¯1ï¼šå…¨æ–°ä¸»é¢˜
            const newThemeId = 20;
            const newThemeLevelShowId = newThemeId - 1;
            console.log(`åœºæ™¯1 - å…¨æ–°ä¸»é¢˜: newId=${newThemeId}, Level_show_id=${newThemeLevelShowId}`);
            
            // åœºæ™¯2ï¼šç°æœ‰ç³»åˆ—
            const lastValue = 12;
            const existingSeriesLevelShowId = lastValue + 1;
            console.log(`åœºæ™¯2 - ç°æœ‰ç³»åˆ—: lastValue=${lastValue}, Level_show_id=${existingSeriesLevelShowId}`);
        }
        
        setTimeout(simulateLogic, 1000);
    </script>
</body>
</html>
