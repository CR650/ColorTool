<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Light字段验证测试</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            background: #007bff;
            color: white;
            margin: 5px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔍 Light字段验证测试</h1>
        <p>专门测试Light配置字段的数值范围验证功能</p>

        <!-- 状态显示 -->
        <div id="status" class="status info">
            等待测试...
        </div>

        <!-- Light配置面板 -->
        <div class="light-config-section" style="display: block;">
            <h4>💡 Light配置验证测试</h4>
            <div class="light-config-content">
                <div class="light-config-grid">
                    <!-- 明度偏移配置 -->
                    <div class="light-config-group">
                        <h5>🌟 明度偏移设置 (范围: -255 到 255)</h5>
                        <div class="light-field-row">
                            <label for="lightMax">顶面明度偏移 (Max):</label>
                            <input type="number" id="lightMax" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                            <span class="field-hint">测试输入: 300, -300, abc</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightDark">侧面明度偏移 (Dark):</label>
                            <input type="number" id="lightDark" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                            <span class="field-hint">测试输入: 300, -300, abc</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightMin">底面明度偏移 (Min):</label>
                            <input type="number" id="lightMin" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                            <span class="field-hint">测试输入: 300, -300, abc</span>
                        </div>
                    </div>

                    <!-- 高光配置 -->
                    <div class="light-config-group">
                        <h5>✨ 高光设置</h5>
                        <div class="light-field-row">
                            <label for="lightSpecularLevel">高光等级 (SpecularLevel):</label>
                            <input type="number" id="lightSpecularLevel" min="0" max="1000" value="100" placeholder="范围: 0 到 1000">
                            <span class="field-hint">测试输入: 1500, -10, abc (范围: 0-1000)</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightGloss">高光光泽度 (Gloss):</label>
                            <input type="number" id="lightGloss" min="10" max="1000" value="100" placeholder="范围: 10 到 1000">
                            <span class="field-hint">测试输入: 1500, 5, abc (范围: 10-1000)</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightSpecularColor">高光颜色 (SpecularColor):</label>
                            <div class="color-selector-container">
                                <input type="text" id="lightSpecularColor" value="FFFFFF" placeholder="16进制颜色值" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                <div class="color-preview" id="lightSpecularColorPreview" style="background-color: #FFFFFF;"></div>
                                <button type="button" class="color-picker-btn" data-target="lightSpecularColor">选择颜色</button>
                            </div>
                            <span class="field-hint">测试输入: GGGGGG, 123, #FF0000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 测试控制 -->
        <div class="test-section">
            <h3>🧪 自动测试</h3>
            <button class="test-btn" onclick="testOffsetValidation()">测试明度偏移验证</button>
            <button class="test-btn" onclick="testSpecularValidation()">测试高光验证</button>
            <button class="test-btn" onclick="testColorValidation()">测试颜色验证</button>
            <button class="test-btn" onclick="testAllValidation()">测试所有验证</button>
            <button class="test-btn" onclick="resetAllValues()">重置所有值</button>
        </div>

        <!-- 测试结果 -->
        <div class="test-section">
            <h3>📊 测试结果</h3>
            <div id="testResults" style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px;">
                点击测试按钮开始验证...
            </div>
        </div>
    </div>

    <!-- 加载JavaScript文件 -->
    <script src="js/utils.js"></script>
    <script src="js/colorPicker.js"></script>
    <script src="js/themeManager.js"></script>
    
    <script>
        let testResults = [];

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('正在初始化验证测试...', 'info');
            
            // 等待ThemeManager初始化
            setTimeout(() => {
                if (window.App && window.App.ThemeManager) {
                    try {
                        // ThemeManager应该已经自动初始化了Light验证
                        showStatus('验证测试环境初始化完成！可以开始测试。', 'success');
                        addTestResult('✅ ThemeManager已加载，Light验证功能已激活');
                    } catch (error) {
                        showStatus(`初始化失败: ${error.message}`, 'error');
                        addTestResult(`❌ 初始化错误: ${error.message}`);
                    }
                } else {
                    showStatus('ThemeManager模块未找到', 'error');
                    addTestResult('❌ ThemeManager模块未找到');
                }
            }, 1000);
        });

        // 显示状态
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // 添加测试结果
        function addTestResult(message) {
            testResults.push(`[${new Date().toLocaleTimeString()}] ${message}`);
            document.getElementById('testResults').innerHTML = testResults.join('<br>');
        }

        // 测试明度偏移验证
        function testOffsetValidation() {
            addTestResult('🔍 开始测试明度偏移验证...');
            
            const tests = [
                { field: 'lightMax', value: '300', expected: '255' },
                { field: 'lightDark', value: '-300', expected: '-255' },
                { field: 'lightMin', value: 'abc', expected: '0' }
            ];
            
            tests.forEach(test => {
                const input = document.getElementById(test.field);
                const originalValue = input.value;
                
                // 设置测试值
                input.value = test.value;
                
                // 触发验证事件
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // 检查结果
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  ${test.field}: ${test.value} → ${finalValue} (期望: ${test.expected}) ${finalValue === test.expected ? '✅' : '❌'}`);
                    if (hasError) {
                        addTestResult(`    错误提示: ${errorMsg ? errorMsg.textContent : '无'}`);
                    }
                }, 100);
            });
            
            showStatus('明度偏移验证测试完成', 'success');
        }

        // 测试高光验证
        function testSpecularValidation() {
            addTestResult('🔍 开始测试高光验证...');
            
            const tests = [
                { field: 'lightSpecularLevel', value: '1500', expected: '1000' },
                { field: 'lightSpecularLevel', value: '-10', expected: '0' },
                { field: 'lightGloss', value: '1500', expected: '1000' },
                { field: 'lightGloss', value: '5', expected: '10' }
            ];
            
            tests.forEach(test => {
                const input = document.getElementById(test.field);
                
                // 设置测试值
                input.value = test.value;
                
                // 触发验证事件
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // 检查结果
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  ${test.field}: ${test.value} → ${finalValue} (期望: ${test.expected}) ${finalValue === test.expected ? '✅' : '❌'}`);
                    if (hasError) {
                        addTestResult(`    错误提示: ${errorMsg ? errorMsg.textContent : '无'}`);
                    }
                }, 100);
            });
            
            showStatus('高光验证测试完成', 'success');
        }

        // 测试颜色验证
        function testColorValidation() {
            addTestResult('🔍 开始测试颜色验证...');
            
            const tests = [
                { value: 'GGGGGG', expected: 'FFFFFF' },
                { value: '123', expected: 'FFFFFF' },
                { value: '#FF0000', expected: 'FF0000' },
                { value: 'ff0000', expected: 'FF0000' }
            ];
            
            const input = document.getElementById('lightSpecularColor');
            
            tests.forEach(test => {
                // 设置测试值
                input.value = test.value;
                
                // 触发验证事件
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // 检查结果
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  颜色: ${test.value} → ${finalValue} (期望: ${test.expected}) ${finalValue === test.expected ? '✅' : '❌'}`);
                    if (hasError) {
                        addTestResult(`    错误提示: ${errorMsg ? errorMsg.textContent : '无'}`);
                    }
                }, 100);
            });
            
            showStatus('颜色验证测试完成', 'success');
        }

        // 测试所有验证
        function testAllValidation() {
            addTestResult('🚀 开始完整验证测试...');
            testOffsetValidation();
            setTimeout(() => testSpecularValidation(), 500);
            setTimeout(() => testColorValidation(), 1000);
            setTimeout(() => {
                addTestResult('✅ 所有验证测试完成！');
                showStatus('所有验证测试完成', 'success');
            }, 1500);
        }

        // 重置所有值
        function resetAllValues() {
            const fields = ['lightMax', 'lightDark', 'lightMin', 'lightSpecularLevel', 'lightGloss', 'lightSpecularColor'];
            const defaults = ['0', '0', '0', '100', '100', 'FFFFFF'];
            
            fields.forEach((fieldId, index) => {
                const input = document.getElementById(fieldId);
                if (input) {
                    input.value = defaults[index];
                    input.classList.remove('validation-error');
                    
                    // 移除错误提示
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    if (errorMsg) {
                        errorMsg.remove();
                    }
                }
            });
            
            testResults = [];
            document.getElementById('testResults').innerHTML = '所有值已重置为默认值';
            showStatus('所有值已重置', 'info');
        }
    </script>
</body>
</html>
