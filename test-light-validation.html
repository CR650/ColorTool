<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightå­—æ®µéªŒè¯æµ‹è¯•</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            background: #007bff;
            color: white;
            margin: 5px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” Lightå­—æ®µéªŒè¯æµ‹è¯•</h1>
        <p>ä¸“é—¨æµ‹è¯•Lighté…ç½®å­—æ®µçš„æ•°å€¼èŒƒå›´éªŒè¯åŠŸèƒ½</p>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div id="status" class="status info">
            ç­‰å¾…æµ‹è¯•...
        </div>

        <!-- Lighté…ç½®é¢æ¿ -->
        <div class="light-config-section" style="display: block;">
            <h4>ğŸ’¡ Lighté…ç½®éªŒè¯æµ‹è¯•</h4>
            <div class="light-config-content">
                <div class="light-config-grid">
                    <!-- æ˜åº¦åç§»é…ç½® -->
                    <div class="light-config-group">
                        <h5>ğŸŒŸ æ˜åº¦åç§»è®¾ç½® (èŒƒå›´: -255 åˆ° 255)</h5>
                        <div class="light-field-row">
                            <label for="lightMax">é¡¶é¢æ˜åº¦åç§» (Max):</label>
                            <input type="number" id="lightMax" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: 300, -300, abc</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightDark">ä¾§é¢æ˜åº¦åç§» (Dark):</label>
                            <input type="number" id="lightDark" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: 300, -300, abc</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightMin">åº•é¢æ˜åº¦åç§» (Min):</label>
                            <input type="number" id="lightMin" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: 300, -300, abc</span>
                        </div>
                    </div>

                    <!-- é«˜å…‰é…ç½® -->
                    <div class="light-config-group">
                        <h5>âœ¨ é«˜å…‰è®¾ç½®</h5>
                        <div class="light-field-row">
                            <label for="lightSpecularLevel">é«˜å…‰ç­‰çº§ (SpecularLevel):</label>
                            <input type="number" id="lightSpecularLevel" min="0" max="1000" value="100" placeholder="èŒƒå›´: 0 åˆ° 1000">
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: 1500, -10, abc (èŒƒå›´: 0-1000)</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightGloss">é«˜å…‰å…‰æ³½åº¦ (Gloss):</label>
                            <input type="number" id="lightGloss" min="10" max="1000" value="100" placeholder="èŒƒå›´: 10 åˆ° 1000">
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: 1500, 5, abc (èŒƒå›´: 10-1000)</span>
                        </div>
                        <div class="light-field-row">
                            <label for="lightSpecularColor">é«˜å…‰é¢œè‰² (SpecularColor):</label>
                            <div class="color-selector-container">
                                <input type="text" id="lightSpecularColor" value="FFFFFF" placeholder="16è¿›åˆ¶é¢œè‰²å€¼" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                <div class="color-preview" id="lightSpecularColorPreview" style="background-color: #FFFFFF;"></div>
                                <button type="button" class="color-picker-btn" data-target="lightSpecularColor">é€‰æ‹©é¢œè‰²</button>
                            </div>
                            <span class="field-hint">æµ‹è¯•è¾“å…¥: GGGGGG, 123, #FF0000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æ§åˆ¶ -->
        <div class="test-section">
            <h3>ğŸ§ª è‡ªåŠ¨æµ‹è¯•</h3>
            <button class="test-btn" onclick="testOffsetValidation()">æµ‹è¯•æ˜åº¦åç§»éªŒè¯</button>
            <button class="test-btn" onclick="testSpecularValidation()">æµ‹è¯•é«˜å…‰éªŒè¯</button>
            <button class="test-btn" onclick="testColorValidation()">æµ‹è¯•é¢œè‰²éªŒè¯</button>
            <button class="test-btn" onclick="testAllValidation()">æµ‹è¯•æ‰€æœ‰éªŒè¯</button>
            <button class="test-btn" onclick="resetAllValues()">é‡ç½®æ‰€æœ‰å€¼</button>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults" style="background: #f8f9fa; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px;">
                ç‚¹å‡»æµ‹è¯•æŒ‰é’®å¼€å§‹éªŒè¯...
            </div>
        </div>
    </div>

    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/colorPicker.js"></script>
    <script src="js/themeManager.js"></script>
    
    <script>
        let testResults = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ­£åœ¨åˆå§‹åŒ–éªŒè¯æµ‹è¯•...', 'info');
            
            // ç­‰å¾…ThemeManageråˆå§‹åŒ–
            setTimeout(() => {
                if (window.App && window.App.ThemeManager) {
                    try {
                        // ThemeManageråº”è¯¥å·²ç»è‡ªåŠ¨åˆå§‹åŒ–äº†LightéªŒè¯
                        showStatus('éªŒè¯æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼å¯ä»¥å¼€å§‹æµ‹è¯•ã€‚', 'success');
                        addTestResult('âœ… ThemeManagerå·²åŠ è½½ï¼ŒLightéªŒè¯åŠŸèƒ½å·²æ¿€æ´»');
                    } catch (error) {
                        showStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                        addTestResult(`âŒ åˆå§‹åŒ–é”™è¯¯: ${error.message}`);
                    }
                } else {
                    showStatus('ThemeManageræ¨¡å—æœªæ‰¾åˆ°', 'error');
                    addTestResult('âŒ ThemeManageræ¨¡å—æœªæ‰¾åˆ°');
                }
            }, 1000);
        });

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(message) {
            testResults.push(`[${new Date().toLocaleTimeString()}] ${message}`);
            document.getElementById('testResults').innerHTML = testResults.join('<br>');
        }

        // æµ‹è¯•æ˜åº¦åç§»éªŒè¯
        function testOffsetValidation() {
            addTestResult('ğŸ” å¼€å§‹æµ‹è¯•æ˜åº¦åç§»éªŒè¯...');
            
            const tests = [
                { field: 'lightMax', value: '300', expected: '255' },
                { field: 'lightDark', value: '-300', expected: '-255' },
                { field: 'lightMin', value: 'abc', expected: '0' }
            ];
            
            tests.forEach(test => {
                const input = document.getElementById(test.field);
                const originalValue = input.value;
                
                // è®¾ç½®æµ‹è¯•å€¼
                input.value = test.value;
                
                // è§¦å‘éªŒè¯äº‹ä»¶
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // æ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  ${test.field}: ${test.value} â†’ ${finalValue} (æœŸæœ›: ${test.expected}) ${finalValue === test.expected ? 'âœ…' : 'âŒ'}`);
                    if (hasError) {
                        addTestResult(`    é”™è¯¯æç¤º: ${errorMsg ? errorMsg.textContent : 'æ— '}`);
                    }
                }, 100);
            });
            
            showStatus('æ˜åº¦åç§»éªŒè¯æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•é«˜å…‰éªŒè¯
        function testSpecularValidation() {
            addTestResult('ğŸ” å¼€å§‹æµ‹è¯•é«˜å…‰éªŒè¯...');
            
            const tests = [
                { field: 'lightSpecularLevel', value: '1500', expected: '1000' },
                { field: 'lightSpecularLevel', value: '-10', expected: '0' },
                { field: 'lightGloss', value: '1500', expected: '1000' },
                { field: 'lightGloss', value: '5', expected: '10' }
            ];
            
            tests.forEach(test => {
                const input = document.getElementById(test.field);
                
                // è®¾ç½®æµ‹è¯•å€¼
                input.value = test.value;
                
                // è§¦å‘éªŒè¯äº‹ä»¶
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // æ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  ${test.field}: ${test.value} â†’ ${finalValue} (æœŸæœ›: ${test.expected}) ${finalValue === test.expected ? 'âœ…' : 'âŒ'}`);
                    if (hasError) {
                        addTestResult(`    é”™è¯¯æç¤º: ${errorMsg ? errorMsg.textContent : 'æ— '}`);
                    }
                }, 100);
            });
            
            showStatus('é«˜å…‰éªŒè¯æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•é¢œè‰²éªŒè¯
        function testColorValidation() {
            addTestResult('ğŸ” å¼€å§‹æµ‹è¯•é¢œè‰²éªŒè¯...');
            
            const tests = [
                { value: 'GGGGGG', expected: 'FFFFFF' },
                { value: '123', expected: 'FFFFFF' },
                { value: '#FF0000', expected: 'FF0000' },
                { value: 'ff0000', expected: 'FF0000' }
            ];
            
            const input = document.getElementById('lightSpecularColor');
            
            tests.forEach(test => {
                // è®¾ç½®æµ‹è¯•å€¼
                input.value = test.value;
                
                // è§¦å‘éªŒè¯äº‹ä»¶
                input.dispatchEvent(new Event('input', { bubbles: true }));
                input.dispatchEvent(new Event('blur', { bubbles: true }));
                
                // æ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    const finalValue = input.value;
                    const hasError = input.classList.contains('validation-error');
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    
                    addTestResult(`  é¢œè‰²: ${test.value} â†’ ${finalValue} (æœŸæœ›: ${test.expected}) ${finalValue === test.expected ? 'âœ…' : 'âŒ'}`);
                    if (hasError) {
                        addTestResult(`    é”™è¯¯æç¤º: ${errorMsg ? errorMsg.textContent : 'æ— '}`);
                    }
                }, 100);
            });
            
            showStatus('é¢œè‰²éªŒè¯æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•æ‰€æœ‰éªŒè¯
        function testAllValidation() {
            addTestResult('ğŸš€ å¼€å§‹å®Œæ•´éªŒè¯æµ‹è¯•...');
            testOffsetValidation();
            setTimeout(() => testSpecularValidation(), 500);
            setTimeout(() => testColorValidation(), 1000);
            setTimeout(() => {
                addTestResult('âœ… æ‰€æœ‰éªŒè¯æµ‹è¯•å®Œæˆï¼');
                showStatus('æ‰€æœ‰éªŒè¯æµ‹è¯•å®Œæˆ', 'success');
            }, 1500);
        }

        // é‡ç½®æ‰€æœ‰å€¼
        function resetAllValues() {
            const fields = ['lightMax', 'lightDark', 'lightMin', 'lightSpecularLevel', 'lightGloss', 'lightSpecularColor'];
            const defaults = ['0', '0', '0', '100', '100', 'FFFFFF'];
            
            fields.forEach((fieldId, index) => {
                const input = document.getElementById(fieldId);
                if (input) {
                    input.value = defaults[index];
                    input.classList.remove('validation-error');
                    
                    // ç§»é™¤é”™è¯¯æç¤º
                    const errorMsg = input.parentElement.querySelector('.validation-message');
                    if (errorMsg) {
                        errorMsg.remove();
                    }
                }
            });
            
            testResults = [];
            document.getElementById('testResults').innerHTML = 'æ‰€æœ‰å€¼å·²é‡ç½®ä¸ºé»˜è®¤å€¼';
            showStatus('æ‰€æœ‰å€¼å·²é‡ç½®', 'info');
        }
    </script>
</body>
</html>
