<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾æ¡ˆé€‰æ‹©å™¨è°ƒè¯•</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .debug-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        .debug-log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” å›¾æ¡ˆé€‰æ‹©å™¨è°ƒè¯•å·¥å…·</h1>
        
        <!-- æµ‹è¯•æŒ‰é’® -->
        <div class="debug-section">
            <h3>æµ‹è¯•æŒ‰é’®</h3>
            <div class="pattern-selector-container">
                <input type="number" id="testPatternIndex" min="0" value="0" placeholder="é»˜è®¤: 0" readonly>
                <button type="button" class="pattern-select-btn" data-target="testPatternIndex" data-type="pattern">é€‰æ‹©å›¾æ¡ˆ</button>
            </div>
            <button onclick="testButtonClick()" style="margin-top: 10px;">æ‰‹åŠ¨æµ‹è¯•ç‚¹å‡»</button>
        </div>

        <!-- æ¨¡å—çŠ¶æ€æ£€æŸ¥ -->
        <div class="debug-section">
            <h3>æ¨¡å—çŠ¶æ€æ£€æŸ¥</h3>
            <button onclick="checkModuleStatus()">æ£€æŸ¥æ¨¡å—çŠ¶æ€</button>
            <button onclick="checkDOMElements()">æ£€æŸ¥DOMå…ƒç´ </button>
            <button onclick="checkEventListeners()">æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨</button>
        </div>

        <!-- è°ƒè¯•æ—¥å¿— -->
        <div class="debug-section">
            <h3>è°ƒè¯•æ—¥å¿—</h3>
            <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
            <div id="debugLog" class="debug-log"></div>
        </div>
    </div>

    <!-- å›¾æ¡ˆé€‰æ‹©å™¨æ¨¡æ€æ¡† -->
    <div id="patternSelectorModal" class="pattern-modal" style="display: none;">
        <div class="pattern-modal-content">
            <div class="pattern-modal-header">
                <h3 id="patternModalTitle">é€‰æ‹©å›¾æ¡ˆ</h3>
                <button class="pattern-modal-close" id="closePatternModal">&times;</button>
            </div>
            <div class="pattern-modal-body">
                <div class="pattern-canvas-container">
                    <canvas id="patternSelectorCanvas" class="pattern-canvas"></canvas>
                    <div id="patternLoadingText" class="pattern-loading">æ­£åœ¨åŠ è½½å›¾æ¡ˆ...</div>
                </div>
                <div class="pattern-info">
                    <div id="selectedPatternInfo" class="selected-pattern-info" style="display: none;">
                        <h4>å·²é€‰æ‹©å›¾æ¡ˆ</h4>
                        <div id="patternPreviewContainer" class="pattern-preview-container">
                            <canvas id="patternPreviewCanvas" class="pattern-preview-canvas"></canvas>
                        </div>
                        <div class="pattern-details">
                            <p><strong>å›¾æ¡ˆID:</strong> <span id="selectedPatternId">-</span></p>
                            <p><strong>ä½ç½®:</strong> <span id="selectedPatternPosition">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pattern-modal-footer">
                <button id="confirmPatternSelection" class="pattern-btn pattern-btn-primary">ç¡®è®¤é€‰æ‹©</button>
                <button id="cancelPatternSelection" class="pattern-btn pattern-btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/ugcPatternSelector.js"></script>
    
    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // æµ‹è¯•å‡½æ•°
        function testButtonClick() {
            log('æ‰‹åŠ¨æµ‹è¯•æŒ‰é’®ç‚¹å‡»...');
            const button = document.querySelector('.pattern-select-btn');
            if (button) {
                log('æ‰¾åˆ°æŒ‰é’®ï¼Œæ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶');
                button.click();
            } else {
                log('ERROR: æœªæ‰¾åˆ°æŒ‰é’®');
            }
        }

        function checkModuleStatus() {
            log('=== æ£€æŸ¥æ¨¡å—çŠ¶æ€ ===');
            
            // æ£€æŸ¥å…¨å±€Appå¯¹è±¡
            if (typeof window.App === 'undefined') {
                log('ERROR: window.App æœªå®šä¹‰');
                return;
            }
            log('âœ“ window.App å·²å®šä¹‰');

            // æ£€æŸ¥UGCPatternSelectoræ¨¡å—
            if (typeof window.App.UGCPatternSelector === 'undefined') {
                log('ERROR: UGCPatternSelector æ¨¡å—æœªå®šä¹‰');
                return;
            }
            log('âœ“ UGCPatternSelector æ¨¡å—å·²å®šä¹‰');

            // æ£€æŸ¥æ¨¡å—æ–¹æ³•
            const module = window.App.UGCPatternSelector;
            if (typeof module.init === 'function') {
                log('âœ“ init æ–¹æ³•å­˜åœ¨');
            } else {
                log('ERROR: init æ–¹æ³•ä¸å­˜åœ¨');
            }
        }

        function checkDOMElements() {
            log('=== æ£€æŸ¥DOMå…ƒç´  ===');
            
            const elements = [
                'patternSelectorModal',
                'patternModalTitle', 
                'patternSelectorCanvas',
                'closePatternModal',
                'confirmPatternSelection',
                'cancelPatternSelection'
            ];

            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ“ ${id} å…ƒç´ å­˜åœ¨`);
                } else {
                    log(`ERROR: ${id} å…ƒç´ ä¸å­˜åœ¨`);
                }
            });

            // æ£€æŸ¥æŒ‰é’®
            const buttons = document.querySelectorAll('.pattern-select-btn');
            log(`æ‰¾åˆ° ${buttons.length} ä¸ªå›¾æ¡ˆé€‰æ‹©æŒ‰é’®`);
        }

        function checkEventListeners() {
            log('=== æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨ ===');
            
            // æµ‹è¯•ç‚¹å‡»äº‹ä»¶
            const button = document.querySelector('.pattern-select-btn');
            if (button) {
                log('æµ‹è¯•æŒ‰é’®ç‚¹å‡»äº‹ä»¶...');
                
                // æ·»åŠ ä¸´æ—¶äº‹ä»¶ç›‘å¬å™¨æ¥æµ‹è¯•
                button.addEventListener('click', function(e) {
                    log('âœ“ æŒ‰é’®ç‚¹å‡»äº‹ä»¶è¢«è§¦å‘');
                    log(`æŒ‰é’®å±æ€§: data-target="${e.target.getAttribute('data-target')}", data-type="${e.target.getAttribute('data-type')}"`);
                }, { once: true });
                
                // æ¨¡æ‹Ÿç‚¹å‡»
                button.click();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            
            // åˆå§‹åŒ–UGCPatternSelectoræ¨¡å—
            if (window.App && window.App.UGCPatternSelector) {
                try {
                    window.App.UGCPatternSelector.init();
                    log('âœ“ UGCPatternSelector æ¨¡å—åˆå§‹åŒ–æˆåŠŸ');
                } catch (error) {
                    log(`ERROR: UGCPatternSelector åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                }
            } else {
                log('ERROR: UGCPatternSelector æ¨¡å—æœªæ‰¾åˆ°');
            }
            
            log('è°ƒè¯•å·¥å…·å‡†å¤‡å°±ç»ª');
        });

        // ç›‘å¬æ‰€æœ‰ç‚¹å‡»äº‹ä»¶
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('pattern-select-btn')) {
                log(`å›¾æ¡ˆé€‰æ‹©æŒ‰é’®è¢«ç‚¹å‡»: target="${e.target.getAttribute('data-target')}", type="${e.target.getAttribute('data-type')}"`);
            }
        });
    </script>
</body>
</html>
