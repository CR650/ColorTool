<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lighté…ç½®åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .test-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .test-btn.primary {
            background: #007bff;
            color: white;
        }
        .test-btn.secondary {
            background: #6c757d;
            color: white;
        }
        .test-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Lighté…ç½®åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•RSC_Theme Lighté…ç½®çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°å€¼éªŒè¯ã€é¢œè‰²é€‰æ‹©å™¨ç­‰ã€‚</p>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div id="status" class="status info">
            ç­‰å¾…æµ‹è¯•...
        </div>

        <!-- Lighté…ç½®é¢æ¿æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ’¡ Lighté…ç½®é¢æ¿</div>
            
            <!-- æ¨¡æ‹Ÿä¸»é¢˜è¾“å…¥ -->
            <div style="margin-bottom: 20px;">
                <label>ä¸»é¢˜åç§°: </label>
                <input type="text" id="testThemeInput" placeholder="è¾“å…¥ä¸»é¢˜åç§°æ˜¾ç¤ºLighté¢æ¿" style="width: 200px; padding: 8px; margin-right: 10px;">
                <button class="test-btn primary" onclick="showLightPanel()">æ˜¾ç¤ºLighté¢æ¿</button>
                <button class="test-btn secondary" onclick="hideLightPanel()">éšè—Lighté¢æ¿</button>
            </div>

            <!-- Lighté…ç½®é¢æ¿ -->
            <div class="light-config-section" id="lightConfigSection" style="display: none;">
                <h4>ğŸ’¡ RSC_Theme Light å…‰ç…§é…ç½®</h4>
                <div class="light-config-content">
                    <div class="light-config-grid">
                        <!-- æ˜åº¦åç§»é…ç½® -->
                        <div class="light-config-group">
                            <h5>ğŸŒŸ æ˜åº¦åç§»è®¾ç½®</h5>
                            <div class="light-field-row">
                                <label for="lightMax">é¡¶é¢æ˜åº¦åç§» (Max):</label>
                                <input type="number" id="lightMax" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                                <span class="field-hint">è°ƒæ•´é¡¶é¢çš„æ˜åº¦åç§»å€¼</span>
                            </div>
                            <div class="light-field-row">
                                <label for="lightDark">ä¾§é¢æ˜åº¦åç§» (Dark):</label>
                                <input type="number" id="lightDark" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                                <span class="field-hint">è°ƒæ•´ä¾§é¢çš„æ˜åº¦åç§»å€¼</span>
                            </div>
                            <div class="light-field-row">
                                <label for="lightMin">åº•é¢æ˜åº¦åç§» (Min):</label>
                                <input type="number" id="lightMin" min="-255" max="255" value="0" placeholder="èŒƒå›´: -255 åˆ° 255">
                                <span class="field-hint">è°ƒæ•´åº•é¢çš„æ˜åº¦åç§»å€¼</span>
                            </div>
                        </div>

                        <!-- é«˜å…‰é…ç½® -->
                        <div class="light-config-group">
                            <h5>âœ¨ é«˜å…‰è®¾ç½®</h5>
                            <div class="light-field-row">
                                <label for="lightSpecularLevel">é«˜å…‰ç­‰çº§ (SpecularLevel):</label>
                                <input type="number" id="lightSpecularLevel" min="0" max="1000" value="100" placeholder="èŒƒå›´: 0 åˆ° 1000">
                                <span class="field-hint">æ¸¸æˆä¸­å®é™…åº”ç”¨æ˜¯å°æ•°ç‚¹å‘å‰ç§»ä¸¤ä½æ‰æ˜¯çœŸå®å€¼</span>
                            </div>
                            <div class="light-field-row">
                                <label for="lightGloss">é«˜å…‰å…‰æ³½åº¦ (Gloss):</label>
                                <input type="number" id="lightGloss" min="10" max="1000" value="100" placeholder="èŒƒå›´: 10 åˆ° 1000">
                                <span class="field-hint">æ¸¸æˆä¸­å®é™…åº”ç”¨æ˜¯å°æ•°ç‚¹å‘å‰ç§»ä¸¤ä½æ‰æ˜¯çœŸå®å€¼</span>
                            </div>
                            <div class="light-field-row">
                                <label for="lightSpecularColor">é«˜å…‰é¢œè‰² (SpecularColor):</label>
                                <div class="color-selector-container">
                                    <input type="text" id="lightSpecularColor" value="FFFFFF" placeholder="16è¿›åˆ¶é¢œè‰²å€¼" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                    <div class="color-preview" id="lightSpecularColorPreview" style="background-color: #FFFFFF;"></div>
                                    <button type="button" class="color-picker-btn" data-target="lightSpecularColor">é€‰æ‹©é¢œè‰²</button>
                                </div>
                                <span class="field-hint">16è¿›åˆ¶æ ¼å¼çš„é«˜å…‰é¢œè‰²å€¼</span>
                            </div>
                        </div>
                    </div>
                    <small class="help-text">
                        ğŸ’¡ è¿™äº›é…ç½®å°†åº”ç”¨åˆ°RSC_Themeè¡¨çš„Lightå­—æ®µä¸­ã€‚åˆ›å»ºæ–°ä¸»é¢˜æ—¶ä½¿ç”¨é»˜è®¤å€¼ï¼Œæ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶æ˜¾ç¤ºå½“å‰å€¼ã€‚
                    </small>
                </div>
            </div>
        </div>

        <!-- éªŒè¯æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ” æ•°å€¼éªŒè¯æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn primary" onclick="testValidation()">æµ‹è¯•éªŒè¯åŠŸèƒ½</button>
                <button class="test-btn secondary" onclick="resetValues()">é‡ç½®ä¸ºé»˜è®¤å€¼</button>
                <button class="test-btn primary" onclick="fillTestValues()">å¡«å…¥æµ‹è¯•å€¼</button>
                <button class="test-btn primary" onclick="getConfigData()">è·å–é…ç½®æ•°æ®</button>
            </div>
            <div id="validationResults" class="test-result">
                ç‚¹å‡»"æµ‹è¯•éªŒè¯åŠŸèƒ½"å¼€å§‹æµ‹è¯•...
            </div>
        </div>

        <!-- é¢œè‰²é€‰æ‹©å™¨æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ¨ é¢œè‰²é€‰æ‹©å™¨æµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn primary" onclick="testColorPicker()">æµ‹è¯•é¢œè‰²é€‰æ‹©å™¨</button>
                <button class="test-btn secondary" onclick="testPresetColors()">æµ‹è¯•é¢„è®¾é¢œè‰²</button>
            </div>
            <div id="colorPickerResults" class="test-result">
                ç‚¹å‡»"æµ‹è¯•é¢œè‰²é€‰æ‹©å™¨"å¼€å§‹æµ‹è¯•...
            </div>
        </div>

        <!-- é›†æˆæµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ”— é›†æˆæµ‹è¯•</div>
            <div class="test-controls">
                <button class="test-btn primary" onclick="testIntegration()">æµ‹è¯•å®Œæ•´æµç¨‹</button>
            </div>
            <div id="integrationResults" class="test-result">
                ç‚¹å‡»"æµ‹è¯•å®Œæ•´æµç¨‹"å¼€å§‹æµ‹è¯•...
            </div>
        </div>
    </div>

    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/colorPicker.js"></script>
    
    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ­£åœ¨åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ...', 'info');
            
            // åˆå§‹åŒ–é¢œè‰²é€‰æ‹©å™¨
            if (window.App && window.App.ColorPicker) {
                try {
                    window.App.ColorPicker.init();
                    showStatus('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆï¼', 'success');
                } catch (error) {
                    showStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                showStatus('é¢œè‰²é€‰æ‹©å™¨æ¨¡å—æœªæ‰¾åˆ°', 'error');
            }
        });

        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }

        // æ˜¾ç¤ºLighté¢æ¿
        function showLightPanel() {
            const panel = document.getElementById('lightConfigSection');
            panel.style.display = 'block';
            showStatus('Lighté…ç½®é¢æ¿å·²æ˜¾ç¤º', 'success');
        }

        // éšè—Lighté¢æ¿
        function hideLightPanel() {
            const panel = document.getElementById('lightConfigSection');
            panel.style.display = 'none';
            showStatus('Lighté…ç½®é¢æ¿å·²éšè—', 'info');
        }

        // æµ‹è¯•éªŒè¯åŠŸèƒ½
        function testValidation() {
            const results = [];
            
            // æµ‹è¯•æ˜åº¦åç§»éªŒè¯
            const offsetTests = [
                { field: 'lightMax', value: 300, expected: 255 },
                { field: 'lightDark', value: -300, expected: -255 },
                { field: 'lightMin', value: 'abc', expected: 0 }
            ];
            
            offsetTests.forEach(test => {
                const input = document.getElementById(test.field);
                input.value = test.value;
                // æ¨¡æ‹ŸéªŒè¯
                const validated = validateLightOffset(test.value, 0);
                results.push(`${test.field}: ${test.value} â†’ ${validated} (æœŸæœ›: ${test.expected})`);
            });
            
            // æµ‹è¯•é«˜å…‰éªŒè¯
            const specularTests = [
                { field: 'lightSpecularLevel', value: 1500, expected: 1000 },
                { field: 'lightGloss', value: 5, expected: 10 }
            ];
            
            specularTests.forEach(test => {
                const input = document.getElementById(test.field);
                input.value = test.value;
                results.push(`${test.field}: ${test.value} â†’ éªŒè¯ä¸­...`);
            });
            
            // æµ‹è¯•é¢œè‰²éªŒè¯
            const colorInput = document.getElementById('lightSpecularColor');
            colorInput.value = 'GGGGGG';
            results.push(`é¢œè‰²éªŒè¯: GGGGGG â†’ ${validateHexColor('GGGGGG', 'FFFFFF')}`);
            
            document.getElementById('validationResults').innerHTML = results.join('<br>');
            showStatus('éªŒè¯æµ‹è¯•å®Œæˆ', 'success');
        }

        // é‡ç½®ä¸ºé»˜è®¤å€¼
        function resetValues() {
            const defaults = {
                lightMax: '0',
                lightDark: '0',
                lightMin: '0',
                lightSpecularLevel: '100',
                lightGloss: '100',
                lightSpecularColor: 'FFFFFF'
            };
            
            Object.entries(defaults).forEach(([id, value]) => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = value;
                    if (id === 'lightSpecularColor') {
                        updateColorPreview(id, value);
                    }
                }
            });
            
            showStatus('å·²é‡ç½®ä¸ºé»˜è®¤å€¼', 'success');
        }

        // å¡«å…¥æµ‹è¯•å€¼
        function fillTestValues() {
            const testValues = {
                lightMax: '50',
                lightDark: '-30',
                lightMin: '20',
                lightSpecularLevel: '500',
                lightGloss: '200',
                lightSpecularColor: 'FF6B35'
            };
            
            Object.entries(testValues).forEach(([id, value]) => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = value;
                    if (id === 'lightSpecularColor') {
                        updateColorPreview(id, value);
                    }
                }
            });
            
            showStatus('å·²å¡«å…¥æµ‹è¯•å€¼', 'success');
        }

        // è·å–é…ç½®æ•°æ®
        function getConfigData() {
            const data = {
                Max: document.getElementById('lightMax').value,
                Dark: document.getElementById('lightDark').value,
                Min: document.getElementById('lightMin').value,
                SpecularLevel: document.getElementById('lightSpecularLevel').value,
                Gloss: document.getElementById('lightGloss').value,
                SpecularColor: document.getElementById('lightSpecularColor').value
            };
            
            document.getElementById('validationResults').innerHTML = 
                '<strong>å½“å‰é…ç½®æ•°æ®:</strong><br>' + 
                JSON.stringify(data, null, 2);
            
            showStatus('é…ç½®æ•°æ®å·²è·å–', 'success');
        }

        // æµ‹è¯•é¢œè‰²é€‰æ‹©å™¨
        function testColorPicker() {
            const colorBtn = document.querySelector('.color-picker-btn[data-target="lightSpecularColor"]');
            if (colorBtn) {
                colorBtn.click();
                document.getElementById('colorPickerResults').innerHTML = 
                    'é¢œè‰²é€‰æ‹©å™¨å·²æ‰“å¼€ï¼Œè¯·åœ¨å¼¹å‡ºçš„æ¨¡æ€æ¡†ä¸­æµ‹è¯•åŠŸèƒ½ã€‚';
                showStatus('é¢œè‰²é€‰æ‹©å™¨æµ‹è¯•ä¸­...', 'info');
            } else {
                document.getElementById('colorPickerResults').innerHTML = 
                    'é”™è¯¯ï¼šæœªæ‰¾åˆ°é¢œè‰²é€‰æ‹©å™¨æŒ‰é’®';
                showStatus('é¢œè‰²é€‰æ‹©å™¨æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        // æµ‹è¯•é¢„è®¾é¢œè‰²
        function testPresetColors() {
            document.getElementById('colorPickerResults').innerHTML = 
                'è¯·æ‰“å¼€é¢œè‰²é€‰æ‹©å™¨ï¼Œç„¶åç‚¹å‡»é¢„è®¾é¢œè‰²ç½‘æ ¼ä¸­çš„ä»»æ„é¢œè‰²è¿›è¡Œæµ‹è¯•ã€‚';
            showStatus('è¯·æ‰‹åŠ¨æµ‹è¯•é¢„è®¾é¢œè‰²åŠŸèƒ½', 'info');
        }

        // æµ‹è¯•å®Œæ•´æµç¨‹
        function testIntegration() {
            const steps = [
                '1. æ˜¾ç¤ºLighté…ç½®é¢æ¿',
                '2. å¡«å…¥æµ‹è¯•æ•°æ®',
                '3. éªŒè¯æ•°å€¼èŒƒå›´',
                '4. æµ‹è¯•é¢œè‰²é€‰æ‹©',
                '5. è·å–æœ€ç»ˆé…ç½®'
            ];
            
            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    document.getElementById('integrationResults').innerHTML = 
                        steps.slice(0, currentStep + 1).map((step, i) => 
                            i === currentStep ? `<strong>${step} âœ“</strong>` : `${step} âœ“`
                        ).join('<br>');
                    currentStep++;
                } else {
                    clearInterval(interval);
                    document.getElementById('integrationResults').innerHTML += 
                        '<br><strong>âœ… é›†æˆæµ‹è¯•å®Œæˆï¼æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚</strong>';
                    showStatus('é›†æˆæµ‹è¯•å®Œæˆ', 'success');
                }
            }, 1000);
            
            // æ‰§è¡Œå®é™…æµ‹è¯•æ­¥éª¤
            showLightPanel();
            setTimeout(() => fillTestValues(), 1000);
            setTimeout(() => testValidation(), 2000);
        }

        // è¾…åŠ©éªŒè¯å‡½æ•°ï¼ˆæ¨¡æ‹ŸthemeManagerä¸­çš„å‡½æ•°ï¼‰
        function validateLightOffset(value, defaultValue = 0) {
            const numValue = parseInt(value);
            if (isNaN(numValue) || numValue < -255 || numValue > 255) {
                return defaultValue;
            }
            return numValue;
        }

        function validateHexColor(value, defaultValue = 'FFFFFF') {
            if (!value || typeof value !== 'string') {
                return defaultValue;
            }
            
            const cleanValue = value.replace('#', '').toUpperCase();
            if (/^[0-9A-F]{6}$/i.test(cleanValue)) {
                return cleanValue;
            }
            
            return defaultValue;
        }

        function updateColorPreview(inputId, color) {
            if (window.App && window.App.ColorPicker) {
                window.App.ColorPicker.updateColorPreview(inputId, color);
            }
        }
    </script>
</body>
</html>
