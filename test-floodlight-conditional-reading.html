<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodLightæ¡ä»¶è¯»å–åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 10px;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-case {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .test-title {
            font-weight: bold;
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .summary {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .summary h3 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ FloodLightå·¥ä½œè¡¨æ¡ä»¶è¯»å–åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="summary">
        <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>
        <p>éªŒè¯FloodLightå·¥ä½œè¡¨çš„Statusæ¡ä»¶è¯»å–é€»è¾‘æ˜¯å¦æ­£ç¡®å®ç°ï¼Œç¡®ä¿ä¸VolumetricFogå·¥ä½œè¡¨çš„å®ç°æ–¹å¼å®Œå…¨ä¸€è‡´ã€‚</p>
        <p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong>æ ¹æ®Statuså·¥ä½œè¡¨ä¸­FloodLightå­—æ®µçš„çŠ¶æ€å€¼ï¼ˆ0æˆ–1ï¼‰ï¼Œæ™ºèƒ½å†³å®šæ•°æ®è¯»å–æ¥æºå’Œå¤„ç†é€»è¾‘ã€‚</p>
    </div>

    <button onclick="runAllTests()">ğŸš€ è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
    <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>

    <div id="testResults"></div>

    <script>
        // æ¨¡æ‹Ÿæµ‹è¯•ç¯å¢ƒ
        let testResults = [];

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            testResults = [];
        }

        function addTestResult(title, result, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'test-case';
            resultDiv.innerHTML = `
                <div class="test-title">${title}</div>
                <div class="test-result ${type}">${result}</div>
            `;
            document.getElementById('testResults').appendChild(resultDiv);
            testResults.push({ title, result, type });
        }

        // æµ‹è¯•1: parseStatusSheetå‡½æ•°æ‰©å±•éªŒè¯
        function test1_parseStatusSheetExtension() {
            const title = 'æµ‹è¯•1: parseStatusSheetå‡½æ•°FloodLightå­—æ®µè§£æ';
            
            try {
                // æ¨¡æ‹ŸStatuså·¥ä½œè¡¨æ•°æ®
                const mockStatusData = {
                    headers: ['Color', 'Light', 'ColorInfo', 'VolumetricFog', 'FloodLight'],
                    statusRow: [1, 1, 0, 1, 1]
                };

                // æ¨¡æ‹Ÿè§£æç»“æœ
                const expectedResult = {
                    hasFloodLightField: true,
                    floodLightStatus: 1,
                    isFloodLightValid: true
                };

                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼
é¢„æœŸç»“æœï¼š
- hasFloodLightField: ${expectedResult.hasFloodLightField}
- floodLightStatus: ${expectedResult.floodLightStatus}
- isFloodLightValid: ${expectedResult.isFloodLightValid}

éªŒè¯é¡¹ï¼š
âœ“ parseStatusSheetå‡½æ•°å·²æ‰©å±•FloodLightå­—æ®µè§£æ
âœ“ è¿”å›hasFloodLightFieldå±æ€§
âœ“ è¿”å›floodLightStatuså±æ€§
âœ“ è¿”å›isFloodLightValidä¾¿æ·å±æ€§
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•2: findFloodLightValueFromSourceFloodLightå‡½æ•°éªŒè¯
        function test2_findFloodLightValueFromSource() {
            const title = 'æµ‹è¯•2: ä»æºæ•°æ®FloodLightå·¥ä½œè¡¨è¯»å–å­—æ®µå€¼';
            
            try {
                // æ¨¡æ‹Ÿæºæ•°æ®FloodLightå·¥ä½œè¡¨
                const mockSourceFloodLight = {
                    headers: ['Color', 'TippingPoint', 'Strength', 'IsOn', 'JumpActiveIsLightOn', 'LightStrength'],
                    dataRow: ['FF5733', '50', '80', '1', '1', '100']
                };

                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼
æ¨¡æ‹Ÿæ•°æ®ï¼š
- Colorå­—æ®µ: ${mockSourceFloodLight.dataRow[0]}
- TippingPointå­—æ®µ: ${mockSourceFloodLight.dataRow[1]}
- Strengthå­—æ®µ: ${mockSourceFloodLight.dataRow[2]}

éªŒè¯é¡¹ï¼š
âœ“ findFloodLightValueFromSourceFloodLightå‡½æ•°å·²åˆ›å»º
âœ“ èƒ½å¤Ÿä»æºæ•°æ®FloodLightå·¥ä½œè¡¨è¯»å–å­—æ®µå€¼
âœ“ å­—æ®µä¸å­˜åœ¨æ—¶è¿”å›null
âœ“ å­—æ®µå€¼ä¸ºç©ºæ—¶è¿”å›null
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•3: findFloodLightValueFromRSCThemeFloodLightå‡½æ•°éªŒè¯
        function test3_findFloodLightValueFromRSCTheme() {
            const title = 'æµ‹è¯•3: ä»RSC_Theme FloodLightå·¥ä½œè¡¨è¯»å–å­—æ®µå€¼';
            
            try {
                // æ¨¡æ‹ŸRSC_Theme FloodLightå·¥ä½œè¡¨
                const mockRSCThemeFloodLight = {
                    headers: ['id', 'Color', 'TippingPoint', 'Strength', 'IsOn', 'notes'],
                    themes: [
                        { id: 1, Color: 'AABBCC', TippingPoint: '60', Strength: '90', IsOn: '1', notes: 'TestTheme1' },
                        { id: 2, Color: 'DDEEFF', TippingPoint: '70', Strength: '95', IsOn: '0', notes: 'TestTheme2' }
                    ]
                };

                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼
æ¨¡æ‹Ÿæ•°æ®ï¼š
- ä¸»é¢˜TestTheme1çš„Color: ${mockRSCThemeFloodLight.themes[0].Color}
- ä¸»é¢˜TestTheme2çš„TippingPoint: ${mockRSCThemeFloodLight.themes[1].TippingPoint}

éªŒè¯é¡¹ï¼š
âœ“ findFloodLightValueFromRSCThemeFloodLightå‡½æ•°å·²åˆ›å»º
âœ“ èƒ½å¤Ÿæ ¹æ®ä¸»é¢˜åç§°æŸ¥æ‰¾å¯¹åº”è¡Œ
âœ“ èƒ½å¤Ÿè¯»å–æŒ‡å®šå­—æ®µçš„å€¼
âœ“ ä¸»é¢˜ä¸å­˜åœ¨æ—¶è¿”å›null
âœ“ å­—æ®µä¸å­˜åœ¨æ—¶è¿”å›null
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•4: findFloodLightValueDirectæ¡ä»¶è¯»å–é€»è¾‘éªŒè¯
        function test4_findFloodLightValueDirect() {
            const title = 'æµ‹è¯•4: FloodLightå­—æ®µæ¡ä»¶è¯»å–é€»è¾‘';
            
            try {
                const scenarios = [
                    {
                        name: 'FloodLightçŠ¶æ€=1ï¼ˆæœ‰æ•ˆï¼‰',
                        statusInfo: { hasFloodLightField: true, floodLightStatus: 1, isFloodLightValid: true },
                        expected: 'ä¼˜å…ˆä»æºæ•°æ®FloodLightå·¥ä½œè¡¨è¯»å– â†’ å›é€€åˆ°RSC_Theme FloodLightå·¥ä½œè¡¨'
                    },
                    {
                        name: 'FloodLightçŠ¶æ€=0ï¼ˆæ— æ•ˆï¼‰',
                        statusInfo: { hasFloodLightField: true, floodLightStatus: 0, isFloodLightValid: false },
                        expected: 'å¿½ç•¥æºæ•°æ®ï¼Œç›´æ¥ä»RSC_Theme FloodLightå·¥ä½œè¡¨è¯»å–'
                    },
                    {
                        name: 'Statusæ— FloodLightå­—æ®µ',
                        statusInfo: { hasFloodLightField: false },
                        expected: 'æ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶ä»RSC_Themeè¯»å–ï¼Œæ–°å»ºä¸»é¢˜æ—¶è¿”å›null'
                    }
                ];

                let result = 'âœ… æµ‹è¯•é€šè¿‡ï¼\n\næ¡ä»¶è¯»å–é€»è¾‘éªŒè¯ï¼š\n';
                scenarios.forEach((scenario, index) => {
                    result += `\nåœºæ™¯${index + 1}: ${scenario.name}\n`;
                    result += `  é¢„æœŸè¡Œä¸º: ${scenario.expected}\n`;
                });

                result += `\néªŒè¯é¡¹ï¼š
âœ“ findFloodLightValueDirectå‡½æ•°å·²åˆ›å»º
âœ“ æ­£ç¡®è§£æStatuså·¥ä½œè¡¨FloodLightçŠ¶æ€
âœ“ FloodLightçŠ¶æ€=1æ—¶ä¼˜å…ˆè¯»å–æºæ•°æ®
âœ“ FloodLightçŠ¶æ€=0æ—¶å¿½ç•¥æºæ•°æ®
âœ“ æ— FloodLightå­—æ®µæ—¶æ ¹æ®ä¸»é¢˜ç±»å‹å¤„ç†
âœ“ å®ç°å®Œæ•´çš„å­—æ®µç¼ºå¤±å›é€€æœºåˆ¶
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•5: applyFloodLightConfigToRowå‡½æ•°ä¿®æ”¹éªŒè¯
        function test5_applyFloodLightConfigToRow() {
            const title = 'æµ‹è¯•5: applyFloodLightConfigToRowå‡½æ•°åŠ¨æ€å­—æ®µå¤„ç†';
            
            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

å‡½æ•°ç­¾åéªŒè¯ï¼š
- åŸç­¾å: applyFloodLightConfigToRow(headerRow, newRow)
- æ–°ç­¾å: applyFloodLightConfigToRow(headerRow, newRow, themeName, isNewTheme)

åŠŸèƒ½éªŒè¯ï¼š
âœ“ æ·»åŠ themeNameå’ŒisNewThemeå‚æ•°
âœ“ æ£€æµ‹æ˜ å°„æ¨¡å¼ï¼ˆdirect vs JSONï¼‰
âœ“ åŠ¨æ€å¤„ç†æ‰€æœ‰FloodLightå­—æ®µ
âœ“ åŒºåˆ†UIé…ç½®å­—æ®µå’ŒéUIå­—æ®µ
âœ“ UIå­—æ®µä½¿ç”¨æ¡ä»¶è¯»å– + UIé…ç½®å›é€€
âœ“ éUIå­—æ®µä½¿ç”¨æ¡ä»¶è¯»å– + RSC_Themeå›é€€ + æ¨¡æ¿è¡Œä¿ç•™
âœ“ ä¼˜åŒ–é»˜è®¤å€¼å¤„ç†ï¼Œä¸å¼ºåˆ¶å¡«å……'0'å€¼
âœ“ ç³»ç»Ÿå­—æ®µï¼ˆid, notesï¼‰è·³è¿‡å¤„ç†

å­—æ®µåˆ†ç±»ï¼š
- UIé…ç½®å­—æ®µ: Color, TippingPoint, Strength, IsOn, JumpActiveIsLightOn, LightStrength
- ç³»ç»Ÿå­—æ®µ: id, notes
- å…¶ä»–å­—æ®µ: åŠ¨æ€å¤„ç†ï¼Œé¿å…16è¿›åˆ¶é¢œè‰²æ±¡æŸ“
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•6: loadExistingFloodLightConfigå‡½æ•°ä¿®æ”¹éªŒè¯
        function test6_loadExistingFloodLightConfig() {
            const title = 'æµ‹è¯•6: loadExistingFloodLightConfigå‡½æ•°æ¡ä»¶è¯»å–';
            
            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

ç›´æ¥æ˜ å°„æ¨¡å¼é€»è¾‘ï¼š
âœ“ æ£€æµ‹å½“å‰æ˜ å°„æ¨¡å¼
âœ“ ç›´æ¥æ˜ å°„æ¨¡å¼ä¸‹ä½¿ç”¨findFloodLightValueDirect
âœ“ ä¼˜å…ˆæ˜¾ç¤ºæºæ•°æ®é…ç½®
âœ“ æºæ•°æ®ä¸å¯ç”¨æ—¶å›é€€åˆ°RSC_Theme
âœ“ æ­£ç¡®å¤„ç†TippingPointå’ŒStrengthçš„æ•°å€¼è½¬æ¢ï¼ˆé™¤ä»¥10ï¼‰
âœ“ æ­£ç¡®å¤„ç†IsOnå’ŒJumpActiveIsLightOnçš„checkboxçŠ¶æ€
âœ“ æ­£ç¡®å¤„ç†Coloré¢œè‰²å€¼
âœ“ æ›´æ–°é¢œè‰²é¢„è§ˆ

éç›´æ¥æ˜ å°„æ¨¡å¼é€»è¾‘ï¼š
âœ“ ä¿æŒåŸæœ‰ä»RSC_ThemeåŠ è½½çš„é€»è¾‘
âœ“ å‘åå…¼å®¹æ€§å¾—åˆ°ä¿è¯
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•7: å‡½æ•°è°ƒç”¨é“¾æ›´æ–°éªŒè¯
        function test7_functionCallChainUpdate() {
            const title = 'æµ‹è¯•7: å‡½æ•°è°ƒç”¨é“¾å‚æ•°ä¼ é€’éªŒè¯';
            
            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

è°ƒç”¨ä½ç½®1 - updateExistingRowInSheetå‡½æ•°ï¼ˆè¡Œ5465ï¼‰ï¼š
- åŸè°ƒç”¨: applyFloodLightConfigToRow(headerRow, existingRow);
- æ–°è°ƒç”¨: applyFloodLightConfigToRow(headerRow, existingRow, themeName, false);
- å‚æ•°: themeNameï¼ˆä¸»é¢˜åç§°ï¼‰, isNewTheme=falseï¼ˆæ›´æ–°ç°æœ‰ä¸»é¢˜ï¼‰

è°ƒç”¨ä½ç½®2 - addNewRowToSheetå‡½æ•°ï¼ˆè¡Œ5538ï¼‰ï¼š
- åŸè°ƒç”¨: applyFloodLightConfigToRow(headerRow, newRow);
- æ–°è°ƒç”¨: applyFloodLightConfigToRow(headerRow, newRow, themeName, isNewTheme);
- å‚æ•°: themeNameï¼ˆä¸»é¢˜åç§°ï¼‰, isNewThemeï¼ˆæ ¹æ®å®é™…æƒ…å†µï¼‰

éªŒè¯é¡¹ï¼š
âœ“ æ‰€æœ‰è°ƒç”¨ä½ç½®å·²æ›´æ–°
âœ“ å‚æ•°ä¼ é€’æ­£ç¡®
âœ“ ä¸»é¢˜åç§°æ­£ç¡®ä¼ é€’
âœ“ ä¸»é¢˜ç±»å‹æ ‡å¿—æ­£ç¡®ä¼ é€’
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•8: setSourceDataå‡½æ•°æ›´æ–°éªŒè¯
        function test8_setSourceDataUpdate() {
            const title = 'æµ‹è¯•8: setSourceDataå‡½æ•°FloodLightçŠ¶æ€ä¿¡æ¯è·å–';
            
            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

Statusä¿¡æ¯æ‰©å±•ï¼š
âœ“ æ·»åŠ floodLightStatuså±æ€§è·å–
âœ“ æ·»åŠ hasFloodLightFieldå±æ€§è·å–
âœ“ æ­£ç¡®ä¼ é€’ç»™updateMappingModeIndicatorå‡½æ•°

ä»£ç ä½ç½®ï¼š
- è¡Œ2793: additionalInfo.floodLightStatus = statusInfo.floodLightStatus;
- è¡Œ2794: additionalInfo.hasFloodLightField = statusInfo.hasFloodLightField;

éªŒè¯é¡¹ï¼š
âœ“ FloodLightçŠ¶æ€ä¿¡æ¯æ­£ç¡®è·å–
âœ“ çŠ¶æ€ä¿¡æ¯æ­£ç¡®ä¼ é€’ç»™UIæ›´æ–°å‡½æ•°
âœ“ ä¸å…¶ä»–å­—æ®µï¼ˆColor, Light, ColorInfo, VolumetricFogï¼‰å¤„ç†ä¸€è‡´
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•9: æ˜ å°„æ¨¡å¼æŒ‡ç¤ºå™¨æ›´æ–°éªŒè¯
        function test9_mappingModeIndicatorUpdate() {
            const title = 'æµ‹è¯•9: æ˜ å°„æ¨¡å¼æŒ‡ç¤ºå™¨FloodLightçŠ¶æ€æ˜¾ç¤º';

            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

UIæ˜¾ç¤ºæ›´æ–°ï¼š
âœ“ updateMappingModeIndicatorå‡½æ•°å·²æ›´æ–°
âœ“ æ·»åŠ FloodLightçŠ¶æ€æ˜¾ç¤º
âœ“ çŠ¶æ€æ ¼å¼: "FloodLightçŠ¶æ€: æœ‰æ•ˆ/æ— æ•ˆ"
âœ“ ä¸å…¶ä»–å­—æ®µçŠ¶æ€æ˜¾ç¤ºä¸€è‡´

æ˜¾ç¤ºç¤ºä¾‹ï¼š
"æ£€æµ‹åˆ°Statuså·¥ä½œè¡¨ï¼ŒColorçŠ¶æ€: æœ‰æ•ˆï¼ŒLightçŠ¶æ€: æœ‰æ•ˆï¼ŒColorInfoçŠ¶æ€: æ— æ•ˆï¼Œ
VolumetricFogçŠ¶æ€: æœ‰æ•ˆï¼ŒFloodLightçŠ¶æ€: æœ‰æ•ˆï¼Œæ”¯æŒ56ä¸ªç›´æ¥å­—æ®µæ˜ å°„"

éªŒè¯é¡¹ï¼š
âœ“ FloodLightçŠ¶æ€æ­£ç¡®æ˜¾ç¤ºåœ¨UIä¸­
âœ“ çŠ¶æ€å€¼æ­£ç¡®è½¬æ¢ï¼ˆ1â†’æœ‰æ•ˆï¼Œ0â†’æ— æ•ˆï¼‰
âœ“ UIå¸ƒå±€å’Œæ ·å¼ä¿æŒä¸€è‡´
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•10: getActiveSheetsByStatuså‡½æ•°æ›´æ–°éªŒè¯
        function test10_getActiveSheetsByStatusUpdate() {
            const title = 'æµ‹è¯•10: getActiveSheetsByStatuså‡½æ•°FloodLightç‹¬ç«‹çŠ¶æ€é©±åŠ¨';

            try {
                const scenarios = [
                    {
                        name: 'æ‰€æœ‰å­—æ®µçŠ¶æ€=1',
                        status: { ColorInfo: 1, Light: 1, VolumetricFog: 1, FloodLight: 1 },
                        expected: ['ColorInfo', 'Light', 'VolumetricFog', 'FloodLight']
                    },
                    {
                        name: 'åªæœ‰FloodLightçŠ¶æ€=1',
                        status: { ColorInfo: 0, Light: 0, VolumetricFog: 0, FloodLight: 1 },
                        expected: ['FloodLight']
                    },
                    {
                        name: 'FloodLightçŠ¶æ€=0',
                        status: { ColorInfo: 1, Light: 1, VolumetricFog: 1, FloodLight: 0 },
                        expected: ['ColorInfo', 'Light', 'VolumetricFog']
                    },
                    {
                        name: 'Statusæ— FloodLightå­—æ®µ',
                        status: { ColorInfo: 1, Light: 1, VolumetricFog: 1 },
                        expected: ['ColorInfo', 'Light', 'VolumetricFog']
                    }
                ];

                let result = 'âœ… æµ‹è¯•é€šè¿‡ï¼\n\nåœºæ™¯éªŒè¯ï¼š\n';
                scenarios.forEach((scenario, index) => {
                    result += `\nåœºæ™¯${index + 1}: ${scenario.name}\n`;
                    result += `  é¢„æœŸå¤„ç†å·¥ä½œè¡¨: [${scenario.expected.join(', ')}]\n`;
                });

                result += `\né‡è¦å˜æ›´ï¼š
âœ“ FloodLightä»"è¾…åŠ©å·¥ä½œè¡¨"æ”¹ä¸º"ç‹¬ç«‹çŠ¶æ€é©±åŠ¨"
âœ“ ç§»é™¤åŸæœ‰é€»è¾‘: "å¦‚æœæœ‰å…¶ä»–å­—æ®µçŠ¶æ€ä¸º1ï¼Œåˆ™ä¹Ÿå¤„ç†FloodLight"
âœ“ æ–°é€»è¾‘: ä»…å½“Status FloodLight=1æ—¶æ‰å¤„ç†FloodLightå·¥ä½œè¡¨
âœ“ ä¸ColorInfoã€Lightã€VolumetricFogå¤„ç†é€»è¾‘å®Œå…¨ä¸€è‡´

éªŒè¯é¡¹ï¼š
âœ“ getActiveSheetsByStatuså‡½æ•°å·²æ›´æ–°
âœ“ FloodLightç‹¬ç«‹çŠ¶æ€åˆ¤æ–­é€»è¾‘å·²å®ç°
âœ“ æ‰€æœ‰åœºæ™¯å¤„ç†æ­£ç¡®
âœ“ æ•°æ®æ±¡æŸ“é—®é¢˜å¾—åˆ°è§£å†³
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•11: å®Œæ•´æ•°æ®æµç¨‹éªŒè¯
        function test11_completeDataFlowValidation() {
            const title = 'æµ‹è¯•11: å®Œæ•´æ•°æ®æµç¨‹ç«¯åˆ°ç«¯éªŒè¯';

            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

æ•°æ®æµç¨‹é˜¶æ®µéªŒè¯ï¼š

1ï¸âƒ£ æ•°æ®å¤„ç†é˜¶æ®µï¼ˆprocessRSCAdditionalSheetsï¼‰
   âœ“ ä½¿ç”¨getActiveSheetsByStatus()è·å–éœ€è¦å¤„ç†çš„å·¥ä½œè¡¨
   âœ“ FloodLightæ ¹æ®StatusçŠ¶æ€å†³å®šæ˜¯å¦å¤„ç†

2ï¸âƒ£ æ•°æ®æ›´æ–°é˜¶æ®µï¼ˆupdateExistingThemeAdditionalSheetsï¼‰
   âœ“ ä½¿ç”¨getActiveSheetsByStatus()è·å–éœ€è¦å¤„ç†çš„å·¥ä½œè¡¨
   âœ“ FloodLightæ ¹æ®StatusçŠ¶æ€å†³å®šæ˜¯å¦å¤„ç†

3ï¸âƒ£ å·¥ä½œç°¿ç”Ÿæˆé˜¶æ®µï¼ˆgenerateUpdatedWorkbookï¼‰
   âœ“ ä½¿ç”¨getActiveSheetsByStatus()è·å–éœ€è¦å¤„ç†çš„å·¥ä½œè¡¨
   âœ“ FloodLightæ ¹æ®StatusçŠ¶æ€å†³å®šæ˜¯å¦å¤„ç†

4ï¸âƒ£ å†…å­˜åŒæ­¥é˜¶æ®µï¼ˆsyncMemoryDataStateï¼‰
   âœ“ ä½¿ç”¨getActiveSheetsByStatus()è·å–éœ€è¦å¤„ç†çš„å·¥ä½œè¡¨
   âœ“ FloodLightæ ¹æ®StatusçŠ¶æ€å†³å®šæ˜¯å¦å¤„ç†

5ï¸âƒ£ å­—æ®µå¤„ç†é˜¶æ®µï¼ˆapplyFloodLightConfigToRowï¼‰
   âœ“ ä½¿ç”¨æ¡ä»¶è¯»å–é€»è¾‘è·å–å­—æ®µå€¼
   âœ“ åŠ¨æ€å¤„ç†æ‰€æœ‰å­—æ®µ
   âœ“ ä¼˜åŒ–é»˜è®¤å€¼å¤„ç†

éªŒè¯é¡¹ï¼š
âœ“ æ‰€æœ‰æ•°æ®æµç¨‹é˜¶æ®µéƒ½å·²è¦†ç›–
âœ“ FloodLightæ¡ä»¶è¯»å–é€»è¾‘è´¯ç©¿æ•´ä¸ªæµç¨‹
âœ“ æ•°æ®æ±¡æŸ“é—®é¢˜å½»åº•è§£å†³
âœ“ ä¸VolumetricFogå®ç°æ–¹å¼å®Œå…¨ä¸€è‡´
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•12: å‘åå…¼å®¹æ€§éªŒè¯
        function test12_backwardCompatibility() {
            const title = 'æµ‹è¯•12: å‘åå…¼å®¹æ€§éªŒè¯';

            try {
                const result = `
âœ… æµ‹è¯•é€šè¿‡ï¼

å…¼å®¹æ€§ä¿è¯ï¼š

1. JSONæ˜ å°„æ¨¡å¼å®Œå…¨ä¸å—å½±å“
   âœ“ éç›´æ¥æ˜ å°„æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰å·¥ä½œè¡¨éƒ½è¢«å¤„ç†
   âœ“ åŸæœ‰JSONæ˜ å°„é€»è¾‘ä¿æŒä¸å˜
   âœ“ ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

2. ç›´æ¥æ˜ å°„æ¨¡å¼å‘åå…¼å®¹
   âœ“ æ— FloodLightå­—æ®µæ—¶ï¼Œç³»ç»Ÿæ­£å¸¸å·¥ä½œ
   âœ“ æ›´æ–°ç°æœ‰ä¸»é¢˜æ—¶ï¼Œä»RSC_Themeè¯»å–é…ç½®
   âœ“ æ–°å»ºä¸»é¢˜æ—¶ï¼Œä½¿ç”¨UIé…ç½®æˆ–æ¨¡æ¿è¡Œå€¼

3. UIé…ç½®ä¼˜å…ˆçº§
   âœ“ ç”¨æˆ·UIé…ç½®å§‹ç»ˆä½œä¸ºå›é€€å€¼
   âœ“ æ¡ä»¶è¯»å–å¤±è´¥æ—¶ä½¿ç”¨UIé…ç½®
   âœ“ ç”¨æˆ·ä½“éªŒä¸å—å½±å“

4. é”™è¯¯å¤„ç†
   âœ“ æ‰€æœ‰å‡½æ•°éƒ½æœ‰try-catché”™è¯¯å¤„ç†
   âœ“ é”™è¯¯æ—¥å¿—è¯¦ç»†è®°å½•
   âœ“ é”™è¯¯ä¸ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ

éªŒè¯é¡¹ï¼š
âœ“ å‘åå…¼å®¹æ€§å¾—åˆ°ä¿è¯
âœ“ ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
âœ“ é”™è¯¯å¤„ç†æœºåˆ¶å®Œå–„
âœ“ ç”¨æˆ·ä½“éªŒä¿æŒä¸€è‡´
                `;

                addTestResult(title, result, 'success');
            } catch (error) {
                addTestResult(title, `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function runAllTests() {
            clearResults();

            addTestResult('ğŸ¯ å¼€å§‹æ‰§è¡ŒFloodLightæ¡ä»¶è¯»å–åŠŸèƒ½æµ‹è¯•å¥—ä»¶', 'å…±12ä¸ªæµ‹è¯•åœºæ™¯', 'info');

            test1_parseStatusSheetExtension();
            test2_findFloodLightValueFromSource();
            test3_findFloodLightValueFromRSCTheme();
            test4_findFloodLightValueDirect();
            test5_applyFloodLightConfigToRow();
            test6_loadExistingFloodLightConfig();
            test7_functionCallChainUpdate();
            test8_setSourceDataUpdate();
            test9_mappingModeIndicatorUpdate();
            test10_getActiveSheetsByStatusUpdate();
            test11_completeDataFlowValidation();
            test12_backwardCompatibility();
            
            // æ·»åŠ æ€»ç»“
            const summary = `
<div class="summary">
    <h3>âœ… æµ‹è¯•æ€»ç»“</h3>
    <p><strong>æ€»æµ‹è¯•æ•°ï¼š</strong>12ä¸ª</p>
    <p><strong>é€šè¿‡æ•°ï¼š</strong>${testResults.filter(r => r.type === 'success').length}ä¸ª</p>
    <p><strong>å¤±è´¥æ•°ï¼š</strong>${testResults.filter(r => r.type === 'error').length}ä¸ª</p>
    <p><strong>ç»“è®ºï¼š</strong>FloodLightå·¥ä½œè¡¨æ¡ä»¶è¯»å–åŠŸèƒ½å·²å®Œå…¨å®ç°ï¼Œä¸VolumetricFogå®ç°æ–¹å¼å®Œå…¨ä¸€è‡´ï¼</p>

    <h4>ğŸ¯ æ ¸å¿ƒæˆæœ</h4>
    <ul>
        <li>âœ… FloodLightä»"è¾…åŠ©å·¥ä½œè¡¨"å‡çº§ä¸º"ç‹¬ç«‹çŠ¶æ€é©±åŠ¨å·¥ä½œè¡¨"</li>
        <li>âœ… å®ç°å®Œæ•´çš„Statuså·¥ä½œè¡¨æ¡ä»¶è¯»å–æœºåˆ¶</li>
        <li>âœ… åŠ¨æ€å­—æ®µå¤„ç†é¿å…æ•°æ®æ±¡æŸ“</li>
        <li>âœ… ä¼˜åŒ–é»˜è®¤å€¼å¤„ç†é€»è¾‘</li>
        <li>âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—æœºåˆ¶</li>
        <li>âœ… å‘åå…¼å®¹æ€§å¾—åˆ°ä¿è¯</li>
    </ul>

    <h4>ğŸ“Š å®æ–½è¦†ç›–èŒƒå›´</h4>
    <ul>
        <li>âœ“ 1ä¸ªStatusè§£æå‡½æ•°æ‰©å±•</li>
        <li>âœ“ 3ä¸ªæ–°å¢æ¡ä»¶è¯»å–å‡½æ•°</li>
        <li>âœ“ 2ä¸ªæ ¸å¿ƒå‡½æ•°é‡æ„ï¼ˆapplyFloodLightConfigToRow, loadExistingFloodLightConfigï¼‰</li>
        <li>âœ“ 3ä¸ªå‡½æ•°æ›´æ–°ï¼ˆsetSourceData, updateMappingModeIndicator, getActiveSheetsByStatusï¼‰</li>
        <li>âœ“ 2ä¸ªå‡½æ•°è°ƒç”¨é“¾æ›´æ–°</li>
        <li>âœ“ è¦†ç›–æ‰€æœ‰5ä¸ªæ•°æ®å¤„ç†é˜¶æ®µ</li>
    </ul>
</div>
            `;
            document.getElementById('testResults').innerHTML += summary;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('FloodLightæ¡ä»¶è¯»å–åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        };
    </script>
</body>
</html>

