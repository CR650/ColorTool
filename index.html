<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>颜色主题管理工具 - ColorTool Connect</title>
    <meta name="description" content="Unity项目颜色主题管理工具，支持颜色配置的导入和更新">
    <meta name="keywords" content="颜色主题,Unity,主题管理,颜色配置">
    
    <!-- 引入SheetJS库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- 头部标题区域 -->
        <header class="header">
            <div class="header-top">
                <div class="title-section">
                    <h1>颜色主题管理工具</h1>
                    <p class="subtitle">Unity项目颜色主题配置管理</p>
                </div>
                <div class="version-section">
                    <span class="version-label">版本</span>
                    <span class="version-number" id="versionNumber">v1.0.0</span>
                </div>
            </div>

            <!-- 浏览器兼容性提示 -->
            <div id="browserCompatibility" style="margin: 10px 0; padding: 10px; border-radius: 5px; font-size: 14px;">
                <!-- 将通过JavaScript动态填充 -->
            </div>

            <!-- 顶部居中导航栏 -->
            <nav class="top-nav" aria-label="快捷导航">
                <a href="navigation.html" class="nav-cta" title="前往工具导航站">
                    <span class="nav-icon" aria-hidden="true">🧭</span>
                    <span class="nav-text">导航站</span>
                </a>
            </nav>

            <div class="usage-guide">
                <h4>📋 使用步骤：</h4>
                <ol>
                    <li>选择包含完整配色表的Excel源数据文件</li>
                    <li>选择Unity项目下的'Tools\xlsx'文件夹</li>
                    <li>输入主题名称，如果已存在该主题，就覆盖更新，如果没有就新增主题</li>
                    <li>点击处理按钮生成更新后的主题文件</li>
                </ol>


            </div>
        </header>

        <!-- 源数据文件选择区域 -->
        <section class="upload-section">
            <div class="upload-area" id="sourceUploadArea">
                <div class="upload-content">
                    <div class="upload-icon">🎨</div>
                    <h3>选择源数据文件</h3>
                    <p>包含完整配色表的Excel文件 (.xlsx, .xls)</p>
                    <input type="file" id="sourceFileInput" accept=".xlsx,.xls" style="display: none;">
                    <button class="upload-btn">
                        选择源数据文件
                    </button>
                </div>

                <!-- 源数据文件选择结果显示 -->
                <div id="sourceFileSelectionResult" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #28a745; border-radius: 5px; background-color: #d4edda;">
                    <div class="result-summary">
                        <h5>✅ 源数据文件选择成功</h5>
                        <div class="file-status-grid" style="display: grid; grid-template-columns: auto 1fr; gap: 10px; margin-top: 10px;">
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold; color: #155724;">文件名:</span>
                                <span class="status-value" id="sourceFileName" style="color: #155724;">-</span>
                            </div>
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold; color: #155724;">文件大小:</span>
                                <span class="status-value" id="sourceFileSize" style="color: #155724;">-</span>
                            </div>
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold; color: #155724;">选择时间:</span>
                                <span class="status-value" id="sourceFileTime" style="color: #155724;">-</span>
                            </div>
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold; color: #155724;">数据行数:</span>
                                <span class="status-value" id="sourceFileRows" style="color: #155724;">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 映射模式指示器 -->
                <div id="mappingModeIndicator" style="display: none; margin-top: 15px; padding: 12px; border-radius: 5px; font-size: 14px; font-weight: bold; text-align: center;">
                    <div id="mappingModeContent">
                        <!-- 映射模式信息将通过JavaScript动态填充 -->
                    </div>
                </div>
            </div>
        </section>



        <!-- Unity项目文件夹选择区域（现代浏览器） -->
        <section class="upload-section" id="folderSelectionSection" style="display: none;">
            <div class="upload-options">
                <h3>� 选择Unity项目文件夹</h3>
                <p>选择Unity项目的Tools/xlsx文件夹，自动定位所有主题文件</p>

                <!-- 文件夹选择区域 -->
                <div class="upload-area" id="folderUploadArea" style="border: 2px dashed #007bff; background-color: #f0f8ff;">
                    <div class="upload-content">
                        <div class="upload-icon">📁</div>
                        <h4>选择Unity项目文件夹</h4>
                        <p>支持Chrome/Edge浏览器，一次选择自动定位所有文件</p>
                        <div class="help-text">
                            <small>✅ 最佳体验：自动找到RSC_Theme.xls和UGCTheme.xls</small>
                            <small>📍 路径示例：rs_ugc2\RS_UGC_Unity_2021.3.31\Tools\xlsx\</small>
                        </div>
                        <button class="upload-btn primary" id="selectFolderBtn" style="background: #007bff;">
                            📁 选择Unity项目文件夹
                        </button>

                    </div>
                </div>

                <!-- 文件夹选择结果显示 -->
                <div id="folderSelectionResult" style="display: none; margin-top: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                    <div class="result-summary">
                        <h5>📂 文件夹选择结果</h5>
                        <div class="file-status-grid" style="display: grid; grid-template-columns: auto 1fr; gap: 10px; margin-top: 10px;">
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold;">文件夹路径:</span>
                                <span class="status-value" id="selectedFolderPath" style="color: #666;">-</span>
                            </div>
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold;">RSC_Theme.xls:</span>
                                <span class="status-value" id="folderRscFileStatus" style="color: #666;">-</span>
                            </div>
                            <div class="status-item" style="display: contents;">
                                <span class="status-label" style="font-weight: bold;">UGCTheme.xls:</span>
                                <span class="status-value" id="folderUgcFileStatus" style="color: #666;">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Unity项目路径选择区域（兼容模式浏览器） -->
        <section class="upload-section" id="individualFileSelectionSection" style="display: none;">
            <div class="upload-options">
                <h3 id="individualFileSectionTitle">� 分别选择文件</h3>
                <p id="individualFileSectionDescription">选择Unity项目中的RSC_Theme.xls和UGCTheme.xls文件</p>

                <!-- 浏览器兼容性提示（仅在不支持的浏览器中显示） -->
                <div id="browserUpgradeNote" style="display: none; margin-bottom: 20px; padding: 15px; border: 1px solid #ffc107; border-radius: 5px; background-color: #fff3cd;">
                    <h5 style="margin: 0 0 10px 0; color: #856404;">💡 浏览器兼容性提示</h5>
                    <p style="margin: 0; color: #856404;">
                        您当前使用的浏览器不支持文件夹选择功能。<br>
                        建议升级到 <strong>Chrome 86+</strong> 或 <strong>Edge 86+</strong> 以获得更好的体验。
                    </p>
                </div>

                <h4>选择Unity项目rs_ugc2\RS_UGC_Unity_2021.3.31\Tools\xlsx下的RSC_Theme.xls文件</h4>

                <!-- 直接文件保存 -->
                <div class="upload-area" id="directSaveUploadArea" style="border: 2px dashed #28a745; background-color: #f8fff9;">
                    <div class="upload-content">
                        <div class="upload-icon">🚀</div>
                        <h4>选择RSC_Theme文件并启用直接保存</h4>
                        <p>支持Chrome/Edge浏览器，可直接覆盖原文件，无需手动替换</p>
                        <div class="help-text">
                            <small>✅ 最佳体验：处理完成后自动保存到原位置</small>
                        </div>
                        <button class="upload-btn primary" id="enableDirectSaveBtn" style="background: #28a745;">
                            🎯 选择RSC_Theme文件并启用直接保存
                        </button>

                    </div>
                </div>

                <h4>选择Unity项目rs_ugc2\RS_UGC_Unity_2021.3.31\Tools\xlsx下的UGCTheme.xls文件</h4>
                <p>选择UGCTheme.xls文件并启用直接保存功能：</p>

                <!-- UGC直接文件保存 -->
                <div class="upload-area" id="ugcDirectSaveUploadArea" style="border: 2px dashed #17a2b8; background-color: #f0f9ff;">
                    <div class="upload-content">
                        <div class="upload-icon">🎨</div>
                        <h4>选择UGCTheme文件并启用直接保存</h4>
                        <p>支持Chrome/Edge浏览器，可直接覆盖原文件，无需手动替换</p>
                        <div class="help-text">
                            <small>✅ 新增主题时会自动添加新行到所有sheet</small>
                        </div>
                        <button class="upload-btn primary" id="enableUGCDirectSaveBtn" style="background: #17a2b8;">
                            🎯 选择UGCTheme文件并启用直接保存
                        </button>

                    </div>
                </div>
            </div>
        </section>

        <!-- 主题名称输入区域 -->
        <section class="theme-input-section" id="themeInputSection" style="display: none;">
            <div class="theme-input-card">
                <h3>主题配置</h3>

                <!-- 操作模式指示器 -->
                <div class="operation-mode-indicator" id="operationModeIndicator">
                    <div class="mode-badge" id="modeBadge">请选择操作模式</div>
                    <div class="mode-description" id="modeDescription">选择现有主题进行更新，或输入新主题名称进行创建</div>
                </div>

                <!-- 现有主题选择 -->
                <div class="input-group">
                    <label for="themeSelector">🔄 更新现有主题：</label>
                    <select id="themeSelector" class="theme-selector">
                        <option value="">选择现有主题进行更新...</option>
                    </select>
                </div>

                <!-- 分隔线 -->
                <div class="input-separator">
                    <span>或</span>
                </div>

                <!-- 新主题输入 -->
                <div class="input-group">
                    <label for="themeNameInput">✨ 创建新主题：</label>
                    <input type="text" id="themeNameInput" placeholder="请输入新主题名称" maxlength="50">
                    <div class="input-validation" id="themeInputValidation" style="display: none;"></div>

                    <!-- 主题命名规范说明 -->
                    <div class="operation-guide" style="margin-top: 10px;">
                        <h5>📝 主题命名规范</h5>
                        <ul>
                            <li><strong>推荐格式</strong>：基础名称 + 数字序号，如"赛博1"、"赛博2"、"测试1"等</li>
                            <li><strong>同系列主题</strong>：使用相同的基础名称，系统会自动识别并继承配置</li>
                            <li><strong>全新系列</strong>：使用新的基础名称，需要完整配置多语言和UGC参数</li>
                            <li><strong>字符限制</strong>：建议使用中文、英文、数字，避免特殊符号</li>
                        </ul>
                    </div>
                </div>

                <!-- 多语言配置区域（仅新建主题时显示） -->
                <div class="multilang-config-section" id="multiLangConfigSection" style="display: none;">
                    <h4>🌐 多语言配置</h4>
                    <div class="multilang-content">
                        <div class="multilang-step">
                            <label for="multiLangId">多语言ID：</label>
                            <input type="number" id="multiLangId" placeholder="请先打开在线表填写主题信息，然后输入分配的多语言ID" min="1">
                            <button type="button" id="openMultiLangBtn" class="multilang-btn">
                                📝 打开在线多语言表
                            </button>
                        </div>
                        <small class="help-text">
                            💡 操作步骤：1) 点击按钮打开在线表 → 2) 在表格中添加主题信息 → 3) 回来输入分配的多语言ID
                        </small>
                    </div>

                    <!-- 多语言配置详细指引 -->
                    <div class="operation-guide">
                        <h5>📋 多语言配置详细说明</h5>
                        <ul>
                            <li><strong>创建全新系列主题时</strong>（如"测试1"）：在多语言在线表中应填入<span class="highlight">基础名称"测试"</span>（不包含序列号）</li>
                            <li><strong>创建同系列主题时</strong>（如"赛博3"）：系统会自动复用现有的"赛博"系列配置，无需重新填写</li>
                            <li><strong>主题名称规范</strong>：建议使用"基础名称+数字"的格式，如"赛博1"、"赛博2"、"测试1"等</li>
                            <li><strong>多语言ID</strong>：在在线表中添加主题信息后，系统会自动分配一个唯一的多语言ID</li>
                        </ul>
                    </div>
                </div>

                <!-- UGCTheme字段配置区域（仅新建主题时显示） -->
                <div class="ugc-config-section" id="ugcConfigSection" style="display: none;">
                    <h4>🎮 UGCTheme 图案配置</h4>

                    <!-- UGC配置参数说明 -->
                    <div class="operation-guide" style="margin-bottom: 20px;">
                        <h5>🎯 UGC配置参数说明</h5>
                        <ul>
                            <li><strong>地板图案ID</strong>：控制地板的纹理图案，0-63范围内的数值</li>
                            <li><strong>地板边框图案ID</strong>：控制地板边缘的装饰图案，0-63范围内的数值</li>
                            <li><strong>玻璃图案ID</strong>：控制未踩中玻璃的纹理图案</li>
                            <li><strong>跳板图案ID</strong>：控制跳板的纹理图案和透明度设置</li>
                            <li><strong>透明度</strong>：控制图案的透明程度，0-100范围（0=完全透明，100=完全不透明）</li>
                        </ul>
                    </div>

                    <div class="ugc-config-content">
                        <div class="ugc-config-grid">
                            <!-- 地板配置 -->
                            <div class="ugc-config-group">
                                <h5>🏠 地板 (Custom_Ground_Color)</h5>
                                <div class="ugc-field-row">
                                    <label for="groundPatternIndex">地板图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="groundPatternIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="groundPatternIndex" data-type="pattern">选择图案</button>
                                    </div>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="groundFrameIndex">地板边框图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="groundFrameIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="groundFrameIndex" data-type="frame">选择边框</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 未踩中玻璃配置 -->
                            <div class="ugc-config-group">
                                <h5>🔷 未踩中玻璃 (Custom_Fragile_Color)</h5>
                                <div class="ugc-field-row">
                                    <label for="fragilePatternIndex">玻璃图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="fragilePatternIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="fragilePatternIndex" data-type="pattern">选择图案</button>
                                    </div>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragileFrameIndex">玻璃边框图案ID:</label>
                                    <select id="fragileFrameIndex" class="frame-border-select">
                                        <option value="0">0 - 无边框</option>
                                        <option value="1">1 - 有边框</option>
                                    </select>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragileGlassAlpha">玻璃底色透明度:</label>
                                    <input type="number" id="fragileGlassAlpha" min="0" max="100" value="50" placeholder="默认: 50">
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragilePatternAlpha">玻璃图案透明度:</label>
                                    <input type="number" id="fragilePatternAlpha" min="0" max="100" value="50" placeholder="默认: 50">
                                </div>
                            </div>

                            <!-- 踩中玻璃配置 -->
                            <div class="ugc-config-group">
                                <h5>💎 踩中玻璃 (Custom_Fragile_Active_Color)</h5>
                                <div class="ugc-field-row">
                                    <label for="fragileActivePatternIndex">玻璃图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="fragileActivePatternIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="fragileActivePatternIndex" data-type="pattern">选择图案</button>
                                    </div>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragileActiveFrameIndex">玻璃边框图案ID:</label>
                                    <select id="fragileActiveFrameIndex" class="frame-border-select">
                                        <option value="0">0 - 无边框</option>
                                        <option value="1">1 - 有边框</option>
                                    </select>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragileActiveGlassAlpha">玻璃底色透明度:</label>
                                    <input type="number" id="fragileActiveGlassAlpha" min="0" max="100" value="50" placeholder="默认: 50">
                                </div>
                                <div class="ugc-field-row">
                                    <label for="fragileActivePatternAlpha">玻璃图案透明度:</label>
                                    <input type="number" id="fragileActivePatternAlpha" min="0" max="100" value="50" placeholder="默认: 50">
                                </div>
                            </div>

                            <!-- 未踩中跳板配置 -->
                            <div class="ugc-config-group">
                                <h5>🚀 未踩中跳板 (Custom_Jump_Color)</h5>
                                <div class="ugc-field-row">
                                    <label for="jumpPatternIndex">跳板图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="jumpPatternIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="jumpPatternIndex" data-type="pattern">选择图案</button>
                                    </div>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="jumpFrameIndex">跳板边框图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="jumpFrameIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="jumpFrameIndex" data-type="frame">选择边框</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 踩中跳板配置 -->
                            <div class="ugc-config-group">
                                <h5>⭐ 踩中跳板 (Custom_Jump_Active_Color)</h5>
                                <div class="ugc-field-row">
                                    <label for="jumpActivePatternIndex">跳板图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="jumpActivePatternIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="jumpActivePatternIndex" data-type="pattern">选择图案</button>
                                    </div>
                                </div>
                                <div class="ugc-field-row">
                                    <label for="jumpActiveFrameIndex">跳板激活边框图案ID:</label>
                                    <div class="pattern-selector-container">
                                        <input type="number" id="jumpActiveFrameIndex" min="0" value="0" placeholder="默认: 0" readonly>
                                        <button type="button" class="pattern-select-btn" data-target="jumpActiveFrameIndex" data-type="frame">选择边框</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <small class="help-text">
                            💡 这些配置将应用到UGCTheme表的相应字段中。创建新主题时使用默认值，更新现有主题时显示当前值。
                        </small>
                    </div>
                </div>

                <!-- RSC_Theme Light配置区域 -->
                <div class="light-config-section" id="lightConfigSection" style="display: none;">
                    <h4>💡 RSC_Theme Light 光照配置</h4>
                    <div class="light-config-content">
                        <div class="light-config-grid">
                            <!-- 明度偏移配置 -->
                            <div class="light-config-group">
                                <h5>🌟 明度偏移设置</h5>
                                <div class="light-field-row">
                                    <label for="lightMax">顶面明度偏移 (Max):</label>
                                    <input type="number" id="lightMax" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                                    <span class="field-hint">调整顶面的明度偏移值</span>
                                </div>
                                <div class="light-field-row">
                                    <label for="lightDark">侧面明度偏移 (Dark):</label>
                                    <input type="number" id="lightDark" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                                    <span class="field-hint">调整侧面的明度偏移值</span>
                                </div>
                                <div class="light-field-row">
                                    <label for="lightMin">底面明度偏移 (Min):</label>
                                    <input type="number" id="lightMin" min="-255" max="255" value="0" placeholder="范围: -255 到 255">
                                    <span class="field-hint">调整底面的明度偏移值</span>
                                </div>
                            </div>

                            <!-- 高光配置 -->
                            <div class="light-config-group">
                                <h5>✨ 高光设置</h5>
                                <div class="light-field-row">
                                    <label for="lightSpecularLevel">高光等级 (SpecularLevel):</label>
                                    <input type="number" id="lightSpecularLevel" min="0" max="1000" value="100" placeholder="范围: 0 到 1000">
                                    <span class="field-hint">游戏中实际应用是小数点向前移两位才是真实值</span>
                                </div>
                                <div class="light-field-row">
                                    <label for="lightGloss">高光光泽度 (Gloss):</label>
                                    <input type="number" id="lightGloss" min="10" max="1000" value="100" placeholder="范围: 10 到 1000">
                                    <span class="field-hint">游戏中实际应用是小数点向前移两位才是真实值</span>
                                </div>
                                <div class="light-field-row">
                                    <label for="lightSpecularColor">高光颜色 (SpecularColor):</label>
                                    <div class="color-selector-container">
                                        <input type="text" id="lightSpecularColor" value="FFFFFF" placeholder="16进制颜色值" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                        <div class="color-preview" id="lightSpecularColorPreview" style="background-color: #FFFFFF;"></div>
                                        <button type="button" class="color-picker-btn" data-target="lightSpecularColor">选择颜色</button>
                                    </div>
                                    <span class="field-hint">16进制格式的高光颜色值</span>
                                </div>
                            </div>
                        </div>
                        <small class="help-text">
                            💡 这些配置将应用到RSC_Theme表的Light字段中。创建新主题时使用默认值，更新现有主题时显示当前值。
                        </small>
                    </div>
                </div>

                <!-- RSC_Theme FloodLight配置区域 -->
                <div class="floodlight-config-section" id="floodlightConfigSection" style="display: none;">
                    <h4>🌊 RSC_Theme FloodLight 泛光参数设置</h4>
                    <div class="floodlight-config-content">
                        <div class="floodlight-config-grid">
                            <!-- 泛光颜色和参数配置 -->
                            <div class="floodlight-config-group">
                                <h5>🎨 泛光颜色设置</h5>
                                <div class="floodlight-field-row">
                                    <label for="floodlightColor">泛光颜色 (Color):</label>
                                    <div class="color-selector-container">
                                        <input type="text" id="floodlightColor" value="FFFFFF" placeholder="16进制颜色值" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                        <div class="color-preview" id="floodlightColorPreview" style="background-color: #FFFFFF;"></div>
                                        <button type="button" class="color-picker-btn" data-target="floodlightColor">选择颜色</button>
                                    </div>
                                    <span class="field-hint">16进制格式的泛光颜色值</span>
                                </div>
                            </div>

                            <!-- 泛光参数配置 -->
                            <div class="floodlight-config-group">
                                <h5>⚙️ 泛光参数设置</h5>
                                <div class="floodlight-field-row">
                                    <label for="floodlightTippingPoint">临界点 (TippingPoint):</label>
                                    <input type="number" id="floodlightTippingPoint" min="0" max="5" step="0.1" value="2.5" placeholder="范围: 0 到 5">
                                    <span class="field-hint">泛光效果的临界点值，支持一位小数</span>
                                </div>
                                <div class="floodlight-field-row">
                                    <label for="floodlightStrength">强度 (Strength):</label>
                                    <input type="number" id="floodlightStrength" min="0" max="10" step="0.1" value="7.8" placeholder="范围: 0 到 10">
                                    <span class="field-hint">泛光效果的强度值，支持一位小数</span>
                                </div>
                            </div>

                            <!-- 泛光开关配置 -->
                            <div class="floodlight-config-group">
                                <h5>🔘 泛光开关设置</h5>
                                <div class="floodlight-field-row">
                                    <label for="floodlightIsOn">泛光是否默认开启 (IsOn):</label>
                                    <div class="toggle-switch-container">
                                        <input type="checkbox" id="floodlightIsOn" class="toggle-switch-input">
                                        <label for="floodlightIsOn" class="toggle-switch-label">
                                            <span class="toggle-switch-slider"></span>
                                            <span class="toggle-switch-text">开启</span>
                                        </label>
                                    </div>
                                    <span class="field-hint">控制泛光效果是否默认开启</span>
                                </div>
                                <div class="floodlight-field-row">
                                    <label for="floodlightJumpActiveIsLightOn">跳板踩踏态发光是否开启 (JumpActiveIsLightOn):</label>
                                    <div class="toggle-switch-container">
                                        <input type="checkbox" id="floodlightJumpActiveIsLightOn" class="toggle-switch-input">
                                        <label for="floodlightJumpActiveIsLightOn" class="toggle-switch-label">
                                            <span class="toggle-switch-slider"></span>
                                            <span class="toggle-switch-text">开启</span>
                                        </label>
                                    </div>
                                    <span class="field-hint">控制跳板踩踏时的发光效果</span>
                                </div>
                            </div>
                        </div>
                        <small class="help-text">
                            🌊 这些配置将应用到RSC_Theme表的FloodLight字段中。创建新主题时使用默认值，更新现有主题时显示当前值。
                        </small>
                    </div>
                </div>

                <!-- VolumetricFog配置面板 -->
                <div class="volumetricfog-config-section" id="volumetricfogConfigSection" style="display: none;">
                    <h4>🌫️ RSC_Theme VolumetricFog 体积雾参数设置</h4>
                    <div class="volumetricfog-config-content">
                        <div class="volumetricfog-config-grid">
                            <!-- 体积雾颜色配置 -->
                            <div class="volumetricfog-config-group">
                                <h5>🎨 体积雾颜色设置</h5>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogColor">体积雾颜色 (Color):</label>
                                    <div class="color-selector-container">
                                        <input type="text" id="volumetricfogColor" value="FFFFFF" placeholder="16进制颜色值" maxlength="6" pattern="[0-9A-Fa-f]{6}">
                                        <div class="color-preview" id="volumetricfogColorPreview" style="background-color: #FFFFFF;"></div>
                                        <button type="button" class="color-picker-btn" data-target="volumetricfogColor">选择颜色</button>
                                    </div>
                                    <span class="field-hint">16进制格式的体积雾颜色值</span>
                                </div>
                            </div>

                            <!-- 体积雾尺寸配置 -->
                            <div class="volumetricfog-config-group">
                                <h5>📐 体积雾尺寸设置</h5>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogX">宽度 (X):</label>
                                    <input type="number" id="volumetricfogX" min="0" max="100" step="1" value="50" placeholder="范围: 0 到 100">
                                    <span class="field-hint">体积雾的宽度值，整数范围 0-100</span>
                                </div>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogY">长度 (Y):</label>
                                    <input type="number" id="volumetricfogY" min="0" max="100" step="1" value="50" placeholder="范围: 0 到 100">
                                    <span class="field-hint">体积雾的长度值，整数范围 0-100</span>
                                </div>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogZ">高度 (Z):</label>
                                    <input type="number" id="volumetricfogZ" min="0" max="100" step="1" value="50" placeholder="范围: 0 到 100">
                                    <span class="field-hint">体积雾的高度值，整数范围 0-100</span>
                                </div>
                            </div>

                            <!-- 体积雾效果配置 -->
                            <div class="volumetricfog-config-group">
                                <h5>⚙️ 体积雾效果设置</h5>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogDensity">浓淡 (Density):</label>
                                    <input type="number" id="volumetricfogDensity" min="0" max="20" step="0.1" value="10.0" placeholder="范围: 0 到 20">
                                    <span class="field-hint">体积雾的浓淡值，支持一位小数，范围 0-20</span>
                                </div>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogRotate">旋转角度 (Rotate):</label>
                                    <input type="number" id="volumetricfogRotate" min="-90" max="90" step="1" value="0" placeholder="范围: -90 到 90">
                                    <span class="field-hint">体积雾的旋转角度，整数范围 -90 到 90</span>
                                </div>
                            </div>

                            <!-- 体积雾开关配置 -->
                            <div class="volumetricfog-config-group">
                                <h5>🔘 体积雾开关设置</h5>
                                <div class="volumetricfog-field-row">
                                    <label for="volumetricfogIsOn">体积雾是否默认开启 (IsOn):</label>
                                    <div class="toggle-switch-container">
                                        <input type="checkbox" id="volumetricfogIsOn" class="toggle-switch-input">
                                        <label for="volumetricfogIsOn" class="toggle-switch-label">
                                            <span class="toggle-switch-slider"></span>
                                            <span class="toggle-switch-text">开启</span>
                                        </label>
                                    </div>
                                    <span class="field-hint">控制体积雾效果是否默认开启</span>
                                </div>
                            </div>
                        </div>
                        <small class="help-text">
                            🌫️ 这些配置将应用到RSC_Theme表的VolumetricFog字段中。创建新主题时使用默认值，更新现有主题时显示当前值。
                        </small>
                    </div>
                </div>

                <!-- RSC_Theme ColorInfo配置区域 -->
                <div class="colorinfo-config-section" id="colorinfoConfigSection" style="display: none;">
                    <h4>🎨 RSC_Theme ColorInfo 颜色配置</h4>
                    <div class="colorinfo-config-content">
                        <div class="colorinfo-config-grid">
                            <!-- RGB颜色配置 -->
                            <div class="colorinfo-config-group">
                                <h5>💎 钻石颜色设置</h5>
                                <div class="colorinfo-field-row">
                                    <label for="PickupDiffColor">钻石颜色 (PickupDiff):</label>
                                    <div class="rgb-color-selector-container">
                                        <div class="rgb-inputs">
                                            <div class="rgb-input-group">
                                                <label>R:</label>
                                                <input type="number" id="PickupDiffR" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>G:</label>
                                                <input type="number" id="PickupDiffG" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>B:</label>
                                                <input type="number" id="PickupDiffB" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                        </div>
                                        <div class="color-preview" id="PickupDiffColorPreview" style="background-color: rgb(255, 255, 255);"></div>
                                        <button type="button" class="color-picker-btn" data-target="PickupDiff" data-mode="rgb">选择颜色</button>
                                    </div>
                                    <span class="field-hint">钻石的基础颜色，RGB值范围0-255</span>
                                </div>
                                <div class="colorinfo-field-row">
                                    <label for="PickupReflColor">钻石反光颜色 (PickupRefl):</label>
                                    <div class="rgb-color-selector-container">
                                        <div class="rgb-inputs">
                                            <div class="rgb-input-group">
                                                <label>R:</label>
                                                <input type="number" id="PickupReflR" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>G:</label>
                                                <input type="number" id="PickupReflG" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>B:</label>
                                                <input type="number" id="PickupReflB" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                        </div>
                                        <div class="color-preview" id="PickupReflColorPreview" style="background-color: rgb(255, 255, 255);"></div>
                                        <button type="button" class="color-picker-btn" data-target="PickupRefl" data-mode="rgb">选择颜色</button>
                                    </div>
                                    <span class="field-hint">钻石反光的颜色，RGB值范围0-255</span>
                                </div>
                                <div class="colorinfo-field-row">
                                    <label for="BallSpecColor">钻石高光颜色 (BallSpec):</label>
                                    <div class="rgb-color-selector-container">
                                        <div class="rgb-inputs">
                                            <div class="rgb-input-group">
                                                <label>R:</label>
                                                <input type="number" id="BallSpecR" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>G:</label>
                                                <input type="number" id="BallSpecG" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>B:</label>
                                                <input type="number" id="BallSpecB" min="0" max="255" value="255" placeholder="0-255">
                                            </div>
                                        </div>
                                        <div class="color-preview" id="BallSpecColorPreview" style="background-color: rgb(255, 255, 255);"></div>
                                        <button type="button" class="color-picker-btn" data-target="BallSpec" data-mode="rgb">选择颜色</button>
                                    </div>
                                    <span class="field-hint">钻石高光的颜色，RGB值范围0-255</span>
                                </div>
                            </div>

                            <!-- 雾效配置 -->
                            <div class="colorinfo-config-group">
                                <h5>🌫️ 远景雾效设置</h5>
                                <div class="colorinfo-field-row">
                                    <label for="ForegroundFogColor">远景雾颜色 (ForegroundFog):</label>
                                    <div class="rgb-color-selector-container">
                                        <div class="rgb-inputs">
                                            <div class="rgb-input-group">
                                                <label>R:</label>
                                                <input type="number" id="ForegroundFogR" min="0" max="255" value="128" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>G:</label>
                                                <input type="number" id="ForegroundFogG" min="0" max="255" value="128" placeholder="0-255">
                                            </div>
                                            <div class="rgb-input-group">
                                                <label>B:</label>
                                                <input type="number" id="ForegroundFogB" min="0" max="255" value="128" placeholder="0-255">
                                            </div>
                                        </div>
                                        <div class="color-preview" id="ForegroundFogColorPreview" style="background-color: rgb(128, 128, 128);"></div>
                                        <button type="button" class="color-picker-btn" data-target="ForegroundFog" data-mode="rgb">选择颜色</button>
                                    </div>
                                    <span class="field-hint">远景雾效的颜色，RGB值范围0-255</span>
                                </div>
                                <div class="colorinfo-field-row">
                                    <label for="FogStart">雾开始距离 (FogStart):</label>
                                    <input type="number" id="FogStart" min="0" max="40" value="10" placeholder="范围: 0 到 40">
                                    <span class="field-hint">远景雾效开始的距离值</span>
                                </div>
                                <div class="colorinfo-field-row">
                                    <label for="FogEnd">雾结束距离 (FogEnd):</label>
                                    <input type="number" id="FogEnd" min="0" max="90" value="50" placeholder="范围: 0 到 90">
                                    <span class="field-hint">远景雾效结束的距离值</span>
                                </div>
                            </div>
                        </div>
                        <small class="help-text">
                            💡 这些配置将应用到RSC_Theme表的ColorInfo字段中。RGB颜色值会自动拆分为独立的R、G、B列存储。
                        </small>
                    </div>
                </div>

                <div class="action-group">
                    <button class="action-btn primary" id="processThemeBtn" disabled>处理主题数据</button>
                    <button class="action-btn secondary" id="resetBtn">重置</button>
                </div>
            </div>
        </section>



        <!-- 处理结果展示区域 -->
        <section class="result-display" id="resultDisplay" style="display: none;">
            <div class="result-header">
                <h3>处理结果</h3>
            </div>
            <div class="result-content">
                <div class="result-summary" id="resultSummary"></div>
                <div class="result-details" id="resultDetails"></div>
            </div>

            <!-- Sheet选择器区域 -->
            <div class="sheet-selector-section" id="sheetSelectorSection" style="display: none; margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background-color: #f9f9f9;">
                <div class="sheet-selector-header" style="margin-bottom: 10px;">
                    <h4 style="margin: 0; color: #333;">📊 数据文件预览</h4>
                    <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">选择要查看的文件和工作表：</p>
                </div>
                <div class="sheet-selector-controls" style="margin-bottom: 15px;">
                    <label for="fileTypeSelect" style="font-weight: bold; margin-right: 10px;">文件类型：</label>
                    <select id="fileTypeSelect" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 3px; font-size: 14px; min-width: 120px; margin-right: 20px;">
                        <option value="rsc">RSC_Theme</option>
                        <option value="ugc">UGCTheme</option>
                    </select>
                    <label for="rscSheetSelect" style="font-weight: bold; margin-right: 10px;">工作表：</label>
                    <select id="rscSheetSelect" style="padding: 5px 10px; border: 1px solid #ccc; border-radius: 3px; font-size: 14px; min-width: 150px;">
                        <option value="">请选择工作表</option>
                    </select>
                    <span id="rscSheetInfo" style="margin-left: 15px; font-size: 12px; color: #888;"></span>
                </div>
                <div class="sheet-data-container" id="sheetDataContainer" style="display: none;">
                    <div class="sheet-data-stats" id="sheetDataStats" style="margin-bottom: 10px; padding: 8px; background-color: #e8f4f8; border-radius: 3px; font-size: 13px;"></div>
                    <div class="sheet-table-container" style="max-height: 400px; overflow: auto; border: 1px solid #ddd; border-radius: 3px;">
                        <table id="rscSheetTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead id="rscSheetTableHead" style="background-color: #f5f5f5; position: sticky; top: 0;"></thead>
                            <tbody id="rscSheetTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 数据预览区域 -->
        <section class="data-preview" id="dataPreview" style="display: none;">
            <div class="preview-header">
                <h3>数据预览</h3>
                <div class="preview-tabs">
                    <button class="tab-btn active" data-tab="source">源数据</button>
                    <button class="tab-btn" data-tab="mapping">映射关系</button>
                    <button class="tab-btn" data-tab="target">目标数据</button>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane active" id="sourceTab">
                    <div class="table-container">
                        <table id="sourceTable">
                            <thead id="sourceTableHead"></thead>
                            <tbody id="sourceTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane" id="mappingTab">
                    <div class="table-container">
                        <table id="mappingTable">
                            <thead id="mappingTableHead"></thead>
                            <tbody id="mappingTableBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="tab-pane" id="targetTab">
                    <div class="table-container">
                        <table id="targetTable">
                            <thead id="targetTableHead"></thead>
                            <tbody id="targetTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 状态提示区域 -->
        <div class="status-message" id="statusMessage"></div>
    </div>

    <!-- 最终操作指引弹框 -->
    <div id="finalGuideModal" class="final-guide-modal" style="display: none;">
        <div class="final-guide-modal-content">
            <div class="final-guide-modal-header">
                <h3>🎉 文件保存完成</h3>
                <button class="final-guide-modal-close" id="closeFinalGuideModal">&times;</button>
            </div>
            <div class="final-guide-modal-body">
                <h4>📋 最后步骤：手动执行权限授权</h4>
                <p>为了确保主题在游戏中正常使用，请执行以下操作：</p>

                <div class="step-list">
                    <h5>🔧 操作步骤：</h5>
                    <ol>
                        <li>打开以下路径：</li>
                        <div class="path-highlight" id="toolsPathDisplay">您的Unity项目文件夹\Tools</div>
                        <li>双击 <span class="path-highlight">"点我允许"</span> 文件</li>
                        <li>等待3秒后程序自动消失，主题即可在游戏中使用</li>
                    </ol>
                </div>

                <h4>❓ 为什么需要这个步骤？</h4>
                <p>由于浏览器安全机制限制，需要手动确认权限设置，确保游戏能够正常读取新的主题配置。</p>
            </div>
            <div class="final-guide-modal-footer">
                <div class="auto-close-info" id="autoCloseCountdown" style="display: none;">此弹框将在 <span>5</span> 秒后自动关闭</div>
                <button id="finalGuideOkBtn">我知道了</button>
            </div>
        </div>
    </div>

    <!-- 图案选择器模态框 -->
    <div id="patternSelectorModal" class="pattern-modal" style="display: none;">
        <div class="pattern-modal-content">
            <div class="pattern-modal-header">
                <h3 id="patternModalTitle">选择图案</h3>
                <button class="pattern-modal-close" id="closePatternModal">&times;</button>
            </div>
            <div class="pattern-modal-body">
                <div class="pattern-canvas-container">
                    <canvas id="patternSelectorCanvas" class="pattern-canvas"></canvas>
                    <div id="patternLoadingText" class="pattern-loading">正在加载图案...</div>
                </div>
                <div class="pattern-info">
                    <div id="selectedPatternInfo" class="selected-pattern-info" style="display: none;">
                        <h4>已选择图案</h4>
                        <div id="patternPreviewContainer" class="pattern-preview-container">
                            <canvas id="patternPreviewCanvas" class="pattern-preview-canvas"></canvas>
                        </div>
                        <div class="pattern-details">
                            <p><strong>图案ID:</strong> <span id="selectedPatternId">-</span></p>
                            <p><strong>位置:</strong> <span id="selectedPatternPosition">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pattern-modal-footer">
                <button class="btn btn-secondary" id="cancelPatternSelection">取消</button>
                <button class="btn btn-primary" id="confirmPatternSelection" disabled>确认选择</button>
            </div>
        </div>
    </div>

    <!-- 引入JavaScript模块文件 -->
    <script src="js/version.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/fileHandler.js"></script>
    <script src="js/dataParser.js"></script>
    <script src="js/tableRenderer.js"></script>
    <script src="js/exportUtils.js"></script>
    <script src="js/unityProjectFolderManager.js"></script>
    <script src="js/ugcPatternSelector.js"></script>
    <script src="js/colorPicker.js"></script>
    <script src="js/themeManager.js"></script>
    <script src="js/main.js"></script>

</body>
</html>
